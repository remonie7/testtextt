Introduction
ISO/IEC 18013 (all parts) establishes guidelines for the design format and data content of an ISO-compliant driving licence (IDL) with regard to human-readable features (ISO/IEC 18013-1), ISO machine-readable technologies (ISO/IEC 18013-2), access control, authentication and integrity validation (ISO/IEC 18013-3), and associated test methods (ISO/IEC 18013-4). It creates a common basis for international use and mutual recognition of the IDL without impeding individual countries/states in applying their privacy rules and national/community/regional motor vehicle authorities in taking care of their specific needs.
This document describes interface and related requirements to facilitate ISO-compliant driving licence (IDL) functionality on a mobile device. The requirements are specifically intended to enable verifiers not affiliated with or associated with the issuing authority to gain access to and authenticate the information. In addition, the requirements allow the holder of the driving licence to decide what information to release to a verifier. Other characteristics include the ability to update information frequently, and to authenticate information at a high level of confidence.
A mobile document conforming to this document primarily conveys the driving privileges associated with a person. It does so by providing means to associate the person presenting the mobile document with the mobile document itself. However, the transaction and security mechanisms in this document have been designed to support other types of mobile documents, specifically including identification documents  Consequently the mechanisms in this document can be used for any type of mobile identification document, regardless of the additional attributes the mobile document may convey. The details of the data elements to be used by other mobile documents are left to the respective issuing authority and are not in scope of this document.



Personal identification - ISO-compliant driving licence - Part 5: Mobile driving licence (mDL) application
1 Scope
This document establishes interface specifications for the implementation of a driving licence in association with a mobile device. This document specifies the interface between the mDL and mDL reader and the interface between the mDL reader and the issuing authority infrastructure. The document also enables parties other than the issuing authority (e.g. other issuing authorities, or mDL verifiers in other countries) to:
a)	use a machine to obtain the mDL data,
b)	tie the mDL to the mDL holder,
c)	authenticate the origin of the mDL data, and
d)	verify the integrity of the mDL data.
The following items are out of scope for this document:
a)	how mDL holder consent to share data is obtained;
b)	requirements on storage of mDL data and mDL private keys.
2 Normative references
3 Terms and definitions
4 Abbreviated terms
5 Conformance requirement
An mDL is in conformance with this document if it meets all therequirements specified directly or by reference herein. Conformance with ISO/IEC 18013-1, ISO/IEC 18013-2, ISO/IEC 18013-3 and ISO/IEC 18013-4 is not required for conformance with this document, except for those clauses normatively referenced in this document.
An mDL reader is in conformance with this document if it meets all the requirements specified directly or referenced herein.
An issuing authority infrastructure is in conformance with this document if it meets all the requirements specified directly or referenced herein.
6 mDL overview
6.1 Interfaces
Figure 1 shows the interfaces in scope for this document. The explanation of each interface is as follows.
* Interface 1 in Figure 1 is the interface between the issuing authority infrastructure and the mDL. This interface is out of scope for this document.
* Interface 2 in Figure 1 is the interface between the mDL and the mDL reader. This interface is specified in this document. The interface can be used for connection setup and for the device retrieval method.
* Interface 3 in Figure 1 is the interface between the issuing authority infrastructure and the mDL reader. This interface is specified in this document. The interface can be used for the server retrieval method.
See [1] for examples of use cases.

Figure 1 - mDL interfaces
6.2 Functional requirements
The functional requirements include at least the following.
a)	An mDL verifier together with an mDL reader shall be able to request, receive and verify the integrity and authenticity of an mDL whether online connectivity is present or not for either the mDL or mDL reader.
b)	An mDL verifier not associated with the issuing authority shall be able to verify the integrity and authenticity of an mDL.
c)	An mDL verifier shall be enabled to confirm the binding between the person presenting the mDL and the mDL holder.
d)	The interface between the mDL and the mDL reader shall support the selective release of mDL data to an mDL reader.
6.3 Technical requirements
6.3.1 Data model
The mDL data is organized as individual data elements which can be requested and returned independently from each other. The mDL data model is described in Clause 7. It describes the identifier and format of the data elements.
NOTE	The concepts used in this document have been designed so that other mobile credentials, e.g. mobile identity or other credentials that substitute Table 5 with a different set of data elements, can also make use of the engagement and retrieval protocols described in this document. Specifically, the mdoc data model illustrated in Figure 2 is based on elements with unique identifiers within a namespace. The number of elements can vary, and the model is indifferent to the value and data format of each element. As such the data model is generic and can apply to any kind of document.

Figure 2 - mdoc data model
6.3.2 Data exchange
6.3.2.1 Overview
The mDL and mDL reader are implemented as an mdoc and mdoc reader, for which the requirements are described in Clause 8 and Clause 9.
Data exchange is divided into three phases: the initialization phase, the device engagement phase and the data retrieval phase (see Clause 8 and as illustrated in Figure 3). After initialization between the mDL and the mDL reader three different transaction flows are distinguished:
-	device engagement, followed by exchange of data using device retrieval between the mDL and the mDL reader (see (1) in Figure 3);
-	device engagement, followed by exchange of server retrieval information using device retrieval between the mDL and the mDL reader, followed by exchange of data using server retrieval between the mDL reader and the issuing authority (see (2) in Figure 3);
-	device engagement, followed by exchange of data using server retrieval between the mDL reader and the issuing authority infrastructure. (see (3) in Figure 3).
NOTE 1	For device retrieval, there is no requirement for any device involved in the transaction to be connected to the internet.
If the mDL reader receives the server retrieval token and URL from the mDL, either during device engagement or device retrieval, it may either use device retrieval or server retrieval. If it chooses to use device retrieval, either BLE, NFC or Wi-Fi Aware can be used to retrieve the information. If it chooses to use server retrieval, either OIDC or WebAPI can be used to retrieve the information.
NOTE 2	The transaction has been designed such that it is not necessary for the mDL holder to physically hand over the mobile device to the mDL verifier.
NOTE 3	The mdoc protocols provides generic means for a user to share connection information and optionally a server retrieval token.
The device data retrieval transport applies to any kind of data as it is designed to transport an encrypted blob. 
The request and response commands (transported encrypted) are applicable to any kinds of document based on the mdoc data model and/or request for server retrieval token. Furthermore, the request and response commands are wallet compliant as elements from different documents can be requested and the response can include multiple documents from the same or different kinds.
The server retrieval method relies on OpenID Connect that is not specific to mDL, or on WebAPI that relies on the generic mdoc data model.

Figure 3 - mDL transaction flow

6.3.2.2 Initialization
During initialization, the mDL is activated. Activation is done by the mDL holder, or triggered by an mDL reader using NFC. Simultaneously, the mDL reader is activated. No requirements are specified for this phase.
NOTE	It is important to avoid unauthorised access by an mDL reader when mDL activation is triggered by NFC.
6.3.2.3 Device engagement
During device engagement, information required to setup and secure data retrieval is exchanged between the mDL and the mDL reader. Transmission technologies available to transfer the device engagement data are as follows:
a)	NFC
b)	QR code
Table 1 shows the different transmission technologies for device engagement.
Table 1 - Device engagement technologies
Transmission 
technologies
Support
Reference

mDL
mDL reader

NFC
Ca
M
Clause 8.2.2.1
QR code
Ca
M
Clause 8.2.2.3
Key
C   conditional
M   mandatory
a   Support for at least one of these methods is mandatory.
The device engagement information, described in Clause 8.2.1, is transferred using one of the transmission technologies, described in Clause 8.2.2.
To ensure that the device engagement is always possible, an mDL shall support at least one of the transmission technologies in Table 1. An mDL reader shall support all transmission technologies.
If the mDL supports NFC for device engagement, it shall support Static Handover, Negatiated Handover, or both, as described in Clause 8.2.2.1. The mDL reader shall support both handover methods.
6.3.2.4 Data retrieval architecture
Figure 4 shows the different data retrieval interfaces and the flow of the messages.
When using device retrieval, the mDL and mDL reader communicate using mdoc request and mdoc response messages encoded with CBOR. These messages are transported using a data retrieval method. The data retrieval methods are agnostic to the information that is transferred.
After device engagement, if the mDL reader sets up a device retrieval connection, the mDL reader asks for data as defined in Clause 8.3.2.1.2.1. The mDL sends an mdoc response according to Clause 8.3.2.1.2.2. The mdoc request may include a request for a server retrieval token used to perform server retrieval. If a server retrieval token is requested next to other mDL data, the mDL shall return either the server retrieval token or the other requested data, but not both.
The different data retrieval methods are described in Clause 6.3.2.5

Figure 4 - Data retrieval architecture
NOTE 1	The secure area as present in Figure 4 indicates an area that provides additional protection of sensitive mDL related data. Security requirements regarding storage of credential information are out of scope for this document. This includes the mDL private key and the mDL reader private key, if mdoc reader authentication is supported by the mDL reader. It is the responsibility of the issuing authority to ensure that all data stored on the mDL is stored securely.
NOTE 2	Implementation possibilities for a secure area are non-exhaustively listed in Annex E.5.
6.3.2.5 Data retrieval methods
The following methods are defined for retrieval of mDL data. Requirements for supporting these methods are defined in Table 2.
mDL data can be retrieved in two ways:
a)	using device retrieval (interface 2 in Figure 1), see Clause 8.3.2.1;
b)	using server retrieval (interface 3 in Figure 1), see Clause 8.3.2.2, where the server retrieval token may be retrieved by the mDL reader from the mDL during device engagement or during device retrieval.
Table 2 shows the transmission technologies and data retrieval methods:
Table 2 - Data retrieval methods
Data retrieval 
method
Transmission 
technology
Support
Reference


mDL
mDL reader
issuing authority infrastructure

Device retrieval
BLE
C a
M
N/A
8.3.3.1.1

NFC
C a
M
N/A
8.3.3.1.2

Wi-Fi Aware
O
R
N/A
8.3.3.1.3
Server retrieval
WebAPI
O
R
O
8.3.3.2.1

OIDC
O
R
O
8.3.3.2.2
Key
M   mandatory
C   conditional
R   recommended
O   optional
N/A  not applicable
a   Support for at least one of these methods is mandatory.
To ensure that data retrieval is always possible, an mDL shall support device retrieval using BLE, NFC, or both transmission technologies. An mDL reader shall support the BLE and NFC transmission technology for device retrieval.
An mDL may support for Wi-Fi Aware and an mDL reader should support Wi-Fi Aware.
An mDL and an issuing authority infrastructure may support WebAPI and/or OIDC and an mDL reader should support WebAPI and OIDC.
For device retrieval using BLE, the mDL reader shall support the mdoc central client mode and mdoc peripheral server mode, as defined in cluase 8.3.3.1.1. The mDL and mDL reader may support the BLE L2CAP transmission profile as defined in Annex A.
All data retrieval methods shall use the data model as defined in Clause 7.
See Annex D for examples of data structures.
NOTE 1	If QR is used for device engagement and the mDL reader chooses to use NFC for data transfer, then there is no mechanism available for the mDL reader to indicate the choice for NFC data transfer to the mDL. The mDL holder may not be aware that the mDL needs to interface with the mDL reader using NFC. On the contrary, if NFC is used for device engagement, this problem does not exist.
NOTE 2	Due to the limited data transfer rate for NFC, if a large amount of data is required for a transaction, it may neither be practical nor reasonable to have an mDL holder hold the device within the RF range of the mDL reader for the duration of the transaction. Furthermore, due to the loss of signal when a device leaves the RF field, any mDL holder interactions with the mDL causing the mDL to leave the RF field require a new transaction to be initiated. This can be avoided by having all mDL holder interactions with the mDL done while the mDL stays in the field or if mDL does not require any mDL holder interactions while it is in the RF field.
6.3.3 Security mechanisms
The security of mDL data exchanged with an mDL reader is designed to preserve the triad of confidentiality, integrity and authenticity by design and by default. 
The security architecture aims to achieve four distinct goals:
a)	Protection against forgery: Data elements are signed by the issuing authority (IA). The degree of protection against forgery depends on the degree to which the IA's keys are protected. Minimizing the validity period of the data limits the value of the data.
b)	Protection against cloning: The mDL produces a signature or message authentication code over session data. The private key used to authenticate the session data is stored only in the mDL. The corresponding public key in turn is signed by the IA. The degree of protection against cloning depends on the degree to which the mDL authentication key or the TLS server key is protected.
c)	Protection against eavesdropping: Communications between mDL and mDL reader are encrypted and authenticated. Device engagement uses a separate communication channel to mitigate the risk of Man in the Middle (MITM) attacks. In addition, the mDL reader can detect MITM attacks by validating the anti-cloning signature or message authentication code, which is created using a key for which the public part is signed by the IA in the mobile security object (MSO, see Clause 9.1.2.4). If mdoc reader authentication is used, the mDL can detect MITM attacks before returning any data. Server retrieval uses TLS for encryption to further protect against eavesdropping and MITM attacks.
d)	Protection against unauthorized access: An mDL is protected from unauthorized access by an mDL reader by multiple mechanisms. If device retrieval is used, the encryption key used for communications between the mDL and mDL reader is derived from an ephemeral key pair from both the mDL and mDL reader. The public key of the mDL is shared only through short-range device engagement. This ensures data is only transferred between the mDL and a particular mDL reader. The mDL can optionally authenticate the mDL reader by means of an mDL reader certificate and a signature created by the mDL reader using the corresponding private key. The mDL reader certificate is signed by a certificate authority trusted by the mDL for this purpose. 
	Server retrieval uses a server retrieval token which can be used to ensure that data is only transferred between the IA infrastructure and a particular mDL reader. Moreover, the IA can optionally authenticate the mDL reader by means of TLS Client Authentication.
Revocation of an mDL is out of scope for this document. However, the MSO includes update information and validity time frames which enable the mDL reader to check the freshness of the data. The issuing authority shall define appropriate periods of validity that balance freshness with offline capability, taking into account that a shorter validity period mitigates certain security risks.
Table 3 describes the security mechanisms that can be implemented for each data retrieval interface. For device retrieval, issuer data authentication, session encryption and mdoc authentication shall be implemented. mdoc reader authentication is optional for both device retrieval and server retrieval. For server retrieval, Transport Layer Security (TLS), and JSON Web Signature (JWS) shall be implemented.
Table 4 describes security goals and mechanisms for different data retrieval methods.
When server retrieval is used, the mDL should use one-time server retrieval tokens.
The certificate and CRL profile requirements in Annex B shall be applied.
All certificates issued by an IACA or another CA shall be validated according to Clause 9.3.3.
An mDL reader needs access to the issuing authority's certificate authority (IACA) root certificate to verify issuer data authentication, verify the JWS and perform TLS. One optional method to get access to these certificates is described in Annex C.
See Annex E for additional information on privacy and security.
Table 3 - Security mechanisms
Data retrieval method
Security mechanisms
Reference
Device retrieval
Session encryption
Clause 9.1.1

Issuer data authentication
Clause 9.1.2

mdoc authentication
Clause 9.1.3

mdoc reader authentication
Clause 9.1.4
Server retrieval
TLS
Clause 9.2.1

JWS
Clause 9.2.2

mdoc authentication a
Clause 9.1.3
a   only applicable when the server retrieval token is transferred using device retrieval.
Table 4 - Security goals and mechanisms
Security goal
Functionality
Device retrieval
Server retrieval
Protection against forgery
Authenticate the origin of mDL data
Issuer data authentication
JWS

Verify mDL data has not changed from 
issuing authority
Issuer data authentication
JWS

Verify how up to date the mDL data is
Issuer data authentication
JWS
Protection against cloning
Protect against cloning of mDL/ binding 
mDL data to a specific device
mdoc authentication
mdoc authentication a
Protection against eavesdropping
Preserve confidentiality of mDL data
Session encryption
TLS

Prevent unnoticed alteration of 
communication
Session encryption
mdoc authentication
TLS
Protection against unauthorized access
Prevent unauthorized access of mDL data
Close-range device engagement with session encryption
Close-range device engagement (with session encryption)a

Prevent unauthorized access of mDL data
mdoc reader authenticationb
TLS client authenticationb
 a   only applicable when the server retrieval token is transferred using device retrieval.
 b   optional method
7 mDL data model
7.1 mDL document type and namespace
DocType and NameSpace are used to encapsulate the document type and the space in which the data elements are defined. The two concepts are further defined in Clause 8.3.1.
The doctype for an mDL document shall be "org.iso.18013.5.1.mDL". The number "1" in the document type might be increased in future versions of the standard.
NOTE 1	The document type field follows the following general format: [Reverse Domain].[Domain Specific Extension].  The reverse domain (org.iso) was selected to avoid collisions. This approach can be used to define other doctypes.
If the mDL reader wants to retrieve an mDL, the DocType field in the device retrieval mdoc request or server retrieval mdoc request shall contain the mDL document type. The use of any other value for the DocType field in the device retrieval mdoc request or server retrieval mdoc request is beyond the scope of this document.
The namespace for mDL data defined in Clause 7.2 shall be "org.iso.18013.5.1". The number "1" in the namespace might be increased in future versions of the standard. Wthin this namespace, only data elements defined in Clause 7.2 may be used. To accommodate domestic data, an issuing authority may define its own namespace, as described in Clause 7.2.8.
NOTE 2	The namespace field follows the following general format: [Reverse Domain].[Domain Specific Extension].
7.2 mDL data
7.2.1 Overview
The data elements described in Table 5 belong to namespace "org.iso.18013.5.1", see Clause 7.1.
-	The "Identifier" column is used for DataElementIdentifier in the mdoc request or server request (see Clause 8.3.1).
-	The "Presence" column indicates whether the presence of the element on an mDL is mandatory (M), or optional (O).
NOTE 1	This does not mean that granting access to these elements to an mDL reader is mandatory.
-	The "Encoding format" column indicates how the data elements shall be encoded. "tstr", "uint", "bstr", "bool" and "tdate" are CDDL representation types as defined in RFC 8610. "full-date" shall be implemented according to the additional information tag 1004 for full-date elements as defined in RFC 8943. 
-	When data elements are encoded with JSON for the server retrieval methods, the data elements shall be encoded as specified in RFC 7049, Section 4.1.
-	The following requirements shall apply to dates in mDL data elements unless otherwise indicated and when applicable: 
Dates shall not use fraction of seconds. 
No local offset from UTC shall be used, as indicated by setting the time-offset defined in RFC 3339 to "Z". 
Table 5 - Data elements
Identifier
Meaning
Definition
Presence
Encoding format
family_name
Family name
Last name, surname, or primary identifier, of the mDL holder. 
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
M
tstr
given_name
Given names
First name(s), other name(s), or secondary identifier, of the mDL holder. 
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
M
tstr
birth_date
Date of birth
Day, month and year on which the mDL holder was born. If unknown, approximate date of birth
M
full-date
issue_date
Date of Issue
Date when mDL was issued
M
tdate or full-date
expiry_date
Date of Expiry
Date when mDL expires
M
tdate or full-date
issuing_country
Issuing country
Alpha-2 country code, as defined in ISO 3166-1, of the issuing authority's country or territory
M
tstr
issuing_authority
Issuing authority
Issuing authority name.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
M
tstr
document_number
Licence number
The number assigned or calculated by the issuing authority.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
M
tstr
portrait
Portrait of mDL holder
A reproduction of the mDL holder's portrait. See Clause 7.2.2
M
bstr
driving_privileges
Categories of vehicles/ restrictions/ conditions
Driving privileges of the mDL holder. See Clause 7.2.4
 M
See 7.2.4.
un_distinguishing_sign
UN distinguishing sign
Distinguishing sign of the issuing country according to ISO/IEC 18013-1 Annex F.
If no applicable distinguishing sign is available in ISO/IEC 18013-1, an IA may use an empty identifier or another identifier by which it is internationally recognized. In this case the IA should ensure there is no collision with other IA's.
NOTE 2 This field is added for purposes of the UN conventions on driving licences.
M
tstr
administrative_number
Administrative number
An audit control number assigned by the issuing authority.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
sex
Sex
mDL holder's sex. Values as defined in ISO/IEC 5218.
NOTE 3 This field is equal to the 'gender' fields in ISO/IEC 18013-1 and ISO/IEC 18013-2
O
int
height
Height (cm) a
 mDL holder's height in centimetres
O
uint
weight
Weight (kg) a
mDL holder's weight in kilograms
O
uint
eye_colour
Eye colour
mDL holder's eye colour. The value shall be one of the following: "black", "blue", "brown", "dichromatic", "grey", "green", "hazel", "maroon", "pink", "unknown".
O
tstr
hair_colour
Hair colour
mDL holder's hair colour. The value shall be one of the following: "bald", "black", "blond", "brown", "grey", "red", "auburn", "sandy", "white", "unknown".
O
tstr
birth_place
Place of birth
Country and municipality or state/province where the mDL holder was born.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
resident_address
Permanent place of residence
The place where the mDL holder resides and/or may be contacted (street/house number, municipality etc.).
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
portrait_capture_date
Portrait image timestamp
Date when portrait was taken
O
tdate
age_in_years
Age attestation: How old are you (in years)?
The age of the mDL holder
O
uint
age_birth_year
Age attestation: In what year were you born?
 The year when the mDL holder was born
O
uint
age_over_NN
Age attestation: Nearest "true" attestation above request
See Clause 7.2.5
O
bool
issuing_jurisdiction
Issuing jurisdiction
Country subdivision code of the jurisdiction that issued the mDL as defined in Clause 8, ISO 3166-2. The first part of the code shall be the same as the value for issuing_country.
NOTE 4  This element is intended to be used in cases where the issuing jurisdiction is different from the issuing authority.
O
tstr
nationality
Nationality
Nationality of the mDL holder as two letter country code (alpha-2 code) defined in ISO 3166-1
O
tstr
resident_city
Resident city
The city where the mDL holder lives.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
resident_state
Resident state/province/district
 The state/province/district where the mDL holder lives.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
resident_postal_code
Resident postal code
The postal code of the mDL holder.
The value shall only use latin1b characters and shall have a maximum length of 150 characters.
O
tstr
resident_country
Resident country
The country where the mDL holder lives as two letter country code (alpha-2 code) defined in ISO 3166-1.
O
tstr
biometric_template_xx
Biometric template XX
See Clause 7.2.6
O
bstr
family_name_national_character
Family name in national characters
 The family name of the mDL holder using full UTF-8 character set.
O
tstr
given_name_national_character
Given name in national characters
The given name of the mDL holder using full UTF-8 character set.
O
tstr
signature_usual_mark
Signature / usual mark
Image of the signature or usual mark of the mDL holder, see Clause 7.2.7
O
bstr
Key
Presence:
M  mandatory
O   optional
a   The mDL reader can convert to the local unit of measurement.
b   Latin1 is defined in ISO/IEC 8859-1 as Latin alphabet No. 1
If any data element is returned to the mDL reader, then information necessary to verify that the person presenting the mDL is the mDL holder shall be returned to the mDL reader if that information is requested.
NOTE 5	From the set of data elements with mandatory presence in column "Presence" from Table 5, the portrait of the mDL holder is the only data item for verifying that the person presenting the mDL is the mDL holder.
An mDL may require mdoc reader authentication (see Clause 9.1.4) before releasing data elements not marked as mandatory in Table 5. An mDL shall not require mdoc reader authentication as a precondition for the release of any of the mandatory data elements. An mDL may offer functionality to the mDL holder to pre-authorize the release of mandatory data elements selected by the mDL holder to mDL readers using mdoc reader authentication.
NOTE 6	The intention of these requirements is that the mDL holder is always able to use the mDL as a driving licence if the mDL holder chooses to do that, including when an mDL reader does not use mdoc reader authentication.
When device retrieval is used, the "issue_date" data element shall not be after the validFrom element as defined in Clause 9.1.2.4.
When server retrieval is used, the "issue_date" data element shall not be after the iat claim as described in Clause 8.3.2.2.2.2 and Clause 8.3.3.2.2. 
If the mDL reader retrieved the "issuing_country" data element, it shall verify that the value of that element matches the countryName element in the subject field within the DS certificate or the JWS certificate (see Annex B).
If device retrieval is used, if the mDL reader retrieved the "issuing_jurisdiction" data element, it shall verify that the value of that element matches the stateOrProvinceName element in the subject field within the DS certificate (see Annex B). This is only required if the stateOrProvinceName element is present in the DS certificate. 
 
If device retrieval is used, any element in Table 5 that is returned by the mDL shall be returned as part of the IssuerSignedItems. Domestic data elements (see Clause 7.2.8) may be returned in either IssuerSignedItems or DeviceSignedItems.
NOTE 7	Issuing authorities have the responsibility to ensure that controls to prevent the unintended release of mDL data are implemented, including providing mDL holders with the means to control what data is released.
7.2.2 Portrait of mDL holder
The portrait of mDL holder consists of one portrait image and shall follow the requirements on the face image as specified in ISO/IEC 18013-2:2020, Annex D. One of the following image formats shall be used: JPEG or JPEG2000. The image data shall be encoded as binary data.
7.2.3 Issuing authority
The issuing authority element identifies the administrative authority entitled to issue the driving licence, or the issuing country if separate licensing authorities have not been authorised. The issuing authority element is represented by a string.
NOTE	The contents of this field correspond to the contents of the issuing authority element on the IDL, and can indicate a local, regional or national organisation. Note that, like in ISO/IEC 18013-1, the term issuing authority can also refer to a central government agency, acting on behalf of multiple local or regional Issuing authorities.
7.2.4 Categories of vehicles/restrictions/conditions
The categories of vehicles/restrictions/conditions contain information describing the driving privileges of the mDL holder. The definition of the elements in the DrivingPrivilege structure can be found in ISO/IEC 18013-1:2018, Clause 5. The possible values for the elements are defined in ISO/IEC 18013-2:2020, Annex A.
NOTE 1	Regardless of driving privileges' status, other mDL data elements can be used for identification purposes as described by this document.
The driving privileges structure shall be encoded as CBOR for device retrieval and JSON for server retrieval and formatted as follows:
DrivingPrivileges = [
    * DrivingPrivilege
]

DrivingPrivilege = {
    "vehicle_category_code" : tstr      ; Vehicle category code as per ISO 18013-2 Annex A
    ? "issue_date" : full-date          ; Date of issue encoded as full-date
    ? "expiry_date" : full-date         ; Date of expiry encoded as full-date
    ? "codes" : [+Code]                 ; Array of code info
}

Code = {
    "code": tstr                        ; Code as per ISO/IEC 18013-2 Annex A
    ? "sign": tstr                      ; Sign as per ISO/IEC 18013-2 Annex A
    ? "value": tstr                     ; Value as per ISO/IEC 18013-2 Annex A
}


NOTE 2	The DrivingPrivileges structure can be an empty array
Full-date is defined in Clause 7.2.1
An example can be found in Annex D.2.1.
7.2.5 Age attestation: nearest "true" attestation above request
This set of elements is used to convey to an mDL verifier, in a data-minimized fashion, if the mDL holder is as old or older than a specified age, or if the mDL holder is younger than a specified age. To achieve this, the mDL contains age attestation identifiers. An age attestation identifier has the format age_over_NN where NN is a value from 00 to 99.  The value of an age attestation identifier can be TRUE or FALSE.
When an mDL verifier includes age_over_NN in a request, it has the meaning of "provide the nearest age attestation equal to or larger than NN with value TRUE, or smaller than NN with value FALSE". More specifically, after receiving an age_over_NN request, the logic to determine the appropriate response shall be equivalent to the following:
1. For all age attestations of the form age_over_nn stored on the mDL, consider all the attestations with value TRUE.  From among these attestations, check if an attestation exists where nn is equal to or larger than NN.  If one and only one such attestation exists, this is the response.  If more than one such attestation exists, the response shall be the attestation with the smallest difference between nn and NN.
2. If step 1 does not produce a response, for all age attestations of the form age_over_nn stored on the mDL, consider all the attestations with  value FALSE.  From among these attestations, check if an attestation exists where nn is equal to or smaller than NN.  If one and only one such attestation exists, this is the response.  If more than one such attestation exists, the response shall be the attestation with the smallest difference between NN and nn.
3. If step 2 does not produce a response, no age_over_nn data element shall be returned. 
In case of device retrieval, the value of an age_over_NN data element shall be valid at the value of the timestamp in the validFrom element in the MSO from Clause 9.1.2.4.
In case of server retrieval, the value of an age_over_NN data element shall be valid at the value of the iat timestamp as defined in Clause 8.3.2.2.2.2 and 8.3.3.2.2.
An mDL reader shall not include more than two age_over_NN statements in a device retrieval or server retrieval mdoc request.
Examples of requests and responses and their meaning can be found in Annex D.2.2.
NOTE 1	Including more rather than less age_over_NN statements in an mDL has the following consequences, both of which are beneficial from a privacy perspective:
1.	When an mDL does not respond to an age_over_NN request, the most likely next step of a verifier will be to ask for the mDL holder's date of birth.  This would be the only remaining way in which the original business question could be answered. Including additional age_over_NN statements decrease the probability of a no response response.
2.	Given the question "are you older than 18", the response "I am older than 21" and the response "I am older than 60" would both answer the question.  However, the response "I am older than 21" is considered better from a privacy point of view, since the statement is closer to the request.  Including additional age_over_NN statements will on average decrease the difference between the requested age and the response age.
Including more rather than less age_over statements in a mDL on the other hand could allow a verifier to gain a more accurate estimate of a person's true age, if for whatever reason such a verifier chooses not to ask directly for the mDL holder's date of birth.  This would require repeated requests.
NOTE 2	A request can include two age statements to support effectively asking whether the age of the mDL holder falls within a certain range.
NOTE 3	An mDL may not have an age_over_NN element available to respond to the request from the mDL reader. If an mDL reader does not receive an age_over_NN response, the mDL reader has the option of making another request with different data elements that fulfill the requirements that it has. Examples of these are 'age_in_years' and 'birth_date'.
7.2.6 Biometric template
This element contains optional facial, fingerprint, iris or other biometric information of the mDL holder. Biometric information is encoded according to the biometric template defined in Table 6 and in Appendix C.6.7 of ISO/IEC 18013-2:2020. However, the first tag in Table C.11 ('75' for Facial, '63' for Finger, '76' for Iris, etc ) shall be omitted. The value of the biometric_template_xx data element shall therefore start with tag '7F 61'. A biometric template identifier has the format biometric_template_xx where xx shall be replaced with the corresponding "Abstract value name" found in Table 7, ISO/IEC 19785-3:2020, according to the following convention: capitalized characters are replaced with their lowercase equivalent and spaces or non-alphanumeric characters are replaced by underscores (_).   
EXAMPLE: the "FACE" template corresponds to "biometric_template_ face" and the "SIGNATURE/SIGN" template corresponds to "biometric_template_signature_sign".     
If the biometric_template_face is used, the biometric data block (tag '5F 2E') shall contain a JPEG or JPEG2000 format, as specified in Clause 7.2.2.
7.2.7 Signature or usual mark
The signature or usual mark of the mDL holder consists of one image. One of the following image formats shall be used: JPEG or JPEG2000. The image data shall be encoded as binary data.
7.2.8 Domestic data elements
Domestic data are data elements which are not specified in this document. An issuing authority may specify its own data elements within its namespace. Since the namespace for mDL data in this document is "org.iso.18013.5.1", the issuing authority infrastructure should use country-specific or issuer-specific namespaces by appending the ISO 3166-1 alpha-2 country code or the ISO 3166-2 region code after a period.
EXAMPLE	The United States namespace would be "org.iso.18013.5.1.US" and the Iowa namespace would then be "org.iso.18013.5.1.US-IA".
7.3 Country codes
Throughout this document, unless when stated otherwise, ISO 3166-1 shall be used as a source for country code identifiers. If no applicable country code is available in ISO 3166-1, an IA may use one of the user-assigned country code elements, as indicated in ISO 3166-1 or another identifier by which it is internationally recognized. In these cases the IA should ensure there is no collision with other IAs.
8 Transaction
8.1 Encoding of data structures and data elements
In this document CDDL (Concise Data Definition Language) as specified in RFC 8610 is used to express CBOR and JSON-encoded data structures. 
CBOR structures shall be encoded according to RFC 7049. JSON structures shall be encoded according to RFC 8259.
RFC 7049, section 3.9 describes four rules for canonical CBOR. Three of those rules shall be implemented for all CBOR structures as follows:
-	Integers (major types 0 and 1) must be as small as possible.
-	The expression of lengths in major types 2 through 5 must be as short as possible.
-	Indefinite-length items must be made into definite-length items.
The fourth rule regarding sorting of map keys is not required. Furthermore, maps (major type 5) shall not have multiple entries with the same key.
Because canonical map ordering is not required, all CBOR maps that are used in a cryptographic operation are communicated in a tagged CBOR bytestring. For any cryptographic operation, an mdoc, mdoc reader or issuing authority infrastructure shall use these bytestrings as they were sent or received, without attempting to re-create them from the underlying maps.
EXAMPLE	A data structure DataItem that is to be used in a cryptographic operation is communicated in a structure DataItemBytes, specified as follows:
DataItemBytes = #6.24(bstr .cbor DataItem)
The CDDL in this example is defined in RFC 8610, section 3.6 and expresses a tagged data item (major type 6). As specified in RFC 7049, section 2.4, tag value 24 indicates that the content of the CBOR bstr following the tag is itself a CBOR data item. The .cbor control operator indicates that this data item is in fact a DataItem.
When processing a data structure, an mdoc, mdoc reader or issuing authority infrastructure shall ignore any value that is specified as RFU in this document. 
Whenever data structures in this document use a version element that is encoded as a string, their contents follow the format of 'major version number'.'minor version number'. A major version number shall be incremented by 1 when any backwards incompatible changes are introduced. In a future version of this document. A minor version number shall be incremented by 1 when new, but backwards compatible functionality is introduced. A minor version number shall be reset to 0 if the major version number is incremented. An mdoc, mdoc reader or issuing authority infrastructure shall not give an error and continue a transaction if it receives a data structure having a known major version number but with an unknown minor version number.

8.2 Device engagement
8.2.1 Device engagement information
8.2.1.1 Device engagement structure 
The device engagement structure contains information to perform device engagement. The device engagement structure shall be CBOR encoded and formatted as follows:
DeviceEngagement =
{
    0: tstr,            ; Version
    1: Security,
    ? 2: DeviceRetrievalMethods,
    ? 3: ServerRetrievalMethods,
    ? 4: ProtocolInfo,
    * int => any
}

Security = [
    int,               ; Cipher suite identifier
    EDeviceKeyBytes
]

DeviceRetrievalMethods = [
    + DeviceRetrievalMethod
]

ServerRetrievalMethods = {
    ?"webApi" : WebApi,
    ?"oidc" : Oidc
}

ProtocolInfo = any      ; The use of ProtocolInfo is RFU

DeviceRetrievalMethod = [
    uint,               ; Type
    uint,               ; Version
    RetrievalOptions    ; Specific option(s) to the type of retrieval method
]

RetrievalOptions = WifiOptions / BleOptions / NfcOptions / any  ; The any option is RFU


The device engagement structure contains the following key-value pairs:
0. Version: the version of the device engagement structure, in the current version of this document its value shall be "1.0".
1. Security: an array that contains two mandatory elements. The first element is the cipher suite identifier, defined in Clause 9.1.5.2. The second element is EdeviceKeyBytes, defined in Clause 9.1.1.4.  
2. DeviceRetrievalMethods: an array that shall contain one or more DeviceRetrievalMethod arrays when performing device engagement using the QR code. When using NFC to perform device engagement, the DeviceRetrievalMethods array shall be absent, because the data retrieval methods supported by the mdoc are specified in the Alternative Carrier Records, as specified in Clause 8.2.2.1. DeviceRetrievalMethods lists the device retrieval methods supported by the mdoc. A DeviceRetrievalMethod array holds two mandatory values (type and version). The first element defines the type and the second element the version for the transfer method. The optional RetrievalOptions element may contain extra info  for each connection. The values for the different RetrievalOptions are defined in Clause 8.2.2.3.
3. ServerRetrievalMethods: an array that contains optional information on the server retrieval methods supported by the mdoc. The values for the different server retrieval methods are defined in Clause 8.2.1.2. If the ServerRetrievalMethods is present, the array shall contain webApi, oidc, or both.
4. ProtocolInfo: to ensure the DeviceEngagement remains applicable to future solutions and updates, the contents of the ProtocolInfo is RFU in consideration for defining protocol information.
The following requirements apply for additional key-value pairs within the device engagement structure: positive integers for keys are RFU. An application-specific extension shall use a negative integer for the key. An mdoc or mdoc reader shall ignore any key-value pairs with a negative key value that it is not able to interpret.
An example of a device engagement structure can be found in Annex D.3.1.
8.2.1.2 Server retrieval information
Setting up server retrieval requires the mdoc to provide the server retrieval information to the mdoc reader to facilicate the mdoc reader's use of the server retrieval method. 
The server retrieval information can be transferred as part of the device engagement structure or as a data element during device retrieval:
* If the server retrieval information is transferred as part of device engagement, the Oidc and/or WebApi structures shall be transferred as part of ServerRetrievalMethods in the device engagement structure (see Clause 8.2.1.1).
* If the server retrieval information is transferred as part of device retrieval, the Oidc and/or WebApi structures shall be transferred as data elements in the device retrieval mdoc response as defined in Clause 8.3.2.1.2.2. They shall be returned in either IssuerSignedItems or DeviceSignedItems. The Oidc structure shall have the data element identifier "webapi_info". The WebApi structure shall have the data element identifier "oidc_info". The namespace of these data elements shall be "org.iso.18013.5.1".
If the mdoc reader wants to use server retrieval, it shall request the "webapi_info" or "oidc_info" data elements as a part of the device retrieval mdoc request. The mdoc reader may also do this if the mdoc already included the server retrieval information in the device engagement structure.
If the server retrieval information is transferred during device retrieval, its authenticity is protected by either issuer data authentication (Clause 9.1.2) or mdoc authentication (Clause 9.1.3). If the server retrieval information is transferred in the device engagement structure, it is not protected. Therefore, the IA is responsible for the server retrieval token sent in the device engagement structure to authorize the request as part of the transaction by or on behalf of the mdoc holder.
The structures that contain the server retrieval information shall be encoded as CBOR and formatted as follows:
Oidc = [
    uint,   ; Version
    tstr,   ; Issuer URL
    tstr    ; Server retrieval token
]

WebApi = [
    uint,   ; Version
    tstr,   ; Issuer URL
    tstr    ; Server retrieval token
] 


Both arrays consist of three fields: the version, the issuer URL and the server retrieval token. The version indicates the version of the transfer methods, currently 1 for both OIDC and WebAPI. The URL and the server retrieval token field are further defined in Clause 8.3.2.2.
8.2.2 Device engagement transmission technology
8.2.2.1 Device engagement using NFC
Device engagement using NFC shall follow the Connection Handover protocol as defined by NFC Forum, Connection Handover (CH) Technical Specification, Version 1.5. Only Reader/Writer mode using the Type 4 Tag shall be used. The Connection Handover protocol shall be initiated by the mdoc reader. The mdoc reader shall take the role of Handover Requester. The mdoc shall be the NFC Tag Device and the mdoc reader shall be the NFC Reader Device. The mdoc shall use either Static Handover or Negotiated Handover.
When Static Handover is used, the Handover Select Message shall be retrieved by the mdoc reader from the mdoc in a Type 4 Tag and shall contain at least one Alternative Carrier Record. Each Alternative Carrier Record shall indicate a device retrieval method the mdoc supports. An mdoc reader shall select one of the transmission technologies from the ones provided in the Alternative Carrier  Records. 
When Negotiated Handover is used, the mdoc shall include the "urn:nfc:sn:handover" service in a Service Parameter record in the Initial NDEF message provided to the mdoc reader. The mdoc reader shall send a Handover Request Message to the mdoc after the it has selected this service. The Handover Request Message shall contain an Alternative Carrier Record for each alternative carrier that is supported by the mdoc reader. The mdoc confirms the handover by providing a Handover Select Message containing exactly one selected alternative carrier.
NOTE	Use of Negotiated Handover for device engagement allows negotiation of transfer methods. For BLE and Wi-Fi Aware, it additionally allows negotiation of keys used by the transmission layer. This can provide better user experience and security of data transmission.
For the BLE device retrieval transmission technology, the contents of the Alternative Carrier Record and Carrier Configuration Record(s) shall comply with Clause 8.3.3.1.1.2. 
For the NFC device retrieval transmission technology, the contents of the Alternative Carrier Record and Carrier Configuration Record(s) shall comply with Clause 8.2.2.2.
For the Wi-Fi Aware device retrieval transmission technology, the contents of the Alternative Carrier Record and Carrier Configuration Record(s) shall comply with the Wi-Fi Alliance Neighbor Awareness Networking Specification, version 3.1, section 12.
The DeviceEngagement structure as defined in Clause 8.2.1.1 shall be transferred from the mdoc to the mdoc reader as part of an auxiliary data record of the Handover Select Message with the type "iso.org:18013:deviceengagement" and the ID reference "mdoc", with type name format NFC Forum external type (0x04). For each ac record, "Auxiliary Data Reference" points to the NDEF record which contains the device engagement structure.
When Negotiated Handover is used, the mdoc reader may sent a ReaderEngagement structure to the mdoc as part of an auxiliary data record of the Handover Request Message with the type "iso.org:18013:readerengagement" and the ID reference "mdocreader", with type name format NFC Forum external type (0x04), to provide information from the mdoc reader to the mdoc.
The reader engagement structure shall be CBOR encoded and formatted as follows:
ReaderEngagement =
{
    0: tstr,            ; Version
    * int => any
}

The  reader engagement structure contains the following key-value pairs:
0. Version: the version of the reader engagement structure. In the current version of this document its value shall be "1.0"
This document does not define any other key-value pairs for use in ReaderEngagement. The following requirements apply for additional key-value pairs within the reader engagement structure: positive integers for keys are RFU. An application-specific extension shall use a negative integer for the key. An mdoc or mdoc reader shall ignore any key-value pairs with a negative key value that it is not able to interpret.

8.2.2.2 Alternative Carrier Record for device retrieval using NFC
The Alternative Carrier Record for the NFC device retrieval transmission technology shall reference the Carrier Configuration Record with the ID reference "nfc".
The Carrier Configuration Record for NFC device retrieval transmission technology shall have the type "iso.org:18013:nfc" and the ID reference "nfc". The binary content of the Carrier Configuration Record shall be encoded according to Table 6.
Table 6 - Binary content of the Carrier Configuration Record for NFC device retrieval
Field
Size (Octet)
Sub-Field
Value
Presence
Version
1

0x01
Mandatory
Maximum command data length
1
Length
Variable
Conditional

1
Data Type
0x01


Variable
Maximum command data length
See Clause 8.3.3.1.2

Maximum response data length
1
Length
Variable
Conditional

1
Data Type
0x02


Variable
Maximum response data length
See Clause 8.3.3.1.2

The version field is the mdoc NFC Connection Handover Version encoded as an unsigned integer. This is a mandatory field.
The maximum command data length field is the maximum length of command data field encoded as an unsigned integer. This field is further defined in Clause 8.3.3.1.2. This field is mandatory for the mdoc and shall not be used by the mdoc reader.
The maximum response data length field is the maximum length of response data field encoded as an unsigned integer. This field is further defined in Clause 8.3.3.1.2. This field is mandatory for the mdoc and shall not be used by the mdoc reader.
8.2.2.3 Device engagement using QR code
If QR code is used for device engagement, the device engagement structure shall be transmitted as a barcode compliant with ISO/IEC 18004. The QR code shall contain a URI with "mdoc:" as scheme and the DeviceEngagement structure specified in Clause 8.2.1.1 encoded using base64url-without-padding, according to RFC 4648, as path. 
NOTE	The requirements above result in the content of the QR code as "mdoc:" followed by the base64url-without-padding encoded device engagement structure.
An mdoc reader shall select one of the transmission technologies from the ones provided in the device engagement structure.
Table 7 defines the values that shall be used for the DeviceRetrievalMethod structure. Any other DeviceRetrievalMethod type is RFU.
Table 7 - DeviceRetrievalMethod parameters

NFC
BLE
Wi-Fi Aware
type
1
2
3
version
1
1
1
options
NfcOptions
BleOptions
WifiOptions

The WifiOptions, BleOptions and NfcOptions structures shall be formatted as follows. Other RetrievalOptions are RFU.
WifiOptions = {
    ? 0: tstr,      ; Pass-phrase Info Pass-phrase
    ? 1: uint,      ; Channel Info Operating Class
    ? 2: uint,      ; Channel Info Channel Number
    ? 3: bstr       ; Band Info Supported Bands
}

BleOptions = {
    0 : bool,       ; Indicates support for mdoc peripheral server mode
    1 : bool,       ; Indicates support for mdoc central client mode
    ? 10 : bstr,    ; UUID for mdoc peripheral server mode
    ? 11 : bstr     ; UUID for mdoc client central mode
}

NfcOptions = {
    0 : uint,       ; Maximum length of command data field
    1 : uint        ; Maximum length of response data field
}


The contents of these fields are further defined in Clause 8.3.3.1.1, Clause 8.3.3.1.2 and Clause 8.3.3.1.3.  
8.2.3 Device engagement time-out
If the mdoc reader implements a time-out for the time between the transaction initialization and receiving device engagement data, the time-out should be no less than 30 seconds. The mdoc verifier may terminate the session at any time.
If the mdoc or mdoc reader implements a time-out for the time between receiving or sending device engagement data and sending or receiving the session establishment message (see Clause 9.1.1.4), the time-out should be no less than 30 seconds. The mdoc holder and mdoc verifier may terminate the session at any time.
8.3 Data retrieval
8.3.1 Data model
The document type that is requested by an mdoc reader or returned by an mdoc or IA infrastructure is encapsulated in the DocType parameter.
NOTE 1	There is no requirement for the DocType format. An approach to avoid collisions is to use the following general format: [Reverse Domain].[Domain Specific Extension]. 
The NameSpace parameter provides the namespace within which the data elements requested by the mdoc reader or returned by the mdoc are defined. A document may contain data elements from multiple namespaces. The meaning of data elements is dependent on their namespace.
NOTE 2	There is no requirement for the namespace format. An approach to avoid collisions is to use the following general format: [Reverse Domain].[Domain Specific Extension].
The CDDL definitions for DocType, NameSpace, DataElementIdentifier and DataElementValue are common across different data retrieval methods and the applicable security mechanisms. The following CDDL definitions shall be applied to the CDDL structures defined in Clause 8 and Clause 9:
DocType = tstr
NameSpace = tstr
DataElementIdentifier = tstr    ; Data element identifier
DataElementValue = any          ; Data element value

8.3.2 Data retrieval methods
8.3.2.1 Device retrieval
8.3.2.1.1 General
The mdoc request and mdoc response messages are defined in Clause 8.3.2.1.2. They are encrypted and subsequently included in a session establishment or session data message, see Clause 9.1.1. These session establishment and session data messages are then transferred using one of the device retrieval transmission methods specified in Clause 8.3.3.1.1, Clause 8.3.3.1.2 or Clause 8.3.3.1.3.
8.3.2.1.2 Message structures
8.3.2.1.2.1 Device retrieval mdoc request
The device retrieval mdoc request structure shall be CBOR encoded and formatted as follows:
DeviceRequest = {
    "version" : tstr,                   ; Version of DeviceRequest structure
    "docRequests" : [+ DocRequest]      ; Requested documents
}

DocRequest = {
    "itemsRequest" : ItemsRequestBytes,
    ? "readerAuth" : ReaderAuth         ; mdoc reader authentication
}

ItemsRequestBytes = #6.24(bstr .cbor ItemsRequest)

ItemsRequest = {
    "docType" : DocType,                ; Document type requested
    "nameSpaces" : NameSpaces,
    ? "requestInfo" : {* tstr => any}   ; Additional information
}

NameSpaces = {
    + NameSpace => DataElements         ; Requested data elements for each NameSpace
}

DataElements = {
    + DataElementIdentifier => IntentToRetain   ; Requested data element identifiers
                                                ; with intent to retain values
}

IntentToRetain = bool

 

The version for the DeviceRequest structure, in the current version of this document its value shall be "1.0". If other versions are specified in the future, the major version (see Clause 8.1) of a DeviceRequest structure shall not be higher than the major version of the device engagement structure (see Clause 8.2.1.1) communicated by the mdoc in the same transaction.
docRequests contains an array of all requested documents. 
ItemRequestBytes contains the ItemsRequest structure as a tagged CBOR bytestring.
ReaderAuth is used for mdoc reader authentication as defined in Clause 9.1.4.
docType is the requested document type.
requestInfo may be used by the mdoc reader to provide additional information. This document does not define any key-value pairs for use in requestInfo. An mdoc shall ignore any key-value pairs that it is not able to interpret.
NameSpaces contains the requested data elements and the namespace they belong to.
DataElements contains the requested data elements identified by their data element identifier. For each requested data element, the IntentToRetain variable indicates whether the mdoc verifier intends to retain the received data element. The mdoc verifier shall not retain any data, including digests and signatures, or derived data received from the mdoc, except for data elements for which the IntentToRetain flag was set to true in the request. To retain is defined as "to store for a period longer than necessary to conduct the transaction in realtime".
The mdoc shall ignore all unknown data elements in a device retrieval mdoc request when processing the request.
An example of an device retrieval mdoc request can be found in Annex D.4.1.1.
8.3.2.1.2.2 Device retrieval mdoc response
The device retrieval mdoc response shall shall be CBOR encoded and formatted as follows:
DeviceResponse = {
    "version" : tstr,                   ; Version of the DeviceResponse structure
    ? "documents" : [+Document],        ; Returned documents
    ? "documentErrors": [+DocumentError]; For unreturned documents, optional error codes
    "status" : uint                     ; Status code
}

Document = {
    "docType" : DocType,                ; Document type returned
    "issuerSigned" : IssuerSigned,      ; Returned data elements signed by the issuer
    "deviceSigned" : DeviceSigned,      ; Returned data elements signed by the mdoc
    ? "errors" : Errors
}

DocumentError = {
    DocType => ErrorCode                ; Error codes for unreturned documents
}

IssuerSigned = {
    ? "nameSpaces" : IssuerNameSpaces,  ; Returned data elements
    "issuerAuth" : IssuerAuth           ; Contains the mobile security object (MSO)
                                        ; for issuer data authentication
}


IssuerNameSpaces = {                    ; Returned data elements for each namespace
    + NameSpace => [ + IssuerSignedItemBytes ]
}

IssuerSignedItemBytes = #6.24(bstr .cbor IssuerSignedItem)

IssuerSignedItem = {
    "digestID" : uint,                  ; Digest ID for issuer data authentication
    "random" : bstr,                    ; Random value for issuer data authentication
    "elementIdentifier" : DataElementIdentifier,    ; Data element identifier
    "elementValue" : DataElementValue   ; Data element value
}

DeviceSigned = {
    "nameSpaces" : DeviceNameSpacesBytes,   ; Returned data elements
    "deviceAuth" : DeviceAuth               ; Contains the device authentication
                                            ; for mdoc authentication
}

DeviceNameSpacesBytes = #6.24(bstr .cbor DeviceNameSpaces)

DeviceNameSpaces = {
    * NameSpace => DeviceSignedItems    ; Returned data elements for each namespace
}

DeviceSignedItems = {
    + DataElementIdentifier => DataElementValue   ; Returned data element identifier and value
}

DeviceAuth = {          ; Either signature or MAC for mdoc authentication
    "deviceSignature" : DeviceSignature, //     ; "//" means or
    "deviceMac" : DeviceMac
}

Errors = {
    + NameSpace => ErrorItems               ; Error codes for each namespace
}

ErrorItems = {
    + DataElementIdentifier => ErrorCode    ; Error code per data element
}

ErrorCode = int                             ; Error code


 
version is the version for the DeviceResponse structure. In the current version of this document its value shall be "1.0". If other versions are specified in the future, the major version (see Clause 8.1) of a DeviceResponse structure shall not be higher than the major version of the device engagement structure (see Clause 8.2.1.1) communicated by the mdoc in the same transaction. The major version of a DeviceResponse structure shall also not be higher than the major version of the mdoc request (see Clause 8.3.2.1.2.1) to which it is a response.
documents contains an array of all returned documents. documentErrors can contain error codes for documents that are not returned. status contains a status code according to Clause 8.3.2.1.2.3.
In the Document structure, the document type of the returned document is indicated by the docType element. The document type shall match the document type as indicated in the issuer data authentication (see Clause 9.1.2) and mdoc authentication structures (see Clause 9.1.3). errors can contain error codes for data elements that are not returned. 
IssuerSigned contains the mobile security object for issuer data authentication and the data elements protected by issuer data authentication. nameSpaces contains the the returned data elements as part of their corresponding namespaces. 
The IssuerAuth structure is defined in Clause 9.1.2.3.
Individual data elements are returned as IssuerSignedItem. The digestID and random are defined in Clause 9.1.2.5. elementIdentifier is the data element identifier and elementValue the data element value. Each IssuerSignedItem is returned as part of the corresponding namespace in the IssuerNameSpaces structure. The mdoc shall not include two or more IssuerSignedItem elements with the same DataElementIdentifier in a single NameSpace and Document.
DeviceSigned contains the mdoc authentication structure and the data elements protected by mdoc authentication. nameSpaces contains the returned data elements as part of their corresponding namespaces. nameSpaces is a mandatory element because the element is authenticated using mdoc authentication. The DeviceNameSpaces structure can be an empty structure. The DeviceAuth structure contains either the DeviceSignature or the DeviceMac element, both are defined in Clause 9.1.3.
DeviceSignedItems contains the data element identifiers and values. DeviceSignedItems is returned as part of the corresponding namespace in DeviceNameSpaces.
If the mdoc device response structure does not include some data element or document requested in the mdoc device request, an error code may be returned as part of the documentErrors or errors structures.
If present, ErrorCode shall contain an error code according to Clause 8.3.2.1.2.3
An example of an mdoc response can be found in Annex D.4.1.2
8.3.2.1.2.3 mdoc response status and error codes
The status element shall contain one of the status codes in Table 8.
Table 8 - Response status
Status  code
Status 
message
Description
Actions required
0
OK
Normal processing. This status message shall be returned if no other status is returned
No specific action required
10
General error
The mdoc returns an error without any given reason. No data is returned.
The mdoc reader may inspect the problem. The mdoc reader may continue the transaction.
11
CBOR decoding error
The mdoc indicates an error during CBOR decoding that the data received is not valid CBOR. Returning this status code is optional. 
The mdoc reader may inspect the problem. The mdoc reader may continue the transaction.
12
CBOR validation error
The mdoc indicates an error during CBOR validation, e.g. wrong CBOR structures. Returning this status code is optional.
The mdoc reader may inspect the problem. The mdoc reader may continue the transaction.

If present, the ErrorCode element shall contain an error code from Table 9. An ErrorCode is specific to the document or data element requested within a namespace. 
Table 9 - Data handling error
Error code
Error code 
message
Description
0
Data not returned
The mdoc does not provide the requested document or data element without any given reason. This element may be used in all cases.
Other positive integers
See description
RFU
Negative integers
See description
These error codes may be used for application specific purposes

8.3.2.2 Server retrieval
8.3.2.2.1 General
Data retrieval using server retrieval shall make use of WebAPI or OIDC. Clause 8.3.2.2.2 specifies the structures of server retrieval mdoc requests and server retrieval mdoc responses for WebAPI. The messages structures for WebAPI are transferred using the server data retrieval transmission method specified in Clause 8.3.3.2.1. Clause 8.3.3.2.2 specifies the server data retrieval transmission method for OIDC.
The mdoc is identified by the issuing authority infrastructure using the server retrieval token as provided by the mdoc reader (see Clause 8.2.1.2). The information encoded in the server retrieval token is outside of the scope of this document.
NOTE 1	The server retrieval token can contain information about which data is to be provided to the mdoc reader. The issuing authority infrastructure can use a separate interface with the mdoc to retrieve information about which data is to be provided to the mdoc reader.
NOTE 2	The issuing authority infrastructure is involved in each server retrieval-based transaction; therefore, the issuing authority knows when an mdoc is used and what data is shared. If tracking is a concern, the issuing authority can implement mitigating strategies to ensure the mdoc and the mdoc holder are not tracked.
8.3.2.2.2 WebAPI structures
8.3.2.2.2.1 Server retrieval mdoc request
The server retrieval mdoc request shall be JSON encoded and formatted as follows:
ServerRequest = {
    "version" : tstr,                   ; Version of the structure
    "token" : tstr,                     ; Server retrieval token
    "docRequests" : [+ ItemsRequest]    ; Requested documents
}

ItemsRequest = {
    "docType" : DocType,                ; Document type requested
    "nameSpaces" : NameSpaces,
    ? "requestInfo" : {* tstr => any}   ; Additional information
}

NameSpaces = {
    + NameSpace => DataElements         ; Requested data elements for each NameSpace
}

DataElements = {
    + DataElementIdentifier => IntentToRetain   ; Requested data element identifiers
                                                ; with intent to retain values
}

IntentToRetain = bool


 
The version for the ServerRequest structure, in the current version of this document its value shall be "1.0". If other versions are specified in the future, the major version (see Clause 8.1) of a ServerRequest structure shall not be higher than the major version of the device engagement structure (see Clause 8.2.1.1) communicated by the mdoc in the same transaction.
Token shall contain the server retrieval token (see Clause 8.2.1.2) which identifies the mdoc.
docRequests contains an array of all requested documents. 
docType is the requested document type.
requestInfo may be used by the mdoc reader to provide additional information. This document does not define any key-value pairs for use in requestInfo. An IA infrastructure shall ignore any key-value pairs that it is not able to interpret.
NameSpaces contains the requested data elements and the namespace they belong to.
DataElements contains the requested data elements identified by their data element identifier. For each requested data element, the IntentToRetain variable indicates whether the mdoc verifier intends to retain the received data element. The mdoc verifier shall not retain any data, including digests and signatures, or derived data received from the mdoc, except for data elements for which the IntentToRetain flag was set to true in the request. To retain is defined as "to store for a period longer than necessary to conduct the transaction in realtime".
The IA infrastructure shall ignore all unknown data elements in a server retrieval mdoc request when processing the request.
An informative example of a server retrieval mdoc request can be found in Annex D.4.2.1.1
8.3.2.2.2.2 Server retrieval mdoc response
The server retrieval mdoc response shall be JSON encoded and shall be formatted as follows:
ServerResponse = {
    "version" : tstr,                   ; Version of the structure
    ? "documents" : [+JWT],             ; Returned documents
    ? "documentErrors": [+DocumentError]; For unreturned documents, optional error codes
}

JWT = tstr                              ; JWT with JWTClaimsset as JWT Claims Set

JWTClaimsset = {
    "doctype" : DocType,                ; Document type returned
    "namespaces" : NameSpacesResponse,
    ? "errors" : Errors,
    * tstr => any                       ; Registered claims
}

NameSpacesResponse = {
    + NameSpace => DataElementsValues   ; Returned data elements for each namespace
}

DataElementsValues = {
    + DataElementIdentifier => DataElementValue
}

DocumentError = {
    DocType => ErrorCode                ; Error codes for unreturned documents
}

Errors = {
    + NameSpace => ErrorItems               ; Error codes for each namespace
}

ErrorItems = {
    + DataElementIdentifier => ErrorCode    ; Error code per data element
}

ErrorCode = int                             ; Error code



version is the version for the ServerResponse structure: in the current version of this document its value shall be "1.0". If other versions are specified in the future, the major version (see Clause 8.1) of a ServerResponse structure shall not be higher than the major version of the device engagement structure (see Clause 8.2.1.1) communicated by the mdoc in the same transaction. The major version of a ServerResponse structure shall also not be higher than the major version of the server request (see Clause 8.3.2.2.2.1) to which it is a response.
documents contains an array of all returned documents. Each document shall be returned as a JSON Web Token (JWT), as specified in RFC 7519. The claims conveyed by each JWT are in JWTClaimsSet. The JWT is protected using a JSON Web Signature (JWS) as specified in Clause 9.2.2. 
documentErrors can contain error codes for documents that are not returned.
doctype is the returned document type.
NameSpacesResponse contains the returned mdoc data elements as part of their namespace. DataElementsValues contains the data element identifiers and the corresponding data element values.
errors can contain error codes for data elements that are not returned. 
In addition to the doctype, namespaces and errors claims, also any registered claims (see RFC 7519) can be returned as part of JWTClaimsSet. Whenever any mdoc data is sent to an mdoc reader, the following registered claims shall be present in the JWT: exp (Expiration Time) and iat (Issued AT) as defined in RFC 7519.
If the server retrieval mdoc response structure does not include some data element or document requested in the server rietreval mdoc request, an error code may be returned as part of the documentErrors or errors structures. If present ErrorCode shall contain an error code according to Table 10. An ErrorCode is specific to the document or data element requested within a namespace.  

Table 10 - Data handling errors
Error code
Error code 
message
Description
0
Data not returned
The issuing authority infrastructure does not provide the requested document or data element without any given reason. This element may be used in all cases.
Other positive integers
See description
RFU
Negative integers
See description
These error codes may be used for application specific purposes
An example of the server response can be found in Annex D.4.2.1.2.
8.3.3 Data retrieval transmission technologies
8.3.3.1 Device retrieval
8.3.3.1.1 Data retrieval using Bluetooth Low Energy (BLE)
8.3.3.1.1.1 General
Bluetooth Low Energy (BLE) may be used for device retrieval. BLE shall be implemented according to the Bluetooth Core Specification. An mdoc shall support version 4.0 of this specification. An mdoc should support version 4.2 and LE Data Packet Length Extension. An mdoc reader shall support version 4.2 and LE Data Packet Length Extension. An mdoc reader is recommded to support version 5.0 and LE 2M PHY.
Using BLE as a transmission technology consists of two phases, connection setup and data retrieval. During connection setup, the mdoc and mdoc reader connect to each other. After the connection is setup, data retrieval can be initiated. 
BLE secure connections can be used if supported by both the mdoc and mdoc reader. However, an mdoc or an mdoc reader shall not require the use of BLE secure connections. Security of the transferred data is ensured by the security mechanisms specified in Clause 9.
All BLE session information shall be removed after each transaction.
As part of device engagement, an mdoc, and optionally the mdoc reader, indicates whether it supports the Central role,  the Peripheral role or both. The Central and Peripheral role shall be implemented according to the Bluetooth Core Specification. 
NOTE	It is possible for the mdoc or mdoc reader to support both roles, until data retrieval has started.
If the mdoc supports the Central role, it shall act as a GATT client. This mode is called mdoc central client mode. If the mdoc supports the Peripheral role, it shall act as a GATT server. This mode is called mdoc peripheral server mode.
If the mdoc indicates during device engagement that it supports both modes, the mdoc reader should select the mdoc central client mode.
8.3.3.1.1.2 Device engagement contents
This clause describes the requirements for the contents of the device engagement information. [7] gives further informative guidance.
Device engagement using NFC
For device engagement using NFC, the BLE alternative carrier configuration record Record Type Name shall be "application/vnd.bluetooth.le.oob". The Supplement to the Bluetooth Core Specification specifies data types used for OOB data blocks. The following requirements apply to the presence of the data types in the OOB data block:
* LE Role (0x1C). This type is mandatory. It shall be used by the mdoc and mdoc reader to indicate which LE roles they support or select.
* LE Device Address (0x1B). This field is recommended. If it is available, the connection process can take a shorter time compared to using the UUID to identify the correct device to connect to.
* Complete List of 128-bit Service UUID's (0x07). The requirements for including this field are defined below. This field shall be used to transfer the UUID's used for connection setup, if applicable.
Other data types may be included in the OOB data block.
The following requirements apply for including the UUID field during NFC device engagement: 
* For Negotiated Handover, if the mdoc reader supports mdoc central client mode, it shall include a UUID in the Handover Request message, to be used for mdoc central client mode.
* For Negotiated Handover, if the mdoc chooses to use mdoc peripheral server mode, it shall include a UUID in the Handover Select message, to be used for mdoc peripheral server mode.
* For Static Handover, the mdoc shall send one UUID in the handover select message, to be used for  mdoc central client mode, mdoc peripheral server mode or both.
Device engagement using QR code
For device engagement using QR code, the mdoc shall indicate which modes it supports using the fields in the BleOptions structure as specified in Clause 8.2.2.3. The UUIDs in the BleOptions structure shall be encoded using variant 1 ('10x'b) as a 16 octets element with the byte order as specified in RFC 4122 Section 4.1.2. The value of the BLE Device Address field shall use the same encoding as the LE Device Address field used in device engagement using NFC as defined earlier in this clause. 
The UUID for peripheral server mode shall be present if mdoc peripheral server mode is supported and shall not be present if peripheral server mode is not supported. 
The UUID for client central mode shall be present if mdoc central client mode is supported and shall not be present if central client mode is not supported.
The BLE Device Address field may be present if mdoc peripheral server mode is supported and it shall not be present if peripheral server mode is not supported. If it is available, the connection process can take a shorter time compared to using the UUID to identify the correct device to connect to.
8.3.3.1.1.3 Connection setup
The UUID's used shall be 16-byte UUID's that are unique for the transaction. The Peripheral device shall broadcast the service with the UUID as received during device engagement in the advertising packet. The Central device is then able to scan for the UUID and connect to the advertised service. However, the Central device may use a different mechanism to identify the Peripheral device.
NOTE 1	BLE stacks in mobile devices can use scan filter and caching methods to manage congested environments and manage scan intervals for device energy consumption control. This can influence the connection time required when using UUIDs for the identification of the Peripheral device.
NOTE 2	Finding the correct device to connect to is purely a practical problem. Connecting to the wrong mdoc reader does not have security implications, since due to the security methods described in Clause 9, the mdoc and mdoc reader will not setup a session with the wrong mdoc reader. Note however, that these mechanisms do not provide complete protection against a bad actor aiming to cause a denial of service attack by advertising as a fake mdoc reader.
To ensure that the mdoc is connected to the correct mdoc reader, the mdoc may verify the Ident characteristic as described in Clause 8.3.3.1.4. The Ident characteristic value shall be calculated using the following procedure:
Use HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: EdeviceKeyBytes (see Clause 9.1.1.4)
* salt: (no salt value is provided)
* info:"BLEIdent" (encoded as a UTF-8 string)
* L: 16 octets
If the Ident characteristic received from the mdoc reader does not match the expected value, the mdoc shall terminate the connection.
NOTE 3 	The purpose of the Ident characteristic is only to verify whether the mdoc is connected to the correct mdoc reader before setting starting data retrieval. If the mdoc is connected to the wrong mdoc reader, session establishment will fail. Connecting and disconnecting to an mdoc reader takes a relatively large amount of time and it is therefore fastest to implement methods to identify the correct mdoc reader to connect to and not to rely purely on the Ident characteristic to identify the correct mdoc reader.
After connection is setup, the GATT client may check to see if the GATT server supports the L2CAP transmission profile and, if so, use it to transfer data. See Annex A for more information. If the L2CAP transmission profile is used, Clause 8.3.3.1.1.5, Clause 8.3.3.1.1.6, Clause 8.3.3.1.1.7 and Clause 8.3.3.1.1.8 do not apply.

8.3.3.1.1.4 Service definition
Table 11 shows characteristics which the mdoc service shall contain if the mdoc is the GATT server. The services may contain other characteristics and properties besides the ones required in Table 11.
NOTE	Supporting the Write property next to Write Without Response property can solve some interoperability issues. Using Write Without Response has a higher transmission rate.
Table 11 - mdoc service characteristics
Characteristic name
UUID
Mandatory properties
State
00000001-A123-48CE-896B-4C76973373E6
Notify, Write Without Response
Client2Server
00000002- A123-48CE-896B-4C76973373E6
Write Without Response
Server2Client
00000003- A123-48CE-896B-4C76973373E6
Notify
Table 12 shows characteristics which the mdoc reader service shall contain if the mdoc reader is the GATT server. The services may contain other characteristics and properties besides the ones required in Table 12.
Table 12 - mdoc reader service characteristics
Characteristic name
UUID
Mandatory properties
State
00000005- A123-48CE-896B-4C76973373E6
Notify, Write Without Response
Client2Server
00000006- A123-48CE-896B-4C76973373E6
Write Without Response
Server2Client
00000007- A123-48CE-896B-4C76973373E6
Notify
Ident
00000008- A123-48CE-896B-4C76973373E6
Read
Each service characteristic having the Notify property shall contain the Client Characteristic Configuration Descriptor, with UUID '0x29 0x02' and default value of '0x00 0x00'. This value shall be set to '0x00 0x01' by the GATT client to get notified for the characteristic associated to this descriptor.
8.3.3.1.1.5 Connection state 
After the connection is setup, the GATT client shall subscribe to notifications of characteristic 'State' and 'Server2Client'. For performance reasons, the GATT client should request for an as high an MTU as possible. After these steps, the GATT client shall make a write without response request to 'State' where it sets the value to 0x01. This tells the GATT server that the GATT client is ready for the transmission to start.
The connection state is indicated by the 'State' characteristic. It is encoded as 1-byte binary data. Table 13 describes the different connection state values, which are communicated using Write Without Response and Notify.
Table 13 - Connection state values
Command
Data
Sender
Description
Start
0x01
GATT client
This indicates that the mdoc reader may/will begin 
transmission.
End
0x02
mdoc, mdoc reader
Signal to finish/terminate transaction. The mdoc reader shall use this value to signal the end of data retrieval. Both the mdoc and the mdoc reader can use this value at any time to terminate the connection. See also Clause 9.1.1.4 for more information on session termination.
8.3.3.1.1.6 Data retrieval
Data retrieval shall start by signaling the 'Start' value to the 'State' characteristic.
The data sent shall be the SessionsEstablishment or SessionData messages as defined in 9.1.2.5.
If the GATT client wants to send a message to the GATT server, it shall divide the message in parts with a length of 3 bytes less than the MTU size. It then sends these parts to the GATT server using the Write Without Response command via the 'Client2Server' characteristic. The first byte of each part is either 0x01, which indicates more messages are coming, or 0x00, to indicate it is the last part of the message.
If the GATT server wants to send a message to the GATT client, it shall divide the message in parts with a length of 3 bytes less than the MTU size. It then sends these parts to the GATT client using the Notify command via the 'Server2Client' characteristic. The first byte of each part is either 0x01, which indicates more parts are coming, or 0x00, to indicate it is the last part of the message.
The sequence of messages shall be repeated as long as necessary to finish data retrieval.
Figure 5 shows the informative sequence diagram for how data is transferred

Figure 5 - Data transfer sequence diagram
8.3.3.1.1.7 Connection closure
After data retrieval, the GATT client shall unsubscribe from both the 'State' and 'Server2Client' characteristics and shall disconnect from the GATT server.
8.3.3.1.1.8 Connection re-establishment
In case of a lost connection before the 'state' characteristic has been set to a value of 0x01 (e.g. the transmission has not yet started), the mdoc and mdoc reader should terminate their current BLE session and try to reconnect according to Clause 8.2.2.1.4.
In case of a lost connection after the 'state' characteristic has been set to value 0x01 (e.g. the transmission of data has started), a connection shall not be re-established and a completely new mdoc transaction shall be initiated if required.
8.3.3.1.2 Data retrieval using near field communication (NFC)
NFC may be used for device retrieval. In case NFC is used, the mdoc shall support PICC mode and the mdoc reader shall support PCD mode. 
An mdoc and mdoc reader shall support short-length fields as specified in ISE/IEC 7816-4:2020, 5.2 and should support extended-length fields as specified in ISO/IEC 7816-4:2020, 5.2. An mdoc shall indicate the maximum length of command data fields and of response data fields it supports during device engagement, as specified in Clause 8.2.2.2 for device engagement using QR code and Clause 8.2.2.3 for device engagement using NFC. The two fields shall indicate the maximum length of the command and response data fields as defined in ISO/IEC 7816-4:2020, 5.2 supported by the mdoc. 
NOTE 1	For device engagement using QR code, this information is in the NfcOptions map. For device engagement using NFC, this information is in the NFC Handover Select message.
NOTE 2	The minimum and maximum possible values for the command data field limit are 'FF' and 'FF FF', i.e. the limit is between 255 and 65 535 bytes (inclusive). The minimum and maximum possible values for the response data  limit are '01 00' and '01 00 00', i.e. the limit is between 256 and 65 536 bytes (inclusive).
The mdoc reader shall respect the data field size limitations of the mdoc. 
NOTE 3	The mdoc reader determines the size of both the command and the response APDUs and can therefore make sure that its APDU size limitations (if any) are not being violated.
An mdoc and mdoc reader shall support command chaining and response chaining as specified in ISO/IEC 7816-4:2020, 5.3.
NOTE 4	Even if extended-length APDUs are supported by the mdoc and the mdoc reader, using command or response chaining may still be necessary, because it cannot be guaranteed that an mdoc reader request or an mdoc response fits in a single APDU.
The Application IDentifier (AID) of the mdoc shall be 'A0 00 00 02 48 04 00'.
NOTE 5	The AID of the mdoc application consists of the registered application provider identifier (RID) ('A0 00 00 02 48') followed by the proprietary application identifier extension (PIX) ('04 00'). 
An mdoc application shall be selected using the SELECT command defined in ISO/IEC 7816-4 with the AID listed above. Table 14 and Table 15 specify the SELECT command and response APDUs.
Table 14 - SELECT command
CLA
INS
P1-P2
Lc field
Data field
Le field
'00'
'A4'
'04 0C'
'07'
'A0 00 00 02 48 04 00'
Absent
Table 15 - SELECT response
Data field
SW1 - SW2
Absent
See Table 61 in ISO/IEC 7816-4

After the mdoc application is selected, the mdoc reader can start data retrieval. The mdoc reader shall use the ENVELOPE command with INS = 'C3', specified in ISO/IEC 7816-4, to communicate the SessionsEstablishment en SessionData messages as defined in Clause 9.1.1.4 to the mdoc. These messages shall be encapsulated in a data object '53' as specified in ISO/IEC 7816-4:2020, 11.7.2. The mdoc shall use the ENVELOPE response to communicate the SessionData messages as defined in Clause 9.1.1.4 to the mdoc reader. Also these messages shall be encapsulated in a data object '53'.
Table 16 and Table 17 specify the ENVELOPE command and response APDUs.
Table 16 - ENVELOPE command
CLA
INS
P1-P2
Lc field
Data field
Le field
'00' or '10', as defined in ISO/IEC 7816-4:2020, 5.4.1
'C3'
'0000'
Length of data field
Data object '53' or data object fragment
See below
Table 17 - ENVELOPE response
Data field
SW1 - SW2
Data object '53' or absent if an error occurred on ISO 7816-4 protocol level
See Table 121 in ISO/IEC 7816-4, in particular '61 XY'.

For oversize incoming payload (from an mdoc reader to an mdoc), several ENVELOPE commands shall be chained as specified in ISO 7816-4:2020, 5.3. For oversize outgoing payload (from an mdoc to an mdoc reader), response chaining shall be used as specified in ISO 7816-4:2020, 5.3 and further detailed below, using one or more GET RESPONSE commands and responses.
Regarding the value of Le in the ENVELOPE and GET RESPONSE commands:
* For all ENVELOPE commands in a chain except the last one, Le shall be absent, since no data is expected in the response to these commands.
* For the last ENVELOPE command in a chain, Le shall be set to the maximum length of the response data field that is supported by both the mdoc and the mdoc reader. The mdoc reader shall encode Le as specified in ISO 7816-4:2020, 5.2. 
* For the last ENVELOPE command or for a GET RESPONSE command, 
o If Le = the number of available bytes, the mdoc shall include all available bytes in the response and set the status words to '90 00'. 
o If Le < the number of available bytes = Le + 255, the mdoc shall include as many bytes in the response as indicated by Le and shall set the status words to '61 XX', where XX is the number of available bytes remaining. The mdoc reader shall respond with a GET RESPONSE command where Le is set to XX. 
o If the number of available bytes > Le + 255, the mDL shall include as many bytes in the response as indicated by Le and shall set the status words to '61 00'. The mdoc reader shall respond with a GET RESPONSE command where Le is set to the maximum length of the response data field that is supported by both the mdoc and the mdoc reader.

If the NFC connection is lost during data retrieval, a completely new mdoc transaction (including device engagement) shall be initiated.

8.3.3.1.3 Data retrieval using Wi-Fi Aware
8.3.3.1.3.1 General
Wi-Fi Aware may be used for device retrieval. Wi-Fi Aware shall be implemented according to the Wi-Fi Alliance Neighbor Awareness Networking Specification. The data retrieval using Wi-Fi Aware consists of three phases, connection setup, data retrieval and closure.
8.3.3.1.3.2 Connection setup
Wi-Fi Aware is setup using the information exchanged during device engagement. The Wi-Fi Alliance Neighbor Awareness Networking Specification, Version 3.1 describes the connection setup process. Section 12 of that standard describes the connection setup process for NFC Negotiated Connection Handover and NFC Static Connection Handover. The structure used to transfer the required info if QR code is used for device engagement is described below.
The service name shall be calculated by the mdoc and mdoc reader for each transaction using the following mechanism:
Use HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: EDeviceKeyBytes (see Clause 9.1.1.4)
* salt: (no salt value is provided)
* info: "NANService" (encoded as a UTF-8 string)
* L: 16 octets
The output of the HKDF shall be converted to base16 according to RFC 4648 to get the service name.
EXAMPLE "94AB45CDBDEF675162183B12AC35EFAA".
Use of a cipher suite as defined by the Wi-Fi Alliance Neighbor Awareness Networking Specification is mandatory. The mdoc reader shall support the NCS-SK-128 and NCS-PK-2WDH-128 cipher suites, as specified by the Wi-Fi Alliance Neighbor Awareness Networking Specification. The mdoc shall support at least the NFC-SK-128 cipher suite and should support the NCS-PK-2WDH-128 cipher suite.
If NFC is used for device engagement, either the Pass-phrase Info or the DH Info shall be explicitly transferred from the mdoc to the mdoc reader during device engagement according to the Wi-Fi Alliance Neighbor Awareness Networking Specification section 12.
NOTE 1	Since the NCS-PK-2WDH cipher suite requires both the mdoc and the mdoc reader to exchange ephemeral public keys during device engagement, it can only be used if NFC Negotiated Connection Handover is used and not if NFC Static Connection Handover or QR code is used for device engagement.
NOTE 2	The Wi-Fi Alliance Neighbor Awareness Networking Specification references RFC 8110 for the Diffie-Hellman key exchange used in the NCS-PK-2WDH cipher suites. Note that RFC 8110 mandates the support for the group nineteen curve, which is the P-256 curve.
If QR code is used for device engagement, the data used for connection setup that would be transferred as part of the Wi-Fi Aware Carrier Configuration Record if NFC were used, as defined in the Wi-Fi Alliance Neighbor Awareness Networking Specification, is transferred as part of the WifiOptions structure (see Clause 8.2.2.3). Table 18 describes  for each element in the WifiOptions structure what the corresponding field would be in the Wi-Fi Aware Carrier Configuration Record. The mdoc and modc reader shall comply with the requirements in Wi-Fi Alliance Neighbor Awareness Networking Specification  regarding the presence and values of these fields, with the exception of the presence of the Pass-phrase field, for which the presence and associated behaviour is defined below.
Table 18 - WifiOptions elements
Key in WifiOptions
Corresponding field in Wi-Fi Carrier Configuration Record
Corresponding Sub-Field
0
Pass-phrase Info
Pass-phrase
1
Channel Info
Operating Class
2
Channel Info
Channel Number
3
Band Info
Supported Bands


Presence of the pass-phrase (i.e. the key-value pair with key = 0) in the WifiOptions structure is optional. When the Pass-phrase field is absent in WifiOptions structure, the mdoc and mdoc reader shall calculate the pass-phrase using the following mechanism:
Use HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: EdeviceKeyBytes (see Clause 9.1.1.4)
* salt: (no salt value is provided)
* info: "NANPassphrase" (encoded as a UTF-8 string)
* L: 32 octets
The output of the HKDF calculation shall be converted using base64url-without-padding according to RFC 4648 to get the pass-phrase. 
The pass-phrase field in the WifiOptions structure should only be used if the resulting pass-phrase contains at least 12 bytes of entropy.
During the Wi-Fi Aware service discovery procedure, the mdoc shall serve as the Service Publisher, and the mdoc reader shall serve as the Service Subscriber.
Once the Wi-Fi Aware service discovery is completed, the mdoc reader shall initiate the data path setup, and serve as the NDP Initiator; while the mdoc shall serve as the NDP Responder. The transport protocol and port number shall be transferred as part of the NDPE attribute according to Wi-Fi Alliance Neighbor Awareness Networking Specification, Version 3.1, January 2020, section 6.2.7. The mdoc and mdoc reader should use an ephemeral link-local IPv6 for each connection.
Since the IP address is transferred as part of the Wi-Fi Aware connection setup, using the IPv6 Neighbor Discovery Protocol is not necessary. The Neighbor Discovery Protocol should therefore be disabled to significantly improve connection time setup.
8.3.3.1.3.3 Data retrieval
When Wi-Fi Aware is used, mdoc data is transferred using the HTTP protocol, with the mdoc serving as the HTTP and TCP servers, and the mdoc reader serving as the HTTP and TCP client. The data retrieval shall use the HTTP POST method to transfer mdoc data. HTTP request messages shall have the following structure:
POST /mdoc HTTP/1.1
Host: [IPv6 address of the mdoc]
Content-Length: [content length]
Content-Type: application/CBOR
 
[SessionsEstablishment or SessionData message]
 
HTTP successful response message shall have the following structure:
HTTP/1.1 200 OK
Content-length: [content length]
Content-type: application/CBOR
 
[SessionsEstablishment or SessionData message]
 
The SessionsEstablishment and SessionData messages are defined in Clause 9.1.1.4.
HTTP error responses are specified in [17], Section 6.1.
8.3.3.1.3.4 Closure
An mdoc or mdoc reader shall close the connection after receiving the session termination code, see Clause 9.1.1.4.
8.3.3.2 Server retrieval
8.3.3.2.1 Data retrieval using WebAPI
The WebAPI data retrieval method may be used for server retrieval. Using this method, mdoc data is transferred using the HTTP protocol. The request method is POST. The Issuer URL (see Clause 8.2.1.2) refers to the base server URL of an "/identity" WebAPI endpoint operated by the issuing authority infrastructure. The Content-Type header-field shall be set to "application/json". The host field content shall be derived from the Issuer URL element. The message body shall be the server retrieval mdoc request as defined in Clause 8.3.2.2.2.1.
A successful response contains the HTTP status "200 OK". Table 19 defines all allowed mdoc specific responses. Other HTTP responses may be returned. The Content-Type header shall be set to "application/jwt", and the "Content-Length" header shall be set correctly. The message body shall be the server retrieval mdoc response as defined in Clause 8.3.2.2.2.2.
In case the issuing authority infrastructure requires interaction with the mdoc holder input to negotiate data to be shared with the mdoc reader, the issuing authority infrastructure needs to contact the mdoc. The mdoc reader shall wait for the response using HTTP long or short polling. In case of long polling, the mdoc reader should set the timeout to 120 seconds in order to avoid requests to timeout. In case of short polling the issuing authority infrastracture is sending a HTTP 202 response, including a Retry-After header-field with the retry delay in seconds with an empty response body. The mdoc reader shall periodically check for the response.
Table 19 - HTTP status codes
HTTP status code
HTTP status 
message
Description
200
OK
Successful HTTP request.
202
Accepted
The HTTP request has been accepted for processing but is not yet completed.
400
Bad Request
The HTTP request was invalid or malformed.
401
Unauthorized
The provided server retrieval token was invalid.
500
Internal Server Error
The server encountered an internal server error and was not able to process the request successfully.


8.3.3.2.2 Data retrieval using OpenID Connect ('OIDC')
The OIDC data retrieval method may be used for server retrieval. If used, an mdoc reader and an issuing authority infrastructure shall implement this method as specified in this clause.
The data retrieval process using OIDC consists of the following steps:
1. Configuration
2. Client Registration
3. Authorisation
4. Get ID Token
5. Validate ID Token
NOTE 1	It's also possible to retrieve the user claims through a userinfo endpoint [18], but this will be specified in a future edition of this document.
Step 1 Configuration
This step shall be used for retrieving OpenID Provider Configuration Information from the issuing authority OpenID provider as specified in OpenID Connect Discovery 1.0 incorporating errata set 1, Section 4. An issuing authority shall provide the information as a JSON document at the path formed by concatenating the string "/.well-known/openid-configuration" to the Issuer URL. Issuer URL (see Clause 8.2.1.2) refers to the base server URL address of the issuing authority OpenID provider. 
An mdoc reader shall send an OpenID Provider configuration request. The issuing authority Open ID provider shall respond with an OpenID Provider configuration response as specified in OpenID Connect Discovery 1.0 incorporating errata set 1, section 4.1 and 4.2 respectively.
Step 2 Client Registration
An mdoc reader requires a client id. If "registration_endpoint" information is available in the OpenID Provider response (see Step 1), dynamic client registration, as specified in [12], may be used to obtain such a client_id. If the issuing authority infrastructure OpenID Provider does not support dynamic client registration, an mdoc reader shall obtain a client_id in another way (e.g. an out-of-band manner).
Step 3 Authorisation
The mdoc reader shall use Authorization Code Flow Grant as specified in OpenID Connect Core 1.0 errata set 1, section 3.1. The client id retrieved in Step 2 shall be used in the authentication request. The server retrieval token retrieved from the mdoc (see Clause 8.2.1.2) shall be used as an input to the "login_hint" parameter in the authentication request. The authentication request shall be sent to the authorisation endpoint. Information on the authorisation endpoint is included in the OpenID Provider configuration response in Step 1. 
The authentication response is redirected to the mdoc according to OAuth 2.0 for Native Apps and shall be according to RFC 8252. The authentication response shall include the authorisation code assigned by the authorisation endpoint.
Step 4 Get ID Token
User claims shall be retrieved from the Token endpoint with an ID token. In order to retrieve user claims, an mdoc reader shall access the Token endpoint. Access information on the Token endpoint is included in the OpenID Provider configuration response.
An mdoc reader shall send a Token request containing the authorisation code retrieved in Step 3. A successful Token response shall contain at least "exp" and "iat" elements as defined in OpenID Connect Core and a docType element as defined in Clause 8.3.1, the docType element shall use the claim name "doctype".
The following convention for naming claims shall be used for using a namespace within the OIDC framework. Each data element shall get the namespace (see Clause 8.1) as a prefix as [NameSpace]:[DataElementIdentifier].
EXAMPLE	"org.iso.18013.5.1:portrait"

NOTE 2	OIDC currently does not support the IntentToRetain element specified in Clause 8.3.2.2.2.1. The capability to use that is expected in a future edition of this document.
Step 5 Validate ID Token
An mdoc reader shall validate the ID Token according to OpenID connect core 1.0 errata set 1, Section 3.1.3.7. The public key to verify  the certificate chain is available in a JWKS (JSON Web Key Set) repository as defined in RFC 7517. The URI of the JWKS should be included in the OpenID Provider Configuration Response. 
Examples of OIDC request and response messages are described in Annex D.4.2.2.

9 Security mechanisms
9.1 Device retrieval
9.1.1 Session encryption
9.1.1.1 Purpose
Encrypting with authentication of the mdoc requests and mdoc responses with the session key protects mdoc data from eavesdropping and alteration.
9.1.1.2 Applicability
This mechanism is applicable for an mdoc using device retrieval.
9.1.1.3 Description
Session encryption uses standard ephemeral key ECDH to establish session keys for authenticated symmetric encryption.
9.1.1.4 Procedure
The following steps shall be performed as part of session encryption:
1. Device engagement. The mdoc generates a new ephemeral key pair (EDeviceKey.Priv, EDeviceKey.Pub), and includes the cipher suite identifier, the identifier of the elliptic curve to be used for key agreement and the EDeviceKey public point, as part of the device engagement structure as defined in 8.2.1.1.
2. Session establishment. The mdoc reader generates a new ephemeral key pair (EReaderKey.Priv, EReaderKey.Pub) using the elliptic curve identified by the mdoc. Session keys are derived independently by the mdoc and the mdoc reader as specified in Clause 9.1.1.5. 
The mdoc reader encrypts the mdoc request with the appropriate session key and sends it to the mdoc together with EreaderKey.Pub in a session establishment message. 
The mdoc uses the data from the session establishment message to derive the session keys and decrypts the mdoc request.
3. Session data. The mdoc encrypts the mdoc response with the appropriate session key and sends it to the mdoc reader in a session data message.
The mdoc reader and mdoc optionally exchange further session data messages containing additional mdoc requests and mdoc responses. If so, these requests and responses are encrypted by the mdoc reader and the mdoc using their respective session keys.
4. Session termination. The session shall be terminated if at least one of the following conditions occur:[A1]
*  After a time-out of no activity of receiving or sending session establishment or session data messages occurs. The time-out for no activity implemented by the mdoc and mdoc reader should be no less than 300 seconds.
*  If the mdoc does not want to receive any further requests.
*  If the mdoc reader does not want to send any further requests.
If an mdoc or an mdoc reader does not want to send or receive any further requests, it shall initiate session termination as follows: 
* If any transmission method besides BLE is used for data transmission, it shall send the status code for session termination. 
* If BLE is used for data transmission, an mdoc or mdoc reader has two options to send the termination message:
* To send the status code for session termination.
* To send the "End" command defined in Clause 8.3.3.1.1.5
When a session is terminated, the mdoc and mdoc reader shall perform at least the following actions:
* Destruction of session keys and related ephemeral key material
* Closure of the communication channel used for data retrieval.
The session establishment message shall be CBOR encoded and formatted as follows:
SessionEstablishment = {
     "eReaderKey" : EReaderKeyBytes,
     "data" : bstr                   ; Encrypted mdoc request
}

The session data messages shall be CBOR encoded and formatted as follows:
SessionData = {
    ? "data" : bstr         ; Encrypted mdoc response or mdoc request
    ? "status" : uint       ; Status code
}

The contents of the data element in the session establishment and session data messages are defined in 9.1.1.5.
The mdoc and mdoc reader ephemeral keys shall be encoded as COSE_Key as defined in RFC 8152; further requirements are defined in Clause 9.1.5.2. The structures that contain the mdoc and mdoc reader ephemeral keys shall be CBOR encoded and formatted as follows:
EDeviceKey = COSE_Key                           ; Containing EDeviceKey.Pub
EReaderKey = COSE_Key                           ; Containing EReaderKey.Pub
EDeviceKeyBytes = #6.24(bstr .cbor EDeviceKey)
EReaderKeyBytes = #6.24(bstr .cbor EReaderKey)

When cipher suite 1 (see Clause 9.1.5.2) is used, one of the curves from Table 22 shall be used in EDeviceKey and EReaderKey. Only curves with the purpose ECDH shall be used. 
The possible values of the status code are defined in Table 20. If status code 10 or 11 is returned, the data element shall not be present in that session data message.
Table 20 - SessionData status codes
Status code
Description
Action required
10
Error: session encryption
The session shall be terminated
11
Error: CBOR decoding
The session shall be terminated
20
Session termination
The session shall be terminated

An example for session encryption can be found in Annex D.5.1.
9.1.1.5 Cryptographic operations
The following operations shall be performed if cipher suite 1 (see Clause 9.1.5.2) is used.
To calculate the session keys, the mdoc and the mdoc reader shall perform ECKA-DH (Elliptic Curve Key Agreement Algorithm - Diffie-Hellman) as defined in BSI TR-03111. The inputs shall be the EDeviceKey.Priv and EReaderKey.Pub for the mdoc and EReaderKey.Priv and EDeviceKey.Pub for the mdoc reader. The ZAB output defined in BSI TR-03111 shall be used to derive two keys, SKReader and SKDevice.
SKReader shall be derived using HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: ZAB 
* salt: SHA-256(SessionTranscriptBytes)
* info: "SKReader" (encoded as a UTF-8 string)
* L: 32 octets
SKDevice shall be derived using HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: ZAB 
* salt: SHA-256(SessionTranscriptBytes)
* info: "SKDevice" (encoded as a UTF-8 string)
* L: 32 octets
SessionTranscriptBytes is defined in Clause 9.1.5.1.
For encryption AES-256-GCM (GCM: Galois Counter Mode) as defined in NIST SP 800-38D shall be used. The mdoc reader shall encrypt its mdoc requests with SKReader, the mdoc shall encrypt its mdoc responses with SKDevice. Therefore, both the mdoc and the mdoc reader need to generate both session keys in order to be able to decrypt the messages they send and also decrypt the messages they receive. 
The IV (Initialization Vector defined in NIST SP 800-38D) used for encryption shall have the default length of 12 bytes for GCM, as specified in NIST SP 800-38D. The IV shall be the concatenation of the identifier and the message counter (identifier || message counter). The identifier shall be an 8-byte value. The mdoc reader shall use the following identifier: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00. The mdoc shall use the following identifier: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01. The mdoc and mdoc reader shall keep a separate message counter for each session key. The message counter value shall be a 4-byte big-endian unsigned integer. For the first encryption with a session key, the message counter shall be set to 1. Before each following encryption with the same key, the message counter value shall be increased by 1. A message counter value shall never be reused in any future encryption using the same key. The AAD (Additional Authenticated Data defined in NIST SP 800-38D) used as input for the GCM function shall be an empty string. The plaintext used as input for the GCM function shall be mdoc request or mdoc response. The value of the data element in the session establishment and session data messages as defined in 9.1.1.4 shall be the concatenation of the ciphertext and all 16 bytes of the authentication tag (ciphertext || authentication tag). 
9.1.2 Issuer data authentication
9.1.2.1 Purpose
The purpose of issuer data authentication is to confirm that the mdoc data is issued by the issuing authority and that it has not changed since issuance.
9.1.2.2 Applicability
This mechanism is applicable for an mdoc supporting device retrieval.
NOTE	Similar methods are described for server retrieval (see Clause 9.2).
9.1.2.3 Description
Issuer data authentication is implemented by way of a digital signature over mdoc data, calculated by the issuing authority infrastructure using a public-private (asymmetric) key pair.
The isuing authority infrastructure calculates a message digest for each data element present on the mdoc and includes all digests in the mobile security object (MSO), defined in Clause 9.1.2.4. The issuing authority infrastructure then digitally signs the MSO using a private key that is kept secret by and adds the digital signature to the mdoc data.
The public key belonging to the private key used for the digital signature is provided as part of a certificate. When the mdoc is presented to an mdoc reader, the mdoc reader retrieves this certificate. The mdoc reader shall then perform the inspection procedure as described in Clause 9.3.1
9.1.2.4 Signing method and structure for MSO
An mdoc digital signature is generated over the mobile security object (MSO). The MSO shall be CBOR encoded and formatted as follows:

IssuerAuth = COSE_Sign1     ; The payload is MobileSecurityObjectBytes

MobileSecurityObjectBytes = #6.24(bstr .cbor MobileSecurityObject)

MobileSecurityObject = {
    "version" : tstr,                       ; Version of the MobileSecurityObject
    "digestAlgorithm" : tstr,               ; Message digest algorithm used
    "valueDigests" : ValueDigests,          ; Digests of all data elements per namespace
    "deviceKeyInfo" : DeviceKeyInfo,
    "docType" : tstr,                       ; docType as used in Documents
    "validityInfo" : ValidityInfo
}

DeviceKeyInfo = {
    "deviceKey" : DeviceKey
    ? "keyAuthorizations" : KeyAuthorizations,
    ? "keyInfo" : KeyInfo
}

DeviceKey = COSE_Key

KeyAuthorizations = {
    ? "nameSpaces" : AuthorizedNameSpaces
    ? "dataElements" : AuthorizedDataElements
}

AuthorizedNameSpaces = [+ NameSpace]
AuthorizedDataElements = {+ NameSpace => DataElementsArray}
DataElementsArray = [+ DataElementIdentifier]

KeyInfo = { * int => any}   ; Positive integers are RFU, negative integers may be used for proprietary use

ValueDigests = {
    + NameSpace => DigestIDs
}

DigestIDs = {
    + DigestID => Digest
}

ValidityInfo = {
    "signed" : tdate,
    "validFrom" : tdate,
    "validUntil" : tdate,
    ? "expectedUpdate" : tdate
}

DigestID = uint             ; DigestID as used in IssuerSignedItem
Digest = bstr

 
The version for the MobileSecurityObject structure shall be "1.0" in the current version of this document. The major version (see Clause 8.1) shall not be higher than the major version of the mdoc response (see Clause 8.3.2.1.2.2). 
The digestAlgorithm and valueDigests are the digest algorithm identifier and the digests of the data elements as further specified in Clause 9.1.2.5. 
deviceKeyInfo contains the mdoc authentication public key and information related to this key. deviceKey contains the public part of the key pair used for mdoc authentication (see Clause 9.1.3.4). The deviceKey element is encoded as an untagged COSE_Key element as specified in RFC 8152; further requirements are defined in Clause 9.1.5.2. 
As specified in Clause 9.1.3.4, an mdoc can use a DeviceKey to calculate a signature or MAC over data elements as part of mdoc authentication. Within DeviceKeyInfo, KeyAuthorizations shall contain all the elements the key may sign or MAC. Authorizations can be given for a full namespace or per data element. If authorization is given for a full namespace (by including the namespace in the AuthorizedNameSpaces array), that namespace shall not be included in the AuthorizedDataElements map. If the KeyAuthorizations map is present, it shall not be empty.
KeyInfo may contain extra info about the key. Positive integers for KeyInfo labels are RFU. If  application-specific extensions are present, they shall use negative integers for the labels.
DigestID is an unsigned integer that is used to match the hashes in the MSO to the data elements in the mdoc response. The Digest ID shall be unique within a namespace. To prevent the MSO leaking information on what data elements are present on a specific mdoc, there should be no correlation between the Digest ID's used for the same data element in the same namespace in different MSO's. The value shall be smaller than 2^31.
DocType is the document type of the document and shall be identical to the DocType element in the mdoc response as defined in Clause 8.3.2.1.2.2.
The ValidityInfo structure contains information related to the validity of the MSO and its signature. The signed element is the timestamp at which the MSO signature was created. The validFrom element contains the timestamp before which the MSO is not yet valid. The timestamp of validFrom shall be equal or later than the signed element.
NOTE 1	A validFrom element with a future date can be used for when a change of mdoc data is expected in the future, for example a change in age data elements.
The validUntil element contains the timestamp after which the MSO is no longer valid. The value of the timestamp shall be later than the validFrom element. The optional expectedUpdate element contains the timestamp at which the issuing authority infrastructure expects to re-sign the MSO (and potentially update data elements).
The timestamps in the ValidityInfo structure shall not use fractions of seconds and shall use a UTC offset of 00:00, as indicated by the character "Z".
NOTE 2	The validUntil element determines the validity period of the MSO and therefore the mdoc cannot be validated after this date. mdoc data elements can provide further information on the administrative validity of the mdoc. For example, if the mdoc has an expiry date data element, this date can be later than the 'validUntil' date of the MSO.
Since the timestamps in the ValidityInfo structure can provide linkability clues, the issuing authority infrastructure should set these timestamps with a precision that limits the linkability information. This can be done for example by setting the hh, mm and ss information to the same value on each provisioned mdoc.
The MSO is encapsulated and signed by the untagged COSE_Sign1 structure as defined in RFC 8152 and identified as IssuerAuth for use in the mdoc response as defined in Clause 8.3.2.1.2.2. Within the COSE_Sign1 structure, the payload shall be MobileSecurityObjectBytes. The external_aad field used in the Sig_structure shall be a bytestring of size zero.
The alg element (RFC 8152) shall be included as an element in the protected header. Other elements should not be present in the protected header. 
The issuing authority infrastructure shall use one of the signature algorithms for calculating the signature over the MSO: "ES256" (ECDSA with SHA-256), "ES384" (ECDSA with SHA-384), "ES512" (ECDSA with SHA-512) or "EdDSA" (EdDSA) shall be used. "ES256" shall be used with curves P-256 and brainpoolP256r1. "ES384" shall be used with curves P-384, brainpoolP320r1 and brainpoolP384r1. "ES512" shall be used with curves P-521 and brainpoolP512r1. "EdDSA" shall be used with curves Ed25519 and Ed448. For verifying the signature, the mdoc reader shall support all of these signature algorithms and curves.
The recommendation in RFC 8152 on the use of deterministic ECDSA signatures does not apply to this document.
The certificate containing the public key belonging to the private key used to sign the MSO shall be included as an x5chain element as described in draft-ietf-cose-x509-08[A2]. It shall be included as an unprotected header element. The x5chain element shall include at least one certificate and may contain more.[A3]
NOTE 3	The x5chain element has the temporary identifer 33 registered in the IANA registry.
An example can be found in Annex D.5.2.
9.1.2.5 Message digest function
The issuing authority infrastructure shall use one of the following digest algorithms: SHA-256, SHA-384 or SHA-512 as specified in ISO/IEC 10118-3. In the digestAlgorithm key-value pair in the MSO, the algorithms used shall be identified as defined in Table 21.
Table 21 - Digest algorithm identifiers
Digest algorithm
digestAlgorithm identifier
SHA-256
"SHA-256"
SHA-384
"SHA-384"
SHA-512
"SHA-512"

A digest shall be calculated separately for each data element present on the mdoc and stored in the MSO. The same digest algorithm shall be used for all data elements. Digests are identified by the combination of the NameSpace (see Clause 8.3.1) and the DigestID (see Clause 9.1.2.4). The input for the digest calculation shall be the IssuerSignedItemBytes element (see Clause 8.3.2.1.2.2). Each IssuerSignedItem shall also contain a unpredictable random or pseudorandom value. This value shall be different for each IssuerSignedItem and shall have a minimum length of 16 bytes. The purpose of this value is to ensure that the digest value of the IssuerSignedItem by itself does not provide any information about it contents.
NOTE	It is not necessary for the mdoc reader to retrieve all the data present on the mdoc to verify the received mdoc data; it can verify the signature over the whole MSO and use the Digest ID and namespace for each received data element to find and verify the digest for those data elements in the MSO.
9.1.3 mdoc authentication
9.1.3.1 Purpose
The security objective of mdoc authentication is to prevent cloning of the mdoc and to mitigate man in the middle attacks.
9.1.3.2 Applicability
This mechanism is applicable for an mdoc using device retrieval.
NOTE	If a server retrieval token is retrieved by the mdoc reader in the DeviceSignedItems during device retrieval, mdoc authentication also ensures the authenticity of the server retrieval token. Under these conditions, therefore, mdoc authentication is also applicable for an mdoc using server retrieval.
9.1.3.3 Description
The mdoc private key, which belongs to the mdoc public key stored in the MSO, is used to authenticate the mdoc. It is also used to authenticate the response data contained in the DeviceSignedItems structure (see Clause 8.3.2.1.2.2). The mdoc public key is stored in the MSO, see Clause 9.1.2.4. The mdoc reader assumes that the mdoc is authentic only if the authentication signature or MAC is correct.
Security requirements regarding storage of credential information, including the mdoc private key are out of scope for this document. Additional information on storage of credential information can be found in Annex E.5. 
NOTE	Two mechanisms exist for mdoc authentication, MAC and ECDSA/EdDSA. MAC provides better privacy to the mdoc holder because it does not require the mdoc to produce a potentially non- repudiable signature over mdoc reader-provided data. The mdoc can always deny the MAC value to a third party because the mdoc reader could have produced it by itself. However, the possibility to calculate a MAC may not be available in all security environments on the mdoc.
9.1.3.4 Mechanism
The mdoc authentication key pair consists of a public and a private key (SDeviceKey.Priv, SDeviceKey.Pub). The public key is accessible through the DeviceKey element in the MSO. When cipher suite 1 (see Clause 9.1.5.2) is used, one of the curves from Table 22 shall be used for the device key. 
The mdoc authentication key shall be used to authenticate the mdoc in one of two ways: ECDH-agreed MAC or ECDSA / EdDSA signature. A single mdoc authentication key shall not be used to produce both MACs and signatures during its lifetime. An mdoc reader shall support both approaches.
The data that the mdoc authenticates is the DeviceAuthenticationBytes structure as defined below. The mdoc shall generate this structure and calculate either the MAC or signature. In order to verify the data, the mdoc reader shall generate the structure as well and validate the MAC or signature.
NOTE	The DeviceAuthenticationBytes structure itself is not transferred as part of the mdoc response, only the resulting MAC or signature.
The device authentication structure shall be CBOR encoded and formatted as follows:
; For DeviceMac and DeviceSignature, use a null value for the payload.
; The detached content is DeviceAuthenticationBytes
DeviceMac = COSE_Mac0
DeviceSignature = COSE_Sign1

DeviceAuthenticationBytes = #6.24(bstr .cbor DeviceAuthentication)

DeviceAuthentication = [
    "DeviceAuthentication",
    SessionTranscript,
    DocType,                    ; Same as in mdoc response
    DeviceNameSpacesBytes       ; Same as in mdoc response
]
 
The SessionTranscript element is defined in Clause 9.1.5.1.
The DocType and DeviceNameSpacesBytes shall contain the same data as in the same document element in the mdoc response structure (see Clause 8.3.2.1.2.2)
An mdoc shall only authenticate response data elements in DeviceNameSpaces if the key it is using for mdoc authentication is authorized to authenticate these elements in the KeyAuthorizations structure in the MSO (see Clause 9.1.2.4). The mdoc reader shall validate this authorization as part of validating the mdoc authentication.
If data elements are present in DeviceNameSpaces, an mdoc reader shall verify whether the KeyAuthorizations structure contains the proper authorization.
DeviceMac is defined in Clause 9.1.3.5
DeviceSignature is defined in Clause 9.1.3.6
An example can be found in Annex D.5.3.
 
9.1.3.5 mdoc MAC Authentication
To authenticate the mdoc with mdoc MAC authentication, the mdoc computes the MAC of the device authentication data with an ephemeral MAC key derived (EMacKey) from the mdoc authentication private key and the mdoc reader ephemeral public key. 
The following operations shall be performed when cipher suite 1 (see Clause 9.1.5.2) is used.
To calculate the ephemeral MAC key, the mdoc and the mdoc reader shall perform ECKA-DH (Elliptic Curve Key Agreement Algorithm - Diffie-Hellman) as defined in BSI TR-03111. The inputs shall be the SDeviceKey.Priv and EReaderKey.Pub for the mdoc and EReaderKey.Priv and sDeviceKey.Pub for the mdoc reader. The ZAB output defined in BSI TR-03111 shall be used to derive the ephemeral MAC key.
EMacKey shall be derived using HKDF as defined in RFC 5869 with the following parameters:
* Hash: SHA-256
* IKM: ZAB 
* salt: SHA-256(SessionTranscriptBytes)
* info: "EMacKey" (encoded as a UTF-8 string)
* L: 32 octets
The MAC value is contained in the tag element within DeviceAuth in an untagged COSE_Mac0 structure as defined in RFC 8152 and identified as DeviceMac. Within the COSE_Mac0 structure, the payload shall have a null value. The detached content is DeviceAuthenticationBytes. The 'external_aad' fields shall be a bytestring of size zero.
The alg element (RFC 8152) shall be included as an element in the protected header. Other elements should not be present in the protected header. 
RFC 8152 describes the algorithm identifiers that shall be used in the alg element. "HMAC 256/256" (HMAC with SHA-256) shall be used.
9.1.3.6 mdoc ECDSA / EdDSA Authentication
To authenticate the mdoc with mdoc ECDSA/EdDSA authentication, the mdoc signs the device authentication data with the mdoc authentication private key.  
When cipher suite 1 (see cluase 9.1.5.2) the following operations shall be performed and the mdoc shall use of the ECDSA or EdDSA curves from Table 22 for the mdoc authentication key.
The signature is contained in the signature element in an untagged COSE_Sign1 structure as defined in RFC 8152 and identified as DeviceSignature. Within the COSE_Sign1 structure, the payload shall have a null value. The detached content is DeviceAuthenticationBytes. The 'external_aad' fields shall be a bytestring of size zero.
The alg element (RFC 8152) shall be included as an element in the protected header. Other elements should not be present in the protected header. An mDL shall use one of the following signature algorithms: "ES256" (ECDSA with SHA-256), "ES384" (ECDSA with SHA-384), "ES512" (ECDSA with SHA-512) or "EdDSA" (EdDSA). "ES256" shall be used with curves P-256 and   brainpoolP256r1. "ES384" shall be used with curves P-384, brainpoolP320r1 and brainpoolP384r1. "ES512" shall be used with curves P-521 and brainpoolP512r1. "EdDSA" shall be used with curves Ed25519 and Ed448.
The recommendation in RFC 8152 on the use of deterministic ECDSA signatures does not apply to this document. 
9.1.4 mdoc reader authentication
9.1.4.1 Purpose
mdoc reader authentication uses information stored in the mdoc reader to confirm that the mdoc reader and the mdoc request are authenticated. 
9.1.4.2 Applicability
This mechanism is applicable for an mdoc reader using device retrieval.
9.1.4.3 Description
A private key stored in the mdoc reader is used to authenticate the mdoc reader and to authenticate the mdoc request. The mdoc reader public key is stored in a certificate which is sent to the mdoc within the mdoc request message.
9.1.4.4 Mechanism
The mdoc reader authentication key pair consists of a public and a private key. The public key is accessible through a certificate provided with the mdoc request.
The mdoc reader authentication key may be used to authenticate the mdoc reader by ECDSA/EdDSA signature.
When cipher suite 1 (see cluase 9.1.5.2) the following operations shall be performed and the mdoc reader shall use of the ECDSA or EdDSA curves from Table 22 for the mdoc reader authentication key.
The data that the mdoc reader authenticates is the ReaderAuthentication structure as defined below. The mdoc reader shall generate this structure and calculate the signature. In order to verify the data, the mdoc shall generate the structure as well and validate the signature.
The signature is contained in an untagged COSE_Sign1 structure as defined in RFC 8152 and identified as ReaderAuth. Within the COSE_Sign1 structure, the payload shall have a null value. The detached content is ReaderAuthenticationBytes. The 'external_aad' fields shall be a bytestring of size zero.
The alg element (RFC 8152) shall be included as an element in the protected header.  An mdoc reader should use one of the following signature algorithms: "ES256" (ECDSA with SHA-256), "ES384" (ECDSA with SHA-384), "ES512" (ECDSA with SHA-512) or "EdDSA" (EdDSA). "ES256" shall be used with curves P-256 and brainpoolP256r1. "ES384" shall be used with curves P-384, brainpoolP320r1 and brainpoolP384r1. "ES512" shall be used with curves P-521 and brainpoolP512r1. "EdDSA" shall be used with curves Ed25519 and Ed448.
The recommendation in RFC 8152 on the use of deterministic ECDSA signatures does not apply to this document.
NOTE	The ReaderAuthentication structure itself is not transferred as part of the mdoc request, only the resulting signature.
The reader authentication structure shall be CBOR encoded and formatted as follows:
; For ReaderAuth, use a null value for the payload.
; The detached content is ReaderAuthenticationBytes
ReaderAuth = COSE_Sign1

ReaderAuthenticationBytes = #6.24(bstr .cbor ReaderAuthentication)

ReaderAuthentication = [
    "ReaderAuthentication",
    SessionTranscript,
    ItemsRequestBytes           ; Same as in mdoc request
]

 
The SessionTranscript element is defined in Clause 9.1.5.1
The ItemsRequestBytes shall contain the same data as in the mdoc request structure (see Clause 8.3.2.1.2.1)
ReaderAuth is defined above in this clause.
The certificate containing the mdoc reader public key shall be included as a x5chain element as described in draft-ietf-cose-x509-08[A4]. It shall be included as an unprotected header element. The x5chain element shall include at least one certificate and may contain more.
NOTE 2	The x5chain element has the temporary identifer 33 registered in the IANA registry.

9.1.5 Session transcript and cipher suite
9.1.5.1 Session transcript
The session transcript structure is used in multiple security mechanisms for device retrieval. The session transcript shall be CBOR encoded and formatted as follows:
SessionTranscriptBytes = #6.24(bstr .cbor SessionTranscript)

SessionTranscript = [
    DeviceEngagementBytes,
    EReaderKeyBytes,
    Handover
]

DeviceEngagementBytes = #6.24(bstr .cbor DeviceEngagement)

Handover = QRHandover / NFCHandover

QRHandover= null

NFCHandover = [
    bstr        ; Binary value of the Handover Select Message
    bstr / null ; Binary value of the Handover Request Message,
                ; shall be null if NFC Static Handover was used
]


DeviceEngagement is defined in Clause 8.2.1.1.
EReaderKeyBytes is defined in Clause 9.1.2.4.
The content of Handover depends on the device engagement method that was used. If device engagement using QR code (see Clause 8.2.2.3) was used, the contents shall be QRHandover. If device engagement using NFC (see Clause 8.2.2.1) was used, the contents shall be NFCHandover.
The first element in the NFCHandover array shall be the binary value of the Handover Select Message as retrieved by the mdoc reader from the mdoc. The second element in the NFCHandover array shall be the Handover Request Message sent by the mdoc reader to the mdoc during NFC Negotiated Handover, or null if the Handover Request Message was not present because NFC Static Handover was used.
9.1.5.2 Cipher suite
Device retrieval security mechanisms support multiple cipher suites to indicate which algorithms and operations shall be performed. This document only describes the algorithms and operations for one cipher suite, which is identified by the value 1. The mdoc indicates which cipher suite shall be used in the device engagement structure (see Clause 8.2.1.1).
When cipher suite 1 is used, curves from Table 22 shall be used by the device retrieval security mechanisms. Support for all curves is mandatory for an mdoc reader. 
The COSE_Key structures should not contain optional parameters except for the x, y and crv parameters. The mdoc and mdoc reader should ignore other optional parameters.
If the curve indicated in EReaderKey is a double coordinate curve as specified in RFC 8152 Section 13.1.1, the uncompressed form shall be used for the public key. For the public key in EdeviceKey, either the uncompressed or the compressed form may be used in case a double coordinate curve is used.
When EDeviceKey or EReaderKey is transferred, the uncompressed form shall be used for the public key, except for transfer in the device engagement structure, where both the uncompressed and the compressed form may be used.
The brainpool curves shall have COSE Key Type EC2[A5]. COSE Key Types for other curves are specified in the IANA COSE registry.
Table 22 - Elliptic curves for cipher suite 1
Definition
Specification
Curve identifier
Purpose
Curve P-256
FIPS PUB 186-4
IANA COSE registry
ECDH/ECDSA
Curve P-384
FIPS PUB 186-4
IANA COSE registry
ECDH/ECDSA
Curve P-521
FIPS PUB 186-4
IANA COSE registry
ECDH/ECDSA
X25519
RFC 7748
IANA COSE registry
ECDH
X448
RFC 7748
IANA COSE registry
ECDH
Ed25519
RFC 8032
IANA COSE registry
EdDSA
Ed448
RFC 8032
IANA COSE registry
EdDSA
brainpoolP256r1
RFC 5639
IANA COSE registry
ECDH/ECDSA
brainpoolP320r1
RFC 5639
IANA COSE registry
ECDH/ECDSA
brainpoolP384r1
RFC 5639
IANA COSE registry
ECDH/ECDSA
brainpoolP512r1
RFC 5639
IANA COSE registry
ECDH/ECDSA

NOTE 1	For IANA COSE registries, see COSE (CBOR Object Signing and Encryption) Elliptic Curves in IANA (Internet Assigned Numbers Authority) Protocols Registries. The URL of the IANA COSE registries is https://www.iana.org/assignments/cose/cose.xhtml
NOTE 2	In accordance with RFC 8152, the CDDL grammar describing a COSE_Key as used in the device retrieval security mechanisms is: 
COSE_Key = {
   1 => int,	        		; kty: key type
  -1 => int, 	    		; crv: EC identifier - Taken from the "COSE Elliptic Curves" registry
  -2 => bstr,			; x: value of x-coordinate
  ? -3 => bstr / bool	; y: value or sign bit of y-coordinate; only applicable for EC2 key tyes 
}

9.2 Server retrieval
9.2.1 TLS
Communication between the mdoc reader and the issuing authority infrastructure shall use Transport Layer Security with server authentication and optionally with client authentication. The mdoc reader and the issuing authority infrastracture shall support TLS version 1.2 as specified in RFC 5246 and may support TLS version 1.3 as specified in [18] . 
The mdoc reader shall act as the TLS client and the issuing authority infrastructure as the TLS server. The mdoc reader and the issuing authority infrastructure may support TLS client authentication. The key pairs used for the TLS authentication shall not be used for other purposes.
If the TLS server indicates in its TLS server certificate the support of the Online Certificate Status Protocol (OCSP), the TLS server shall support the TLS mechanisms to exchange the OCSP status information. More specifically for TLS version 1.2 the TLS server shall support the certificate status request for OCSP specified in RFC 6066 Section 8. If the server supports TLS version 1.3 it shall support the TLS version 1.3 mechanisms to exchange the OCSP status information.
An mdoc reader requesting OCSP status information for the TLS server certificate shall use the corresponding TLS mechanisms to request this information. 
The TLS connection shall use one of the cipher suites listed in Table 23. The mdoc reader and issuing authority infrastructure shall support TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 and TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 and should support TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256.
Table 23 - TLS cipher suites
Cipher suite
Reference
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
RFC 8422
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
RFC 8422
TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256
RFC 7905
The key exchange shall make use of an elliptic curve listed in the NamedCurve enumeration in section 5.1.1 of RFC 8422. No deprecated or reserved curves shall be used.
9.2.2 JWS
A JWT sent by an issuing authority infastructure to an mdoc reader shall be protected using a JSON Web Signature (JWS) as specified in RFC 7515. The JWS is signed with a private key and the JWS signer certificate corresponding to the private key shall be provided in the JOSE Protected Header in the x5c parameter according to RFC 7515. The alg parameter according to RFC 7515 shall be included in the JOSE Protected Header. One of the following JSON Web Algorithms (JWA; RFC 7518) shall be used:
a)	ES256: ECDSA using Curve P-256 and SHA-256
b)	ES384: ECDSA using Curve P-384 and SHA-384
c)	ES512: ECDSA using Curve P-521 and SHA-512
Critical JOSE Header parameters shall not be used. Other optional JOSE Header Parameters should not be used. JWS Compact Serialization shall be used.
Upon receiving a JWT/JWS, the mdoc reader shall perform the inspection procedure as described in Clause 9.3.2
An example can be found in Annex D.5.4.
9.3 Validation and inspection procedures
9.3.1 Inspection procedure for issuer data authentication
The mdoc reader shall perform the following or functionally equivalent steps to verify that the received data is authentic and valid:
1. Validate the certificate included in the MSO header according to Clause 9.3.3.
2. Verify the digital signature of the IssuerAuth structure (see Clause 9.1.2.4) using the working_public_key, working_public_key_parameters, and working_public_key_algorithm from the certificate validation procedure of step 1.
3. Calculate the digest value for every IssuerSignedItem returned in the DeviceResponse structure according to Clause 9.1.2.5 and verify that these calculated digests equal the corresponding digest values in the MSO.
4. Verify that the DocType in the MSO matches the relevant DocType in the Documents structure.
5. Validate the elements in the ValidityInfo structure, i.e. verify that
o the 'signed' date is within the validity period of the certificate in the MSO header,
o the current timestamp shall be equal or later than the 'validFrom' element,
o the 'validUntil' element shall be equal or later than the current timestamp
9.3.2 Inspection procedure for JWS
The mdoc reader shall validate the received JWT, verify that the JWT is a JWS and validate the JWT according to RFC 7519 Section 7.2 (or perform functionally equivalent steps) to verify that the received data is authentic and valid. In addition, the mdoc reader shall perform the following steps:
a) Validate the certificate included in the JWS header according to Clause 9.3.3.
b) Verify that the alg header parameter denotes one of the JSON Web Algorithms listed in Clause 9.2.2.
c) Verify the digital signature using the algorithm specified in the alg header parameter, the working_public_key, working_public_key_parameters, and working_public_key_algorithm from the JWS signer certificate validation procedure.
d) Validate the JWT claims 'iat' (issued at) and 'exp' (expiration time), i.e. verify that
a. The current time shall be equal or later than the 'iat' date.
b. The 'exp' date shall be equal or later than the current time.
9.3.3 Certificate validation procedure
This clause specifies the certification path validation procedure for certificates issued under an IACA certificate or under another CA as trust anchor. mdoc readers, mdocs and issuing authority infrastructures performing the certification path validation shall store the relevant trust anchor certificates or the information extracted from these trust anchor certificates that is required for the certification path validation in a way that preserves the availability and the authenticity of the information. Additionally, they shall have access to certificate revocation information.
This document does not mandate methods to obtain and/or to establish trust in IACA certificates and other certificates that serve as trust anchors for certification path validation. It is the responsibility of the person or organization responsible for the mdoc reader to obtain and/or to establish trust in the IACA certificates used to verify the certificates issued by the IACA, such as DS or JWS signer certificates. It is the responsibility of the issuing authority to obtain and/or to establish trust in certificates that are used as trust anchors to validate mdoc reader authentication certificates and TLS client authentication certificates.
However, examples of methods and approaches to establish such trust in IACA certificates are provided in Annex C, which describes a method for distribution for IACA certificates. In any case, the issuing authority shall publicly publish its issuing authority certificate authority (IACA) certificate. This document does not prescribe methods for the generation, administration, and safekeeping of key pairs. It is the responsibility of each issuing authority to ensure that keys are generated, administered, and protected as necessary.
mdoc readers, mdocs and issuing authority infrastructures performing certification path validation shall apply the RFC 5280, Section 6.1 basic path validation. Furthermore, the following steps shall be performed for certificates issued by the IACA:
* Verify that the countryName element in the subject of the IACA certificate and the countryName element in the subject of the target certificate issued under the IACA certificate are the same.
* Verify that the stateOrProvinceName element in the subject of the IACA certificate and the stateOrProvinceName element in the subject of the target certificate issued under the IACA certificate are the same if this element is present in both certificates.
If this validation succeeds it returns the final value of the working_public_key, the working_public_key_algorithm, and the working_public_key_parameters.
Annex B.3.1 illustrates how the certification path validation can be used for an end-entity certificates issued by the IACA.
Annex B.3.2 illustrates how the CRL validation and revocation checking can be used for an end-entity certificate issued by the IACA.


Annex 
(informative)

BLE L2CAP transmission profile
The GATT server shall indicate support for the L2CAP transmission profile by making the L2CAP characteristic available next to the characteristics defined in Clause 8.3.3.1.1.4. Table A.1 shows the characteristic which the GATT server shall expose. The contents of the characteristics shall be the Protocol Service Multiplexer (PSM).
Table A.1 - L2CAP service characteristics
Service
Characteristic name
UUID
Mandatory properties
mdoc
L2CAP
0000000A- A123-48CE-896B-4C76973373E6
Read
mdoc reader
L2CAP
0000000B- A123-48CE-896B-4C76973373E6
Read
 
If after reading the L2CAP service the GATT client decides to use the L2CAP transmission method, it shall establish an L2CAP connection-oriented channel according to Bluetooth SIG, Bluetooth Core Specification, Version 5.2, December 2019, Vol 3, Part A, Section 4.
The contents of the data sent shall be as defined in Clause 8.3.3.1.6.
Annex 
(normative)

Certificate and CRL profiles [A6]
B.1 Certificate profiles
B.1.1 Overview
The certificate profiles defined in this annex are mandatory except for the mdoc reader authentication and TLS client authentication certificate profiles in Annex B.1.7 and Annex B.1.8, which are recommended.
The IACA root certificate is the root certificate used to issue all end-entity certificates, except possibly mdoc reader authentication and TLS client authentication certificates. Sub-CAs shall not be used. The allowed usage of the end-entity certificates is defined using the extended key usage extension. All end-entity certificates signed by an IACA root certificate shall contain the same country code as the IACA certificate. An IACA certificate may contain the stateOrProvinceName element to indicate that this IACA certificate only issues mDLs within a particular state or province. If the element is present in an IACA certificate, it shall also be present and have the same value in the end-entity certificates signed by that IACA certificate.
The IACA root certificate shall use the IACA root certificate profile as defined in Annex B.1.2
If an IACA link certificate is created, it shall use the IACA link certificate profile as defined in Annex B.1.3
For issuer data authentication (see Clause 9.1.2), the issuing authority shall use the mDL document signer certificate profile as defined in Annex B.1.4. This certificate is included in the x5chain element of IssuerAuth (see Clause 9.1.2.4). The IACA root certificate shall not be included in the x5chain element.
NOTE 1	If the x5chain contains multiple certificates, the first element in the x5chain array is the mDL DS certificate. mdoc readers using only IACA root certificates for validation of DS certificates do not need to parse any element beyond the first in the x5chain array.
For JWS, the issuing authority shall use the JWS signer certificate profile as defined in Annex B.1.5. This certificate is included in the x5c parameter of the JWS (see Clause 9.2.2). The IACA root certificate shall not be included in the x5c parameter.
NOTE 2	If the x5c parameter contains multiple certificates, the first element in the x5c array is the JWS signer certificate. mdoc readers using only IACA root certificates for validation of JWS signer certificates do not need to parse any element beyond the first in the x5c array.
TLS server certificates (see Clause 9.2.1) shall use the TLS server certificate profile as defined in Annex B.1.6
For mdoc reader authentication (see Clause 9.1.4), mDLs and mDL readers should use the mdoc reader authentication certificate profile as defined in Annex B.1.7.
For TLS client authentication (see Clause 9.2.1), mDL readers and issuing authority infrastructures should use the TLS client certificate profile as defined in Annex B.1.8.
If a certificate indicates support for OCSP, the OCSP signer certificate shall comply with the OCSP signer certificate profile as defined in Annex B.1.9.
The CRL indicated in an IACA root certificate, an IACA link certificate and any certificate signed by an IACA root certificate shall comply with the requirements in Annex B.2.
All certificates shall be DER encoded.
For each certificate profile, the presence column indicates whether an element is mandatory M), optional (O) or conditional (C). The criticality column indicates whether an element is critical (C) or non-critical (NC).
The following extensions shall not be used:
?PolicyMappings
?NameConstraints
?PolicyConstraints
?InhibitAnyPolicy
?FreshestCRL
Certificates in this Annex use OIDs for extended key usage extension. The OIDs have the following definition:
id-mdl OBJECT IDENTIFIER ::= { iso(1) standard(0) 18013 5 }
id-mdl-kp OBJECT IDENTIFIER ::= { id-mdl 1 } - - arc for extended key purposes
id-mdl-kp-mdlDS OBJECT IDENTIFIER ::= { id-mdl-kp 2 } - - arc for mDL DS
id-mdl-kp-mdlJWS OBJECT IDENTIFIER ::= { id-mdl-kp 3 } - - arc for JWS
id-mdl-kp-mdlReaderAuth OBJECT IDENTIFIER ::= { id-mdl-kp 6 } - - arc for mdoc reader authentication used by mDL readers
id-mdl-kp-mdlTLSClientAuth OBJECT IDENTIFIER ::= {id-mdl-kp 9} - - arc for TLS client authentication used by mDL readers
id-mdl-kp-mdlIACALink OBJECT IDENTIFIER ::= { id-mdl-kp 4 } - - arc for mDL IACA Link
id-mdl-kp-mdlIACA OBJECT IDENTIFIER ::= { id-mdl-kp 7} - arc for mDL IACA[A7]



B.1.2 IACA root certificate
This certificate profile defines the IACA root certificate, establishing the allowed security parameters for interoperability. The IACA root certificate is used as the root for all certificates defined in this annex. One IACA root certificate may be used by multiple issuing authorities within one country. See Table B.1 for details.
Issuing authorities should define the validity period of the IACA root certificate as the sum of:
?the longest validity length of the end entity certificates to be issued (e.g. document signer certificates, JWS signer certificates, TLS server certificates or OCSP signer certificates);
?usage period: time during which end entity certificates will be issued;
?lead times: time required to create and disseminate the IACA root certificate before its usage period.
NOTE	The longest validity length of the end entity certificates includes any document signer certificates for IDLs with a secure integrated circuit. IDLs with a secure integrated circuit and the corresponding document signer certificates typically have a longer maximum validity than document signer certificates for mDLs.
The private key usage period shall be carefully set, balancing the risk of having too many documents issued under the same IACA root certificate against the efforts and lead time required to create new IACA root certificates. The recommended period is between 3 to 5 years.
This document defines the IACA certificate as a self-signed root certificate for optimized performance and maximum cross-border interoperability. 
The IACA public key can additionally be used in other PKI schemes e.g. signed by a top root national CA or cross-signed by another authority. Those additional uses and the distribution mechanisms are outside the scope of this document.
Table B.1 - IACA root certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

countryName is mandatory. The value shall be in upper case and contain the ISO 3166-1 alpha-2 code of the issuing country, exactly the same value as in the issuing country data element. The countryName shall be PrintableString.
stateOrProvinceName is optional. If this element is present, the element shall also be present in the end-entity certificates and hold the same value. The value shall exactly match the value of the data element "issuing_jurisdiction", if that element is present on the mDL.
organizationName is optional. Its value is at the discretion of the IACA.
commonName shall be present. Its value is at the discretion of the IACA.
serialNumber is optional. If present, it shall be a PrintableString.
Attributes that have a DirectoryString and for which the encoding is not listed above syntax shall be either PrintableString or UTF8String.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 20 years after "Not before" date.
NOTE  The 20-year validity period results from the possibility of using the IACA root certificate for issuing an IDL according to ISO/IEC 18013-3, which allows the use of DS certificates with validity periods up to 15 years. If the IACA root certificate is only used to issue mDLs, a maximum validity period of 9 years is sufficient.
Subject
4.1.2.6
M

Same exact binary value as Issuer.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



0
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



1
	CRL signature



1
	Encipher only



0
	Decipher only



0
Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE     This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Basic constraints
4.2.1.9
M
C
 
	CA

M

TRUE
	pathLenConstraint

M

0
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the IACA.
Key
Presence:
M  mandatory
O   optional
Criticality:
C    critical
NC  not critical
B.1.3 IACA link certificate
This certificate profile defines the IACA link certificate, establishing the allowed security parameters for interoperability. The IA should generate and distribute an IACA link certificate when doing an IACA re-key. The link certificate establishes a trust path from the old IACA root certificate to the new one. See Table B.2 for details.
Table B.2 - IACA link certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

Same exact binary value as the subject in the old IACA root certificate, for which the respective private key is signing this link certificate.
Validity
4.1.2.5
M


	Not before

M

Date on which the link certificate validity period begins.
	Not after

M

Date shall not be after the "Not After" date of the old IACA root certificate.
Subject
4.1.2.6
M

Same exact binary value as Issuer in the new IACA root certificate.
Subject public key info
4.1.2.7
M

Same as the subject public key info in the new IACA root certificate.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the old IACA root certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



0
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



1
	CRL signature



1
	Encipher only



0
	Decipher only



0
Subject alternative name
4.2.1.6
C
NC
The presence is conditional. If the IACA wants to change the DN when doing a CA rollover, the subject alternative name extension shall include a directoryName entry with the new Issuer DN.
Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE     This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Basic constraints
4.2.1.9
M
C
 
	CA

M

TRUE
	pathLenConstraint

M

0
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the Public Key and DN of new IACA root certificate.
Key
Presence:
M  mandatory
O   optional
C   conditional
Criticality:
C    critical
NC  not critical


B.1.4 mDL document signer certificate 
This certificate is used to sign the mobile security object in the device retrieval mdoc response.
Additional information on privacy and security can be found in Annex E.6.
NOTE 1	A method to enhance its security is for the issuing authority to use certificates that have a short lifespan (for example a few weeks), and if a compromise is detected, to revoke the document signer certificate and reissue and disseminate to all concerned mDL updated data signed with a new document signer certificate.

Table B.3 - mDL document signer certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

Same exact binary value as the subject of IACA certificate.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of  457 days after "Not before" date.
Subject
4.1.2.6
M

countryName is mandatory. The value shall be in upper case and contain the ISO 3166-1 alpha-2 code of the issuing country, exactly the same value as in the issuing country data element. The countryName shall be PrintableString.
stateOrProvinceName is optional. If this element is present in the IACA root certificate, this element shall be present and hold the same value. The value shall exactly match the value of the data element "issuing_jurisdiction", if that element is present on the mDL.
organizationName is optional. Its value is at the discretion of the IACA.
commonName shall be present. Its value is at the discretion of the IACA.
localityName is optional. Its value is at the discretion of the IACA.
serialNumber is optional. If present, it shall be a PrintableString.
Attributes that have a DirectoryString and for which the encoding is not listed above syntax shall be either PrintableString or UTF8String.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
Or one of the following curves specified in RFC 8410:
1.3.101.112(Curve Ed25519)
1.3.101.113(Curve Ed448)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the IACA root certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Subject alternative name
4.2.1.6
O
NC

Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE 2    This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	Key usage

M

1.0.18013.5.1.2 (mdlDS)
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the document signer.
Key
Presence:
M  mandatory
O   optional
Criticality:
C    critical
NC  not critical
B.1.5 JWS signer certificate
The JWS signer certificate is used to sign all data returned using the server retrieval methods. See Table B.4 for details.
Table B.4 -JWS signer certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

Same exact binary value as the subject of IACA certificate.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 457 days after "Not before" date.
Subject
4.1.2.6
M

countryName is mandatory. The value shall be in upper case and contain the ISO 3166-1 alpha-2 code of the issuing country, exactly the same value as in the issuing country data element. The countryName shall be PrintableString.
stateOrProvinceName is optional. If this element is present in the IACA root certificate, this element shall be present and hold the same value. The value shall exactly match the value of the data element "issuing_jurisdiction", if that element is present on the mDL.
organizationName is optional. Its value is at the discretion of the IACA.
commonName shall be present. Its value is at the discretion of the IACA.
localityName is optional. Its value is at the discretion of the IACA.
serialNumber is optional. If present, it shall be a PrintableString.
Attributes that have a DirectoryString and for which the encoding is not listed above syntax shall be either PrintableString or UTF8String.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with a curve list in Clause 9.2.2
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the IACA root certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Subject alternative name
4.2.1.6
O
NC

Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE     This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	Key usage

M

1.0.18013.5.1.3 (mdlJWS)
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the issuing authority.
Key
Presence:
M  mandatory
O   optional
Criticality:
C    critical
NC  not critical


B.1.6 TLS server certificate - issuing authority
The TLS server certificate is used to protect the server retrieval methods using TLS. See Table B.5 for details.
Table B.5 - TLS server certificate: issuing authority
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

Same exact binary value as the subject of IACA certificate.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 822 days after "Not before" date.
Subject
4.1.2.6
M

countryName is mandatory. The value shall be in upper case and contain the ISO 3166-1 alpha-2 code of the issuing country, exactly the same value as in the issuing country data element. The countryName shall be PrintableString.
stateOrProvinceName is optional. If this element is present in the IACA root certificate, this element shall be present and hold the same value. The value shall exactly match the value of the data element "issuing_jurisdiction", if that element is present on the mDL.
organizationName is optional. Its value is at the discretion of the IACA.
commonName shall be present. Its value is at the discretion of the IACA.
localityName is optional. Its value is at the discretion of the IACA.
serialNumber is optional. If present, it shall be a PrintableString.
Attributes that have a DirectoryString and for which the encoding is not listed above syntax shall be either PrintableString or UTF8String.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the IACA root certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1 (mandatory)
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Subject alternative name
4.2.1.6
M
NC

	dNSName

M

Internet domain name of the server. Can have more than one dNSName.
Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE    This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	id-kp-serverAuth

M

TLS server authentication.
	id-kp-clientAuth

O

TLS client authentication. Optional, to handle particular cases where the issuing authority service may need to act also as TLS client of third-party systems.
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Private internet extensions




Authority information access
4.2.2.1
C
NC
Conditional, shall be present if the IACA has an OCSP service.
	Access description
	OCSP

C

Conditional, shall be present if the CA issuing this certificate has an OCSP service.
	accessMethod

M

1.3.6.1.5.5.7.48.1 (OCSP)
	accessLocation

M

URI for corresponding OCSP service.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the IACA online service.
Key
Presence:
M  mandatory
O   optional
C   conditional
Criticality:
C    critical
NC  not critical
B.1.7 mdoc reader authentication
The mDL reader should use the certificate profile according to Table B.6 for mdoc reader authentication (see Clause 9.1.4).
Table B.6 - mdoc reader authentication
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

The same binary value as the Subject of a CA certificate used for mdoc reader authentication. 
NOTE  This CA certificate, and the manner in which it is trusted by an mDL, is out of scope of this document.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 1187 days after "Not before" date.
Subject
4.1.2.6
M

commonName shall be present.
Other elements may be present in the Subject field.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
Or one of the following curves specified in RFC 8410: 
1.3.101.112(Curve Ed25519)
1.3.101.113(Curve Ed448)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the Issuer CA certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subjectPublicKey BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1 (mandatory)
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0 
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Issuer alternative name
4.2.1.7
C
NC
Conditional, this extension shall be present if the certificate is issued by an IACA. 
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose, the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE  2    This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	

M

1.0.18013.5.1.6 (mdlReaderAuth)
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Private internet extensions




Authority information access
4.2.2.1
C
NC
Conditional, shall be present if the CA issuing this certificate has an OCSP service or would like to indicate other Access Description elements.
	Access description
	OCSP

C

Conditional, shall be present if the CA issuing this certificate has an OCSP service.
	accessMethod

M

1.3.6.1.5.5.7.48.1 (OCSP)
	accessLocation

M

URI for corresponding OCSP service.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the mDL reader.
Key
Presence:
M  mandatory
O   optional
C   conditional
Criticality:
C    critical
NC  not critical

B.1.8 TLS client authentication certificate
The mdoc reader should use the certificate profile according to Table B.7 for TLS client authentication (see Clause 9.2.1).
Table B.7 - TLS client authentication certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

The same binary value as the Subject of a CA certificate used for mdoc reader authentication. 
NOTE  This CA certificate, and the manner in which it is trusted by an mDL, is out of scope of this document.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 1187 days after "Not before" date.
Subject
4.1.2.6
M

commonName shall be present.
Other elements may be present in the Subject field.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the Issuer CA certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subjectPublicKey BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1 (mandatory)
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0 
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Issuer alternative name
4.2.1.7
C
NC
Conditional, this extension shall be present if the certificate is issued by an IACA. 
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose, the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE  2    This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	

M

1.0.18013.5.1.9 (mdlTLSClientAuth)
	id-kp-clientAuth

M

Allows the usage of TLS based client authentication.
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Private internet extensions




Authority information access
4.2.2.1
C
NC
Conditional, shall be present if the CA issuing this certificate has an OCSP service or would like to indicate other Access Description elements.
	Access description
	OCSP

C

Conditional, shall be present if the CA issuing this certificate has an OCSP service.
	accessMethod

M

1.3.6.1.5.5.7.48.1 (OCSP)
	accessLocation

M

URI for corresponding OCSP service.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the mDL reader.
Key
Presence:
M  mandatory
O   optional
C   conditional
Criticality:
C    critical
NC  not critical



B.1.9 OCSP signer certificate 
The OCSP signer certificate is used to sign OCSP messages. See Table B.8 for details.
Table B.8 - OCSP signer certificate
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

Same exact binary value as the subject of IACA certificate.
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

If the OCSP signer certificate supports the CRLDistributionPoints extension: Maximum of 457 days after "Not before" date.
If the OCSP signer certificate supports the Revocation Checking of an Authorized Responder extension: Maximum of 90 days after "Not before" date.
Subject
4.1.2.6
M

countryName is mandatory. The value shall be in upper case and contain the ISO 3166-1 alpha-2 code of the issuing country, exactly the same value as in the issuing country data element. The countryName shall be PrintableString.
stateOrProvinceName is optional. If this element is present in the IACA root certificate, this element shall be present and hold the same value. The value shall exactly match the value of the data element "issuing_jurisdiction", if that element is present on the mDL.
organizationName is optional. Its value is at the discretion of the IACA.
commonName shall be present. Its value is at the discretion of the IACA.
localityName is optional. Its value is at the discretion of the IACA.
serialNumber is optional. If present, it shall be a PrintableString.
Attributes that have a DirectoryString and for which the encoding is not listed above syntax shall be either PrintableString or UTF8String.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the IACA root certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



1
	Non repudiation



0
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Subject alternative name
4.2.1.6
O
NC

Issuer alternative name
4.2.1.7
M
NC
The issuer alternative name extension shall provide contact information for the issuer of the certificate. For that purpose the issuer alternative name shall include at least one of
   ?  rfc822Name, or
   ?  uniformResourceIdentifier.
NOTE     This contact information is intended to help establish trust in the certificate and the certified key by appropriate out of band mechanisms. Note that this information is only meant for contact information and does not in itself imply any level of trust in the certificate.
Extended key usage
4.2.1.12
M
C

	id-kp-OCSPSigning

M

OCSP signing delegation, see [16].
CRLDistributionPoints
4.2.1.13
C
NC
Either this extension or the Revocation checking of an authorized responder extension shall be present.
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Revocation checking 
of an authorized 
responder

C
NC
See [16], 4.2.2.2.1.
Either this extension or the CRLDistributionPoints extension shall be present.
	id-pkix-ocsp-
	nocheck




Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate.
Key
Presence:
M  mandatory
O   optional
C  conditional
Criticality:
C    critical
NC  not critical

B.2 CRL profile
An IACA shall generate certificate revocation information in accordance with the Certificate Revocation List (CRL) format specified in Table B.9. This CRL shall be a full and complete CRL, i.e. list all unexpired certificates issued by the IACA that have been revoked for any reason. This CRL may contain revocation information for IACA issued certificates that are not standardized in this document. An IACA shall not use an indirect or delta CRL.
If no certificates have been revoked since the last CRL was issued, an IACA shall issue a new CRL at least every 90 days. An IACA may issue CRLs more frequently than every 90 days.
If a certificate is revoked, the IACA shall issue a new CRL indicating this revocation within 48 hours.
The CRL profile as defined in Table B.9 shall be used.
Table B.9 - CRL profile
CRL component
Section in RFC 5280
Presence
Criticality
Comments
Version
5.1.2.1
m

Shall be v2.
Signature
5.1.2.2
m

Value shall match the OID in the signature algorithm (below).
Issuer name
5.1.2.3
m

Same exact binary value as Subject of IACA certificate.
This update
5.1.2.4
m

Issue date of this CRL.
Next update
5.1.2.5
m

The next CRL will be issued no later than the next update date.
Revoked certificates
5.1.2.6
c

Conditional, shall not be present if there are no revoked certificates, If present, shall not be empty. Each CRL entry in the revoked certificates list shall contain the serial number of the revoked certificate and the revocation date. CRL entry extensions shall not be used.
CRL extensions
5.2


Further extensions shall not be present.
	Authority key 
	identifier
5.2.1
m
NC

	keyIdentifier

m

Same value as the subject key identifier of the IACA certificate.
       CRL number
5.2.3
m
NC
Sequential CRL number, increased monotonically at each new CRL issued.
Signature algorithm
5.1.1.1
m

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
5.1.1.2
m

Value according to signature algorithm.
Key
Presence:
M  mandatory
C   conditional
Criticality:
C    critical
NC  not critical
B.3 Certificate path and CRL validation examples
B.3.1 Certificate path validation example
This clause gives an example on how the requirements from Clause 9.3.3 apply to the certification path validation of an end-entity certificate issued by the IACA. This example does not include all steps from the path validation procedure as defined in RFC 5280. Those steps can be included when appropriate.
Use the following items from RFC 5280 Section 6.1.1 as input values:
(a) Path length is 0
(b) Current date/time
(d) Take from the IACA certificate:
 	(1) issuer name
 	(2) public key algorithm
    (3) public key 
 	(4) public key parameters associated with the public key

Initialize the following values from RFC 5280 Section 6.1.2:
(g) working_public_key_algorithm from IACA certificate
(h) working_public_key from IACA certificate
(i) working_public_key_parameters from IACA certificate
(j) working_issuer_name from IACA certificate
(k) Path length is 0

Perform the following steps from RFC 5280 Section 6.1.3:
(a) verify step (1), (2), (3) and (4). If step (3) determines the revocation status by means of a CRL, B.3.2 gives an example on how the CRL validation can be performed.
The following steps are be performed:
* Assign the certificate subjectPublicKey to working_public_key.
* Assign the subjectPublicKeyInfo parameters, i.e. the namedCurve, to the working_public_key_parameters variable.
* Assign the certificate subjectPublicKey algorithm to the working_public_key_algorithm variable.
* Verify the extended key usage extension in the target certificate contains the identifier for the certificate type as specified in Annex B.
* Process all critical extensions present in the certificate. Reject the certificate if it contains a critical extension that is not recognized or that contains information that cannot be processed.
The following steps are be performed:
* Process any other recognized non-critical extensions present in the certificate. Reject the certificate if these extensions contain information that cannot be processed.
* Verify that the countryName element in the subject of the IACA certificate and countryName element in the target certificate are the same.
B.3.2 CRL validation example
This clause gives an example on how the requirements from Clause 9.3.3 apply to the CRL validation and certificate revocation checking of an end-entity certificate issued by the IACA.
Use the following items from RFC 5280 Section 6.3.1 as input values:
(a) certificate: certificate serial number and issuer name

Initialize the following values from RFC 5280 Section 6.3.2:
(b) Initialize the cert_status to the special value UNREVOKED.

Perform the following steps from RFC 5280 Section 6.3.3:
(a) Obtain the latest available CRL of the IACA that issued the certificate. The latest available CRL may be a cached list e.g. on the mDL reader.
(b) Verify that the CRL and the target certificate are issued by the same IACA.
(g) Validate the signature on the CRL using the public key from the IACA certificate.
(j) Search for the target certificate on the CRL. If an entry is found that matches the certificate issuer and serial number set the cert_status variable to UNSPECIFIED. If no entry is found, the cert_status variable stays UNREVOKED.

If step (a), (b) or (g) is not successful, set the cert_status variable to UNDETERMINED and terminate the process.


Annex 
(informative)

Verified issuer certificate authority list (VICAL) provider
C.1 mDL VICAL provider policy and security requirements
C.1.1 General
C.1.1.1 Overview
The decentralized PKI trust model adopted by the mDL requires a mechanism to distribute and disseminate the set of certification authorities' certificates by issuing authorities. Furthermore, the lack of a global organization having oversight over the mDL ecosystem and willing to play an operational role (as is the case of ICAO for the electronic passport) limits the possibility of having a single central repository with all the IACA certificates and working as the reference trust anchor for all mDL participants.
In this context, a mechanism referred to as VICAL is hereby described whereby an entity (Provider) can compile, operate and provide such a trust anchor in the form of a service to mDL participants. As this service plays a critical role on the overall security and interoperability of the mDLs, a minimum set of security requirements are defined.
The VICAL Provider shall document the service it provides in a policy of technical and procedural controls. The policy shall follow the structure of this annex and be compliant with the respective requirements, which are mostly based on [3] and [4]. VICAL providers can further extend the policy with additional matters (e.g. business, legal, etc.). This policy should not be the only item used to assess the trustfulness of a VICAL Provider.
This annex does not prescribe the nature or governance of a VICAL Provider. In particular, it does not preclude a scenario where multiple VICAL Providers may coexist, from public and/or private entities, competing and/or collaborating. However, it is expected that the VICAL information provided is consistent amongst different VICAL Providers.
Finally, the VICAL is provided as one possible mechanism of setting a secure and interoperable Trust Model. It does not preclude other possible mechanisms, such as bilateral and/or regional agreements.
This annex may be used for mDL as well as IDL as specified in 18013-1, 2 and -3.
C.1.1.2 Document name and identification
This Policy is identified and can be referred to through the following OID:
id-idl-ml-policy OBJECT IDENTIFIER ::= {
    iso(1) standard(0) driving-licence (18013) part-5(5)
    VICAL(3) 1}
 
Policies of VICAL providers shall be uniquely identifiable, including all published revisions.
C.1.1.3 VICAL participants
This subclause provides an overview of the VICAL participants in the mDL.
C.1.1.3.1 VICAL providers
VICAL providers are organizations responsible for delivering the VICAL, including activities such as:
-	finding and regularly validating issuing authorities' point of contacts;
-	collecting information from issuing authorities through the respective point of contacts;
-	compiling the VICAL;
-	creating and securing the VICAL according to the defined format;
-	distributing the VICAL amongst subscribers;
-	updating the VICAL regularly.
Issuing authoritiesC.1.1.3.2 
For the definition of issuing authority, refer to Clause 3.
C.1.1.3.3 Issuing authorities' point of contact
Each issuing authority shall designate a point of contact, i.e. the unique endpoint for the trusted communication channel handling all communication between the VICAL Provider and the issuing authority. The point of contact may be the same as the initial contact point (see Annex C.1.3.2).
The point of contact can have multiple formats, including but not limited to a person, P.O. box, an email address, dedicated telephone line, telefax, etc. See Annex C.1.3.2 for limitations on the initial point of contact.
C.1.1.3.4 Subscribers
Subscribers receive the VICAL from the VICAL Provider and may redistribute it amongst relying parties, according to the licensing terms of the VICAL, if any.
A subscriber can simultaneously play the role of a relying party and vice-versa.
C.1.1.3.5 Relying parties
Relying parties make use of the received VICAL to validate the mDLs presented for validation.
C.1.1.4 VICAL usage
The VICAL contains the CA certificates intended to be used by relying parties as the trust anchor for the verification of authenticity and integrity of mDLs.
In the absence of VICALs that include all existing CA certificates from all Issuing Authorities it may happen that relying parties may have to use and combine several VICALs to increase coverage.
C.1.1.5 Policy administration
The VICAL Provider shall publish under this subclause the official contacts of the person or department responsible for the Policy.
The contacts shall include name, mailing address, telephone number, and email address as minimum information.
C.1.2 Publication and repository responsibilities
The VICAL Provider shall make the VICAL available to the subscribers in a secure, mutually trusted and authenticated channel, with periodic updates. The VICAL provider should make updates available at least every 90 days. The VICAL provider should also establish procedures for extraordinary updates for emergency cases.
C.1.3 Identification and authentication
C.1.3.1 Naming
Issuing Authorities are uniquely identified by the 2-letter ISO 3166-1 country code. In the special cases of multiple different Issuing Authorities within a country, the stateOrProvinceName / issuing jurisdiction (See Annex B and Clause 7.2.1) can be used.
The naming of certification authorities used by an issuing authority shall follow the guidelines of the certificate profiles defined and the format established in VICAL syntax notation.
C.1.3.2 Initial identity validation
The initial identity validation of the issuing authority is a critical step on the overall security of the VICAL, as it is the first step to establishing a trusted communication channel between the VICAL provider and the issuing authorities.
After a trusted communication channel is established, the VICAL provider and the issuing authority can securely and reliably exchange information to be published in the VICAL.
As a minimum, the VICAL provider shall undertake the following steps:
a)	Assess the legitimacy of and identify an initial contact point for the entity claiming to be an issuing authority. This can be achieved by a number of ways, including checking:
o	against a governmental authoritative source,
o	a regional/continental representative association (or similar body) of Issuing Authorities,
o	official recognized directorate of Issuing Authorities,
o	international conventions identifying Issuing Authorities,
o	official reference by another issuing authority previously trusted
o	other methods that clearly and undoubtedly identify an issuing authority as legitimate.
b)	Initiate contact with the issuing authority's initial contact point. Use this initial contact point to engage with the issuing authority in setting up a trusted communication channel and the protocol for its use. Sensitive material used to set up the trusted communication channel shall be exchanged using out-of-band communication. The protocol shall guarantee the integrity, authenticity, non-repudiation and confidentiality of the information to be exchanged.
NOTE	An IACA link certificate is an example of a trusted communication channel
After the trusted communication channel is established, the Initial Identity Validation is concluded and the parties can then start exchanging information required for the VICAL.
The VICAL provider shall regularly check that each assigned point of contact is still valid and the established communication channel provides the security guarantees, and perform the necessary updates if any required.
C.1.3.3 Identification and authentication for re-key requests
In the context of the VICAL, a re-key request is understood as the process  to add a new CA to the records of the issuing authority.
This process shall use the trusted communication channel established at the initial identity validation (see Annex C.1.3.2). If the trusted communication channel is not considered secure (for example, weak keys or algorithm in use, lost keys, key renewal, etc), a new trusted communication channel shall be established following the same requirements.
C.1.3.4 Identification and authentication of suspension requests
Suspension requests from issuing authorities shall be communicated through the trusted communication channels established at the initial identity validation process (See Annex C.1.3.2).
The VICAL Provider is also reserved the right to proceed unilaterally with the suspension of a CA on the grounds of a documented process and criteria.
C.1.4 VICAL life-cycle operational requirements
C.1.4.1 Certification authority application
The IA may apply to the VICAL Provider for inclusion of its CA into the VICAL.
The respective IA point of contact shall provide all requested information by the VICAL Provider, according to the established processes and through the trusted communication channel. The provided information shall be authentic, correct, complete and truthful.
The Terms and Conditions of the VICAL Service, if any, shall be made available to the applicant by the VICAL Provider.
NOTE	An IACA link certificate is an example of a trusted communication channel
C.1.4.2 Certification authority application processing
The VICAL Provider shall validate the information submitted by the IA's point of contact. Should any of the acceptance checks and conditions fail, the VICAL Provider is reserved the right to terminate the application process.
The VICAL Provider shall keep records (see Annex C.1.5.5) of the application analysis, processing, internal and external checks and results.
C.1.4.3 Certification authority application acceptance
If the application processing by the VICAL Provider approves the CA, it can be included into the VICAL for the corresponding issuing authority and published according to the timeline set by the VICAL Provider and agreed by the applicant.
C.1.4.4 Certification authority renewal
A CA renewal is understood as a request to include a new CA certificate with the same name, public key, and other information as the old one, but with a new, extended validity period and a new serial number.
CA renewals shall not be used.
C.1.4.5 Certification authority application re-key
A CA re-key is understood as a request to include a new CA certificate with a different public key (and serial number) while retaining the remaining contents of the old CA certificate. The new certificate may be assigned a different validity period, key identifiers, specify a different CRL distribution point, and/or be signed with a different key.
The old certificate may or may not be revoked, but shall not be further re-keyed, renewed, or modified.
VICAL Providers shall process CA re-keys as new CA applications and thus follow the definitions laid down on Annex C.1.4.1 to Annex C.1.4.3.
C.1.4.6 Certification authority application modification
Modifying a CA certificate is understood as a request to include a new certificate that has the same or a different key and a different serial number, and that differs in one or more other fields from the old certificate.
The old certificate may or may not be revoked, but shall not be further re-keyed, renewed, or modified.
VICAL Providers shall process CA modifications as new CA applications and thus follow the definitions laid down on subclauses Annex C.1.4.1 to Annex C.1.4.3.
C.1.4.7 Certification authority application suspension
The VICAL Provider shall suspend CA certificates in a timely manner based on authorized and validated requests from the issuing authority point of contact.
The VICAL Provider shall keep records (see Annex C.1.5.5) of the analysis, processing, internal and external checks and results.
C.1.4.8 End of subscription
This policy does not define nor limits any particular form or nature of relation between VICAL Providers and issuing authorities, and VICAL Providers and subscribers. However, it assumes the existence of these Participants (see Annex C.1.1.3) and some form of relation is established between them.
In the event of termination of the relation between the VICAL Provider and the issuing authority, the VICAL Provider is allowed to remove/suspend or maintain unchanged the corresponding IACA on the VICAL, according to the terms and conditions agreed between the parties, or at its sole discretion in its absence.
On the other side, in the event of termination of the relation between the VICAL Provider and a subscriber, the contents of the VICAL shall not be affected.
C.1.5 Facility, management and operational controls
C.1.5.1 Physical security controls
VICAL Provider's equipment shall be protected from unauthorized access while the cryptographic module (see Annex C.1.6.2) is installed and activated. The VICAL Provider shall implement physical access controls to reduce the risk of equipment tampering even when the cryptographic module is not installed and activated. VICAL Provider cryptographic tokens shall be protected against theft, loss, and unauthorized use.
The following controls shall be fulfilled:
a)	Physical access to components of the VICAL Provider's system whose security is critical to the provision of its VICAL services shall be limited to authorized individuals.
b)	Controls shall be implemented to avoid loss, damage or compromise of assets and interruption to business activities.
c)	Controls shall be implemented to avoid compromise or theft of information and information processing facilities.
d)	Components that are critical for the secure operation of the VICAL service shall be located in a protected security perimeter with physical protection against intrusion, controls on access through the security perimeter and alarms to detect intrusion.
e)	The facilities concerned with VICAL generation and management (i.e. CAs status lifecycle management) shall be operated in an environment which physically protects the services from compromise through unauthorized access to systems or data.
f)	Every entry to the physically secure area shall be subject to independent oversight and non-authorized person shall be accompanied by an authorized person whilst in the secure area.
g)	Every entry and exit shall be logged and such access log shall be inspected periodically.
h)	Physical protection shall be achieved through the creation of clearly defined security perimeters (i.e. physical barriers) around the VICAL generation and management services.
i)	Any parts of the premises shared with other organizations shall be outside the perimeter of the VICAL generation management services.
j)	Physical and environmental security controls shall be implemented to protect the facility housing system resources, the system resources themselves, and the facilities used to support their operation.
k)	The VICAL Provider's physical and environmental security policy for systems concerned with VICAL generation and management services shall address the physical access control, natural disaster protection, fire safety factors, failure of supporting utilities (e.g. power, telecommunications), structure collapse, plumbing leaks, protection against theft, breaking and entering, and disaster recovery.
l)	Controls shall be implemented to protect against equipment, information, media and software relating to the VICAL Provider's services being taken off-site without authorization.
m)	Other functions relating to VICAL Provider's operations may be supported within the same secured area provided that the access is limited to authorized personnel.
C.1.5.2 Procedural controls
VICAL Providers shall implement security measures in order to protect the authenticity, integrity and confidentiality of their data and the accurate functionality of their IT systems.
The following controls shall be fulfilled:
a)	The VICAL Provider shall administer user access of operators, administrators and system auditors.
b)	The administration shall include user account management and timely modification or removal of access.
c)	Access to information and application system functions shall be restricted in accordance with the access control policy.
d)	The VICAL Provider's system shall provide sufficient computer security controls for the separation of trusted roles identified in VICAL Provider's practices, including the separation of security administration and operation functions. Particularly, use of system utility programs shall be restricted and controlled.
e)	VICAL Provider's personnel shall be identified and authenticated before using critical applications related to the service.
f)	VICAL Provider's personnel shall be accountable for their activities.
g)	Activation of the VICAL signing key shall be under at least dual control by authorized, trusted personnel such that one person alone cannot activate the VICAL creation system on his/her own.
C.1.5.3 Personnel controls
The VICAL Provider shall ensure that employees and contractors support the trustworthiness of the VICAL Provider's operations.
The following controls shall be fulfilled:
a)	The VICAL Provider shall employ staff and, if applicable, subcontractors, who possess the necessary expertise, reliability, experience, and qualifications and who have received training regarding security and personal data protection rules as appropriate for the offered services and the job function.
b)	VICAL Provider's personnel should be able to fulfil the requirement of "expert knowledge, experience and qualifications" through formal training and credentials, or actual experience, or a combination of the two.
c)	This should include regular (at least every 12 months) updates on new threats and current security practices.
d)	Appropriate disciplinary sanctions shall be applied to personnel violating VICAL Provider's policies or procedures.
e)	Security roles and responsibilities, as specified in the VICAL Provider's information security policy, shall be documented in job descriptions or in documents available to all concerned personnel.
f)	Trusted roles, on which the security of the VICAL Provider's operation is dependent, shall be clearly identified.
g)	Trusted roles shall be named by the management.
h)	Trusted roles shall be accepted by the management and the person to fulfil the role.
i)	VICAL Provider's personnel (both temporary and permanent) shall have job descriptions defined from the view point of roles fulfilled with segregation of duties and least privilege, determining position sensitivity based on the duties and access levels, background screening and employee training and awareness.
j)	Where appropriate, job descriptions shall differentiate between general functions and VICAL Provider's specific functions. These should include skills and experience requirements.
k)	Personnel shall exercise administrative and management procedures and processes that are in line with the VICAL Provider's information security management procedures.
l)	Managerial personnel shall possess experience or training with respect to the VICAL service that is provided, familiarity with security procedures for personnel with security responsibilities and experience with information security and risk assessment sufficient to carry out management functions.
m)	All VICAL Provider's personnel in trusted roles shall be free from conflict of interest that might prejudice the impartiality of the VICAL Provider's operations.
n)	Trusted roles shall include roles that involve the following responsibilities:
a)	Security Officers: Overall responsibility for administering the implementation of the security practices.
b)	System Administrators: Authorized to install, configure, maintain and recover the VICAL Provider's trustworthy systems for service management.
c)	System Operators: Responsible for operating the VICAL Provider's trustworthy systems on a day-to-day basis. Authorized to perform system backup.
d)	System Auditors: Authorized to view archives and audit logs of the VICAL Provider's trustworthy systems.
o)	VICAL Provider's personnel shall be formally appointed to trusted roles by senior management responsible for security requiring the principle of "least privilege" when accessing or when configuring access privileges.
p)	Personnel shall not have access to the trusted functions until the necessary checks are completed.
C.1.5.4 Audit logging procedures
The VICAL Provider shall record and keep accessible for an appropriate period of time, including after the activities of the VICAL Provider have ceased, all relevant information concerning data issued and received by the VICAL Provider, in particular, for the purpose of providing evidence in legal proceedings and for the purpose of ensuring continuity of the service.
The following controls shall be fulfilled:
c)	The confidentiality and integrity of current and archived records concerning operation of services shall be maintained.
d)	Records concerning the operation of services shall be completely and confidentially archived in accordance with disclosed business practices.
e)	Records concerning the operation of services shall be made available if required for the purposes of providing evidence of the correct operation of the services for the purpose of legal proceedings.
f)	The precise time of significant VICAL Provider's environmental, key management and clock synchronization events shall be recorded.
g)	The time used to record events as required in the audit log shall be synchronized with UTC at least once a day.
h)	Records concerning services shall be held for a period of time as appropriate for providing necessary legal evidence and as notified in the VICAL Provider's terms and conditions.
i)	The events shall be logged in a way that they cannot be easily deleted or destroyed (except if reliably transferred to long-term media) within the period of time that they are required to be held. Where possible, the security audit logs shall be automatically collected. Where this is not possible, a logbook, paper form, or other physical mechanism shall be used. All security audit logs, both electronic and non-electronic, shall be retained and made available during compliance audits.
C.1.5.4.1 Types of events recorded
The VICAL Provider shall record details of the actions taken to process a request and to issue a VICAL, including all information generated and documentation received in connection with the request; the time and date; and the personnel involved. The VICAL Provider shall make these records available to Auditors as proof of the VICAL Provider's compliance with these requirements.
The VICAL Provider shall record at least the following events:
a)	VICAL signing key lifecycle management events, including:
a.	key generation, backup, storage, recovery, archival, and destruction; and
b.	cryptographic device lifecycle management events;
b)	VICAL and IA lifecycle management events, including:
c.	CA application, re-key requests, and suspension;
d.	all verification activities stipulated in these requirements;
e.	date, time, phone number used, persons spoken to, and end results of verification telephone calls;
f.	acceptance and rejection of CA applications; and
g.	issuance of VICALs.
c)	security events, including:
h.	successful and unsuccessful VICAL Provider's system access attempts;
i.	VICAL Provider's and security system actions performed;
j.	security profile changes;
k.	system crashes, hardware failures, and other anomalies;
l.	firewall and router activities; and
m.	entries to and exits from the VICAL Provider facility.
Log entries shall include the following elements:
d)	date and time of entry;
e)	identity of the person making the journal entry; and
f)	description of the entry.
C.1.5.5 Records archival
The VICAL Provider shall retain the following for at least seven years after any CA (accepted or not) based on these records ceases to be valid:
a)	log of all events relating to the life cycle of keys managed by the VICAL Provider's system;
b)	documentation and other evidence as referred in Annex C.1.4.2.
C.1.5.6 Key changeover
To minimize risk from compromise of a VICAL Provider's private signing key, that key may be changed often. From that time on, only the new key should be used to sign VICALs. If the old private key is necessary during a limited period of time to keep signing VICALs and allow the migration for Relying parties with legacy systems, the old key shall be retained and protected. Once the old private signing key is not needed anymore, it may be destroyed.
The VICAL Provider's signing key shall have a validity period as described in Annex C.1.7.2.
When a VICAL Provider updates its private signature key and thus generates a new public key, the VICAL Provider shall notify all subscribers that rely on its respective VICALs that it has been changed. The VICAL Provider shall provide the new public key through secure means (e.g. trusted communication channel established with subscribers/relying parties, provision of key rollover certificates - new public key is signed by the old private key, and vice versa).
C.1.5.7 Compromise and disaster recovery
C.1.5.7.1 Incident and compromise handling procedures
System activities concerning access to IT systems, use of IT systems, and service requests shall be monitored.
The following controls shall be fulfilled:
a)	Monitoring activities should take account of the sensitivity of any information collected or analysed.
b)	Abnormal system activities that indicate a potential security violation, including intrusion into the VICAL Provider's network, shall be detected and reported as alarms.
c)	The VICAL Provider shall monitor the following events:
a.	start-up and shutdown of the logging functions; and
b.	availability and utilization of needed services with the VICAL Provider's network.
d)	The VICAL Provider shall act in a timely and co-ordinated manner in order to respond quickly to incidents and to limit the impact of breaches of security.
e)	The VICAL Provider shall appoint trusted role personnel to follow up on alerts of potentially critical security events and ensure that relevant incidents are reported in line with the VICAL Provider's procedures.
f)	The VICAL Provider shall establish procedures to notify the appropriate parties in line with the applicable regulatory rules of any breach of security or loss of integrity that has a significant impact on the VICAL service provided and on the personal data maintained therein within 24 hours of the breach being identified.
g)	Where the breach of security or loss of integrity is likely to adversely affect a natural or legal person to whom the VICAL service has been provided, the VICAL Provider shall also notify the natural or legal person of the breach of security or loss of integrity without undue delay.
h)	The VICAL Provider's systems shall be monitored including the monitoring or regular review of audit logs to identify evidence of malicious activity implementing automatic mechanisms to process the audit logs and alert personnel of possible critical security events.
i)	The VICAL Provider shall address any critical vulnerability not previously addressed by the VICAL Provider, within a period of 48 hours after its discovery.
j)	For any vulnerability, given the potential impact, the VICAL Provider may either choose to:
c.	create and implement a plan to mitigate the vulnerability; or
d.	document the factual basis for the VICAL Provider's determination that the vulnerability does not require remediation.
k)	Incident reporting and response procedures shall be employed in such a way that damage from security incidents and malfunctions are minimized.
C.1.5.7.2 Computing resources, software, and/or data are corrupted
The following controls shall be fulfilled:
a)	VICAL Provider's systems data necessary to resume CA operations shall be backed up and stored in safe places, preferably also remote, suitable to allow the VICAL Provider to timely go back to operations in case of incident/disasters.
b)	Back-up copies of essential information and software should be taken regularly.
c)	Adequate back-up facilities should be provided to ensure that all essential information and software can be recovered following a disaster or media failure.
d)	Back-up arrangements should be regularly tested to ensure that they meet the requirements of business continuity plans.
e)	Backup and restore functions shall be performed by the relevant trusted roles specified in Annex C.1.5.3.
f)	For information requiring dual control for management, for example keys, dual control shall be applied to recovery.
C.1.5.7.3 VICAL Provider private key compromise procedures
The following controls shall be fulfilled in case of a private key compromise:
a)	The VICAL Provider's business continuity plan (or disaster recovery plan) shall address the compromise, loss or suspected compromise of a VICAL Provider's private key as a disaster.
b)	The processes planned as per the previous requirement shall be in place.
c)	Following a disaster, the VICAL Provider shall, where practical, take steps to avoid repetition of a disaster.
d)	In the case of compromise as a minimum:
a.	the VICAL Provider shall inform the following of the compromise: all issuing authorities point of contacts and subscribers and other entities with which the VICAL Provider has agreements or other form of direct established relations, among which relying parties and VICAL Providers; and
b.	the VICAL Provider shall indicate that VICALs issued using this private key may no longer be valid.
Furthermore, the following controls shall be fulfilled in case of an algorithm compromise:
a)	Should any of the algorithms, or associated parameters, used by the VICAL Provider or its issuing authorities point of contacts and/or subscribers become insufficient for its remaining intended usage, then the VICAL Provider shall inform all of them with whom it has agreement or other form of established relations.
b)	Should any of the algorithms, or associated parameters, used by the VICAL Provider or its subscribers become insufficient for its remaining intended usage, then the VICAL Provider shall plan the transition to a new stronger algorithm and execute it the earliest possible time.
C.1.5.7.4 Business continuity capabilities after a disaster
The following controls shall be fulfilled:
a)	The VICAL Provider shall define and maintain a continuity plan to enact in case of a disaster.
b)	In the event of a disaster, including compromise of a private signing key or compromise of some other credential of the VICAL Provider, operations shall be restored within the delay established in the continuity plan, having addressed any cause for the disaster which may recur (e.g. a security vulnerability) with appropriate remediation measures.
C.1.5.8 VICAL termination
Potential disruptions to subscribers and relying parties shall be minimized as a result of the cessation of the VICAL Provider's services and, in particular, continued maintenance of information required to verify the correctness of VICAL services shall be provided.
Furthermore, the following controls shall be fulfilled:
a)	The VICAL Provider shall have an up-to-date termination plan.
b)	Before the VICAL Provider terminates its services, at least the following procedures apply:
a.	Before the VICAL Provider terminates its services, the VICAL Provider shall inform the following of the termination: all issuing authorities point of contacts and subscribers and other entities with which the VICAL Provider has agreements or other form of established relations, among which relying parties and VICAL Providers.
b.	Before the VICAL Provider terminates its services, the VICAL Provider shall terminate authorization of all subcontractors, if any, to act on behalf of the VICAL Provider in carrying out any functions relating to the processing and/or dissemination of the VICAL.
c.	Before the VICAL Provider terminates its services, the VICAL Provider shall transfer obligations to a reliable party for maintaining all information necessary to provide evidence of the operation of the VICAL Provider for a reasonable period, unless it can be demonstrated that the VICAL Provider does not hold any such information. The minimum information set is composed of:
i.	registration information;
ii.	event log archives.
d.	Before the VICAL Provider terminates its services, the VICAL Provider's private keys, including backup copies, shall be destroyed, or withdrawn from use, in a manner such that the private keys cannot be retrieved.
e.	Before the VICAL Provider terminates its services, where possible VICAL Provider should make arrangements to transfer provision of VICAL services for its existing subscribers and Issuing Authorities point of contacts to another VICAL Provider.
c)	The VICAL Provider shall have an arrangement to cover the costs to fulfil these minimum requirements in case the VICAL Provider becomes bankrupt or for other reasons is unable to cover the costs by itself, as far as possible within the constraints of applicable legislation regarding bankruptcy.
d)	The VICAL Provider shall state in its practices the provisions made for termination of service. This shall include:
f.	notification of affected entities; and
g.	where applicable, transferring the VICAL Provider's obligations to other parties.
e)	The VICAL Provider shall maintain or transfer to a reliable party its obligations to make available its public key or its history of VICALs to subscribers and relying parties for a reasonable period.
C.1.6 Technical security controls
C.1.6.1 Key pair generation and installation
Appropriate security controls shall be in place for the management of any cryptographic keys and any cryptographic devices throughout their lifecycle.
The following controls shall be fulfilled:
a)	The VICAL signing key pair generation shall be undertaken in a physically secured environment (see Annex C.1.5.1) by personnel in trusted roles (see Annex C.1.5.3).
b)	The VICAL Provider key pair used for signing VICALs shall be created under, at least, dual control.
c)	The number of personnel authorized to carry out VICAL signing key pair generation shall be kept to a minimum and be consistent with the VICAL Provider's practices.
d)	VICAL Signing key pair generation shall be performed using an algorithm as specified in Annex C.1.7.3.
e)	The selected key length and algorithm for VICAL signing key are specified in Annex C.1.7.3.
f)	Before expiration of its VICAL signer certificate which is used for signing VICALs, in case of continuing with the service, the VICAL Provider shall generate a new key pair and obtain a corresponding VICAL signer certificate, and shall apply all necessary actions to avoid disruption to the operations of any entity that may rely on the VICAL signer certificate."
g)	Before expiration of its VICAL signer certificate, in case of continuing with the service, the new VICAL signer certificate shall also be issued and distributed in accordance with this document.
h)	The operations described in f) and g) above should be performed with a suitable interval between certificate expiry date and the last VICAL signed to allow all parties that have relationships with the VICAL Provider (subscribers, relying parties, Issuing Authorities, etc.) to be aware of this key changeover and to implement the required operations to avoid inconveniences and malfunctions. This does not apply to a VICAL Provider which will cease its operations before its own VICAL signer certificate expiration date."
i)	The VICAL Provider shall have a documented procedure for conducting generation of VICAL signing key pairs. Such procedure shall indicate, at least, the following:
a.	roles participating in the ceremony (internal and external from the organization);
b.	functions to be performed by every role and in which phases;
c.	responsibilities during and after the ceremony; and
d.	requirements of evidence to be collected of the ceremony.
j)	The VICAL Provider shall produce a report proving that the ceremony, as in i) above, was carried out in accordance with the stated procedure and that the integrity and confidentiality of the key pair was ensured.
k)	CA signature verification (public) keys of the VICAL signing certificate shall be available to subscribers and relying parties in a manner that assures the integrity of the CA public key and authenticates its origin.
C.1.6.2 Private key protection and cryptographic module engineering controls
The following controls shall be fulfilled:
a)	VICAL Provider's signing key pair generation shall be carried out within a secure cryptographic device which is a trustworthy system which:
a.	is assured to EAL 4 or higher in accordance with [3], or equivalent national or internationally recognized evaluation criteria for IT security provided this is a security target or protection profile which meets the requirements of this document, based on a risk analysis and taking into account physical and other non-technical security measures; or
b.	meets the requirements identified in [4]or FIPS PUB 140-2 level 3.
b)	The secure cryptographic device shall be operated in its configuration as described in the appropriate certification guidance documentation or in an equivalent configuration which achieves the same security objective.
c)	The VICAL private signing key shall be held and used within a secure cryptographic device meeting the requirements item a) and b) above.
d)	If and when outside the secure cryptographic device, the VICAL signing private key shall be protected in a way that ensures the same level of protection as provided by the secure cryptographic device.
e)	The VICAL signing private key may be backed up, stored and recovered only by personnel in trusted roles (see Annex C.1.5.3) using, at least, dual control in a physically secured environment (see Annex C.1.5.1)
f)	The number of personnel authorized to carry out the VICAL signing private key back up, storage and recovery shall be kept to a minimum and be consistent with the VICAL Provider's practices.
g)	Copies of the VICAL private signing keys shall be subject to the same or greater level of security controls as keys currently in use.
h)	Where the VICAL signing private keys and any copies are stored in a dedicated secure cryptographic device, access controls shall be in place to ensure that the keys are not accessible outside this device.
i)	The secure cryptographic device shall not be tampered with during shipment.
j)	The secure cryptographic device shall not be tampered with while stored.
k)	The secure cryptographic device shall be functioning correctly.
l)	The CA private signing keys stored on the CA's secure cryptographic device shall be destroyed upon device retirement.
C.1.6.3 Other aspects of key pair management
The VICAL Provider shall use appropriately the VICAL private signing keys.
The following controls shall be fulfilled:
a)	The VICAL Provider shall not use the VICAL signing private keys beyond the end of their life cycle.
b)	VICAL signing key(s) used for generating VICALs as defined in Annex C.1.7.1 shall not be used for any other purpose.
c)	The VICAL signing keys shall only be used within physically secure premises.
d)	The use of the VICAL's private key shall be compatible with the hash algorithm, the signature algorithm and signature key length used for generating VICALs (defined in Annex C.1.7.3).
e)	All copies, if any, of the VICAL signing private keys shall be destroyed at the end of their life cycle.
C.1.6.4 Activation data
The installation, activation and recovery of the VICAL signing key pairs in a secure cryptographic device shall require simultaneous control of at least two trusted employees, for example, using m-of-n authentication mechanisms.
Data used to unlock private keys shall be protected from disclosure by a combination of cryptographic and physical access control mechanisms. Activation data shall be either:
-	memorized; or
-	biometric in nature; or
-	recorded and secured at the level of assurance associated with the activation of the cryptographic module, and shall not be stored with the cryptographic module.
C.1.6.5 Computer security controls
The VICAL Provider's system access shall be limited to authorized individuals.
The following controls shall be fulfilled:
a)	Controls (e.g. firewalls) shall protect the VICAL Provider's internal network domains from unauthorized access including access by subscribers and third parties.
b)	Firewalls should also be configured to prevent all protocols and accesses not required for the operation of the VICAL Provider.
c)	Sensitive data shall be protected against being revealed through re-used storage objects (e.g. deleted files) being accessible to unauthorized users.
d)	Local network components (e.g. routers) shall be kept in a physically and logically secure environment.
e)	Local network components (e.g. routers) configurations shall be periodically checked for compliance with the requirements specified by the VICAL Provider.
f)	The VICAL Provider shall enforce multi-factor authentication for all accounts capable of directly causing VICAL issuance.
g)	Dissemination application shall enforce access control on attempts to add or delete VICALs and modify other associated information.
h)	Continuous monitoring and alarm facilities shall be provided to enable the VICAL Provider to detect, register and react in a timely manner upon any unauthorized and/or irregular attempts to access its resources.
C.1.6.6 Life cycle security controls
The VICAL Provider shall use trustworthy systems and products that are protected against modification and ensure the technical security and reliability of the processes supported by them.
The following controls shall be fulfilled:
a)	An analysis of security requirements shall be carried out at the design and requirements specification stage of any systems development project undertaken by the VICAL Provider or on behalf of the VICAL Provider to ensure that security is built into IT systems.
b)	Change control procedures shall be applied for releases, modifications and emergency software fixes of any operational software and changes to the configuration which applies the VICAL Provider's security policy.
c)	The procedures shall include documentation of the changes.
d)	The integrity of VICAL Provider's systems and information shall be protected against viruses, malicious and unauthorized software.
e)	Media used within the VICAL Provider's systems shall be securely handled to protect media from damage, theft, unauthorized access and obsolescence.
f)	Media management procedures shall protect against obsolescence and deterioration of media within the period of time that records are required to be retained.
g)	Procedures shall be established and implemented for all trusted and administrative roles that impact on the provision of services.
h)	The VICAL Provider shall specify and apply procedures for ensuring that:
a.	security patches are applied within a reasonable time after they come available;
b.	security patches are not applied if they introduce additional vulnerabilities or instabilities that outweigh the benefits of applying them; and
c.	the reasons for not applying any security patches are documented.
i)	Capacity demands shall be monitored and projections of future capacity requirements shall be made to ensure that adequate processing power and storage are available.
C.1.6.7 Network security controls
The VICAL Provider shall protect its network and systems from attack.
The following controls shall be fulfilled:
a)	The VICAL Provider shall segment its systems into networks or zones based on risk assessment considering functional, logical, and physical (including location) relationship between trustworthy systems and services.
b)	The VICAL Provider shall apply the same security controls to all systems co-located in the same zone.
c)	The VICAL Provider shall restrict access and communications between zones to those necessary for the operation of the VICAL Provider.
d)	The VICAL Provider shall explicitly forbid or deactivate not needed connections and services.
e)	The VICAL Provider shall review the established rule set on a regular basis.
f)	The VICAL Provider shall keep all systems that are critical to the VICAL Provider's operation in one or more secured zone(s).
g)	The VICAL Provider shall separate dedicated network for administration of IT systems and VICAL Provider 's operational network.
h)	The VICAL Provider shall not use systems used for administration of the security policy implementation for other purposes.
i)	The VICAL Provider shall separate the production systems for the VICAL Provider's services from systems used in development and testing (e.g. development, test and staging systems).
j)	The VICAL Provider shall establish communication between distinct trustworthy systems only through trusted channels that are logically distinct from other communication channels and provide assured identification of its end points and protection of the channel data from modification or disclosure.
k)	If a high level of availability of external access to the VICAL service is required, the external network connection should be redundant to ensure availability of the services in case of a single failure.
l)	The VICAL Provider shall undergo or perform a regular vulnerability scan on public and private IP addresses identified by the VICAL Provider and record evidence that each vulnerability scan was performed by a person or entity with the skills, tools, proficiency, code of ethics, and independence necessary to provide a reliable report.
m)	The VICAL Provider shall undergo a penetration test on the VICAL Provider's systems at set up and after infrastructure or application upgrades or modifications that the VICAL Provider determines are significant.
n)	The VICAL Provider shall record evidence that each penetration test was performed by a person or entity with the skills, tools, proficiency, code of ethics, and independence necessary to provide a reliable report.
o)	The VICAL Provider shall maintain and protect all VICAL systems in at least a secure zone and shall implement and configure a security procedure that protects systems and communications between systems inside secure zones and high security zones.
p)	The VICAL Provider shall configure all VICAL systems by removing or disabling all accounts, applications, services, protocols, and ports that are not used in the VICAL's operations.
q)	The VICAL Provider shall grant access to secure zones and high security zones to only trusted roles.
r)	The VICAL issuing system shall be in a high security zone.
C.1.6.8 Timestamping
The following controls shall be fulfilled:
a)	Asserted times shall be accurate to within three minutes.
b)	Electronic or manual procedures may be used to maintain system time.
c)	Clock adjustments are auditable events.
C.1.7 VICAL and VICAL signer certificate profiles
C.1.7.1 VICAL CDDL profile[A8]
The VICAL profile shall use the following CDDL structure:
VICAL = {
    "version" : tstr                ; VICAL structure version, currently "1.0"
    "vicalProvider" : tstr          ; Identifies the VICAL provider
    "date" : tdate                  ; date-time of VICAL issuance
    ? "vicalIssueID" : uint         ; identifies the specific issue of the VICAL, shall be unique and monotonically increasing
    ? "nextUpdate" : tdate          ; next VICAL is expected to be issued before this date-time
    "certificateInfos" : [*CertificateInfo]
    ? "extensions" : Extensions     ; Can be used for proprietary extensions
    * tstr => any                   ; To be used for future extensions, all values are RFU
}

CertificateInfo = {
    "certificate" : bstr            ; DER-encoded X.509 certificate
    "serialNumber" : biguint        ; value of the  serial number field of the certificate
    "ski" : bstr                    ; value of the Subject Key Identifier field of the certificate
    "docType" : [+ DocType]         ; DocType for which the certificate may be used as a trust point
    ? "certificateProfile" : [+ CertificateProfile] ; Type of certificate
    ? "issuingAuthority" : tstr     ; Name of the certificate issuing authority
    ? "issuingCountry" : tstr       ; ISO3166-1 or ISO3166-2 depending on the issuing authority
    ? "stateOrProvinceName" : tstr  ; State or province name of the certificate issuing authority
    ? "issuer" : bstr               ; DER-encoded Issuer field of the certificate (i.e. the complete Name structure)
    ? "subject" : bstr              ; DER-encoded Subject field of the certificate (i.e. the complete Name structure)
    ? "notBefore" : tdate           ; value of the notBefore field of the certificate
    ? "notAfter" : tdate            ; value of the notAfter field of the certificate
    ? "extensions" : Extensions     ; Can be used for proprietary extensions
    * tstr => any                   ; To be used for future extensions, all values are RFU
}

Extensions = {* tstr => any}        ; Can be used for proprietary extensions

CertificateProfile = tstr           ; Uniform Resource Name (URN) according to RFC 8141

The CertificateInfo map contains the "docType" and "certificateProfile" key-value pairs. These pairs shall be used as follows:
* Each certificate in the VICAL is used by the associated issuing authority as a trust point to allow the verification of end-entity certificates in a given document ecosystem.  The "docType" pair contains the document type(s) of the documents for which the current certificate is used. For the mDL ecosystem, the mDL doc type as specified in Clause 7.1 shall be used. Relying parties should not attempt to use the certificate as a trust point for an ecosystem whose document type is not listed in the "docType" key-value pair.
* The way in which a certificate may be used depends not only on the ecosystem for which it is a trustpoint, but optionally also on the certificate profile. The intended use(s) of each certificate is indicated by the "certificateProfile" pair. For an mDL IACA root certificate, the mDL IACA OID  specified in Annex B.1.1 shall be used.
EXAMPLE:	Within the mDL ecosystem the use of IACA root certificates is mandatory as the trust point for issuer data authentication. However, next to that optionally another type of (root) certificate may be used as the trust point for mdoc reader authentication. Within other document ecosystems, other security mechanisms may be used. 
The tdate data types in the VICAL structure shall be encoded as specified in Clause 7.1.
The Extensions structures may be used by the VICAL provider for prioprietary extensions.
The VICAL is encapsulated and signed by the untagged COSE_Sign1 structure as defined in RFC 8152. Within the COSE_Sign1 structure, the payload shall be VICAL. The external_aad field used in the Sig_structure shall be a bytestring of size zero.
The alg element (RFC 8152) shall be included as an element in the protected header. Other elements should not be present in the protected header. 
The certificate containing the public key belonging to the private key used to sign the VICAL shall be included as an x5chain element as described in draft-ietf-cose-x509-08[A9]. It shall be included as an unprotected header element.
The VICAL provider should use one of the signature algorithms for calculating the signature over the VICAL: "ES256", "ES384", "ES512" or "EdDSA". The VICAL provider should use one of the elliptic curves as specified in Table 22.
 
 
C.1.7.2 VICAL signer certificate profile
This certificate profile defines the VICAL signer certificates, establishing the minimum security parameters (key lengths, algorithms, policy IDs, etc). CAs issuing certificates to VICAL Providers may choose to use equivalent or higher parameters, as well as other certificate fields and extensions that do not limit or reduce the overall security level. See Table C.2 for details.
This certificate uses an OID for the VICAL policy. The OID has the following definition:
id-mdl OBJECT IDENTIFIER ::=   { iso(1) standard(0) 18013 5 }
id-mdl-kp OBJECT IDENTIFIER ::= { id-mdl 1 }   - - arc for extended key purposes
id-mdl-kp-mdlVICAL OBJECT IDENTIFIER ::= { id-mdl-kp 8 }  - - arc for mDL VICAL
Table  C.2 - VICAL signer certificate profile
Certificate component
Section in RFC 5280
Presence
Criticality
Description
Version
4.1.2.1
M

Shall be v3.
Serial number
4.1.2.2
M

Non-sequential positive, non-zero integer, shall contain at least 63 bits, should contain at least 71 bits of output from a CSPRNG, maximum 20 octets.
Signature
4.1.2.3
M

Value shall match the OID in the signature algorithm (below) .
Issuer
4.1.2.4
M

According to the Certification Authority issuing the VICAL signer certificate
Validity
4.1.2.5
M


	Not before

M

Date on which the certificate validity period begins.
	Not after

M

Maximum of 1187 days after "Not before" date.
Subject
4.1.2.6
M

Minimum required fields. Other may be present (e.g. Serial Number, State, Organization Unit, etc.).
	Country (C)

M

Country code of jurisdiction of VICAL Provider. Encoded as PrintableString.
	Organization (O)

M

Full registered name of the VICAL Provider. Encoded as UTF8String.
	Common name (CN)

M

Name under which VICAL Provider operates VICAL service and is commonly known. Encoded as UTF8String.
Subject public key info
4.1.2.7
M


	algorithm

M

1.2.840.10045.2.1 (Elliptic curve)
	parameters

M

Implicitly specify curve parameters through an OID associated with one of the following curves specified in FIPS PUB 186-4:
1.2.840.10045.3.1.7 (Curve P-256)
1.3.132.0.34 (Curve P-384)
1.3.132.0.35 (Curve P-521)
Or one of the following curves specified in RFC 5639: 1.3.36.3.3.2.8.1.1.7 (brainpoolP256r1)
1.3.36.3.3.2.8.1.1.9 (brainpoolP320r1)
1.3.36.3.3.2.8.1.1.11 (brainpoolP384r1)
1.3.36.3.3.2.8.1.1.13 (brainpoolP512r1)
	subjectPublicKey

M

Public key shall be encoded in uncompressed form.
X.509v3 extensions
4.2
M

Further extensions may be present if they are marked non-critical.
Authority key identifier
4.2.1.1
M
NC

	keyIdentifier

M

Same value as the subject key identifier of the issuer's certificate
Subject key identifier
4.2.1.2
M
NC
SHA-1 hash of the subject public key BIT STRING value (excluding tag, length, and number of unused bits).
Key usage
4.2.1.3
M
C

	Digital signature



0
	Non repudiation



1
	Key encipherment



0
	Data encipherment



0
	Key agreement



0
	Key certificate 
	signature



0
	CRL signature



0
	Encipher only



0
	Decipher only



0
Extended key usage
4.2.1.12
M
C

	Key usage

M

1.0.18013.5.1.8 (mdlVICAL)
CRLDistributionPoints
4.2.1.13
M
NC
The 'reasons' and 'cRL Issuer' fields shall not be used.
	distributionPoint

M

URI for CRL distribution point.
Private internet extensions




Authority information access
4.2.2.1
C
NC
Conditional, shall be present if the IACA has an OCSP service.
	Access description
	OCSP

M


	accessMethod

M

1.3.6.1.5.5.7.48.1 (OCSP)
	accessLocation

M

URI for corresponding OCSP service.
Signature algorithm
4.1.1.2
M

Options:
1.2.840.10045.4.3.2 (ECDSA-with SHA256)
1.2.840.10045.4.3.3 (ECDSA-with SHA384)
1.2.840.10045.4.3.4 (ECDSA with SHA512)
Signature value
4.1.1.3
M

Value according to the signature algorithm. By creating this signature, the CA certifies the binding between the public key material and the subject of the certificate, i.e. the VICAL Provider.
Key
Presence:
M  mandatory
O   optional
C   conditional
Criticality:
C    critical
NC  not critical

C.1.8 Compliance audit and other assessment
It is beyond the scope of this Policy to establish an auditing scheme for VICAL Providers. Nevertheless, it is understood that VICAL Providers should be able to publicly demonstrate compliance to this Policy and the security requirements.
As a minimum, VICAL Providers shall conduct self-audits on a periodic basis (at least yearly) to assess compliance to this Policy.
An independent third-party assessment can be achieved by an VICAL Provider based on the following principles:
-	Auditor qualification: VICAL Provider selects an independently acting and accredited company/organisation ("Auditing Body") or certified auditors to audit the VICAL Service according to this Policy. The Auditing Body shall either be accredited for this purpose by its national accreditation body or authorized by a responsible government office.
-	Audit basis: The Audit is based on ISO/IEC 27001 and ISO/IEC 27002.
-	Checking requirement realisation: The audit and control does not only check that procedural security controls are specified but also that they are adhered to in practice. This also includes the initial identity validation, the receipt of IACA applications and the suspension/removal procedure for IACAs.
-	Iteration of audits and controls: Audits and controls is performed at least every three years. The Auditing Body and the VICAL Provider carry out a review at least once a year by a team of one or more auditors to ensure on going compliance with this Policy.
-	Being not conformant: In the event that an audit indicates that the VICAL Provider is not conformant to this Policy, or its certification becomes invalid or expires, the VICAL Provider notifies its point of contacts of Issuing Authorities and subscribers.
-	Availability of audit results: The certificate of conformity can be made available to Issuing Authorities, subscribers, relying parties and other possible stakeholders.
A VICAL Provider should implement an Information Security Management System (ISMS) for its VICAL Service in accordance to ISO/IEC 27001. The ISMS is based on an ISMS policy of which its scope is defined by this Policy and, if applicable, the associated Practice Statement.
Annex 
(informative)

Data structure examples[A10]
D.1 General
This annex contains examples for different structures used in the document. Since CBOR results in binary structures, a diagnostic notation will be used together with the binary encoding, whenever CBOR examples are made in this annex. The diagnostic notation will indicate binary embedded cbor data as << >>.


Annex 
(informative)

Privacy and security recommendations
E.1 General
This annex provides guidance for issuing authorities to design and implement their mDL solutions for privacy and security. It also contains background information on privacy, and a section on how the existing standard for data transfer has already addressed privacy concerns.
E.2 Achieving privacy for the mDL holder
E.2.1 Privacy goals
Individual privacy and security of personally identifiable information (PII) in the mobile, electronic age shall be ensured and is a shared responsibility of all involved parties. No technical standard for data interchange can dictate how all privacy measures are achieved. Privacy is achieved by the end-to-end solution, and with the participation of all participants in an ecosystem. Each actor in the mDL ecosystem should fulfill their role in a responsible manner that best protects PII.
E.2.2 Privacy definitions, goals, and principles
This document has been developed with the following privacy by design goals and allows both mDL holder and issuing authority concerns listed in this annex to be achieved in multiple ways.
?Data minimization and anonymization wherever possible
?Be proactive to prevent data breach
?Privacy should be the default setting
?Embed privacy in design, flows, and architecture
?Privacy does not need to be traded off for full functionality
?Protect the full lifecycle of the identity end-to-end
?Keep all operations visible and transparent to the mDL holder
?Design for user-centricity and user-control of their identity
To achieve these privacy by design goals, [6] defines the following principles for privacy protection.
1.	Consent and choice
2.	Purpose legitimacy and specification
3.	Collection limitation
4.	Data minimization
5.	Use, retention and disclosure limitation
6.	Accuracy and quality
7.	Openness, transparency and notice
8.	Individual participation and access
9.	Accountability
10.	Information security
11.	Privacy compliance
These principles put names on the protections that consumers (data subject) expect from data controllers and their data processors. These have been codified into law (e.g. GDPR) or regional principles (e.g. US DHS Fair Information Practice Principles).
?Consent and choice - The data subject shall consent to the processing of their personal data (see definitions in the section on mDL holder Consent below).
?Purpose legitimacy and specification - The data subject should be fully aware of the purpose for which their personal data is being collected, processed, and potentially stored.
?Collection limitation - The data controller and data processors should only collect the data necessary for their purpose and should only collect data consistent with these principles.
?Data minimization - Processing of data should be minimized to that specifically necessary for the purpose specified.
?Use, retention, and disclosure limitation - Data processors should not use personal data of the data subject except for the purposes specified and consistent with these other principles. Personal data should only be retained for the period necessary to provide the service.
?Accuracy and quality - High accuracy of data being processed and held is in the best interest of the data subject and processors should take measures to ensure accuracy.
?Openness, transparency and notice - What data and how data is being processed should be well-known to the data subject, including obtaining consent, and posting and updating clear notices.
?Individual participation and access - The data subject should be involved in the collection, consent, processing, and storage management of their personal data.
?Information security - Personal data should be protected by security safeguards against such risks as loss or unauthorized access, destruction, use, modification or disclosure.
?Privacy compliance - The data controller and data processors shall be accountable for all aspects of the processing of personal data and provide audit logs and auditability to the data subject.
See [6] for more information on these terms.
E.2.3 Privacy protections embedded in the protocol design
The privacy principles above were taken into consideration during protocol design, and a set of protections implemented at the protocol level in order to establish a privacy baseline. Table E.1 details protections embedded in the protocol. It lists protections that should be considered and implemented as part of solutions.
Table E.1 - Privacy principles and protections
Principle
Protection
4. Data minimization
Fields (data groups) have been separated into individual data elements to support privacy-preserving attribute queries. mDL readers request data elements individually and should ask for only those necessary for their use case.
3. Collection limitation
4. Data minimization
The request-response model permits disclosing additional data if the initial response did not fulfill the requirements of the use case. This lessens the need to over-ask for all data in the first pass.
1. Consent and choice
The data transfer model of this document provides the ability for mDL solutions to implement either pre-consent or transaction-time consent as defined below. Consent applies to both selective disclosure and authorization for intent-to-retain.
4. Data minimization
Optional mDL reader authentication may be used to restrict access to specific data elements of high sensitivity. This can prevent leakage, for example, of biometric data.
3. Collection limitation
Replay attacks and follow-up requests are not permitted once the connection is broken in either online or offline models.
Use of "intent to retain" provides a framework for limitation of collection of data by an mDL reader.
10. Information security
mDL data is signed by the issuing authority using digital certificates for protection of integrity and authenticity.
mDL readers use trusted certificates to validate the integrity and authenticity of mDL data.
8. Individual participation and access
Sequence of "Device engagement, secure connection, Request, Response, Repeat" permits pre-consent and transaction-time consent models at mDL holder discretion.
10. Information security (of data subject)
Recommendations are provided for setting up lower level transport protocols to minimize or prevent leakage of unique mDL holder or device identifiers. For Wi-Fi Aware and BLE, this document encourages random MAC addresses for mDL on every data path and encourages rotation of MAC address for service discovery. For NFC, no unique persistent identifiers should be made available at the protocol level.
Higher layer addressing such as Ipv6 addresses used in Wi-Fi Aware should also not leak unique mDL holder or device identifiers.
10. Information security (of data and data subject)
Ephemeral keys are used in channel security. mDL Data Authentication can prevent data tampering. Random numbers are used in Issuer Data Authentication signatures.
4. Data minimization
Privacy-preserving signatures: Cryptographic signatures do not leak additional unique identifiers. That is, the protocol does not make mDL holders identifiable if they cannot be identified by the transmitted data attributes themselves.
10. Information security (of data subject, unlinkability)
Multiple mDL transaction signatures and the MSO of a single mDL holder are distinct and not linkable.
Linkability through mdoc authentication keys can be reduced by frequent updates of mdoc authentication keys.
If the same server retrieval tokens are used multiple times, care should be taken that they do not serve as a means to link mDL transactions.
6. Accuracy and quality
The data returned by this protocol in device retrieval is the one that was determined valid at the time of issuance of the MSO object. The validity element of the MSO allows the authority to limit the period during which this data will be considered sufficiently recent for offline use, and indicates whether an update of the MSO information was performed or not by the mDL application or mDL holder. The issuing authority should define appropriate periods of validity that balance freshness with offline capability, taking into account that a shorter validity period mitigates certain security risks. 
Server retrieval allows the issuing authority to return up-to-date mDL data.
E.2.4 Responsibilities of roles and participants
E.2.4.1 Participants in the mDL Ecosystem
Each responsible participant in the mDL Ecosystem should make technology choices in line with privacy principles and the recommendations in this annex. All participants should post their privacy policy in easily discoverable public locations and provide mechanisms for contact and redress of privacy problems encountered by individuals.
?Issuing authorities - entities that officially issue driving licences and now sign mDLs
?Technology providers - provide systems and Apps for issuing authorities to issue mDLs
?mDL verifiers - operate mDL readers that obtain trustworthy data from mDLs
?VICAL providers - publish lists of trustworthy IACA certificates for verifying data
E.2.4.2 Issuing authorities
Above all, issuing authorities are responsible for selecting or developing technology that meets the privacy regulations of their jurisdictions and regions, and they have a responsibility to protect PII with the rigor with which they currently protect physical card issuances.
Issuing authorities are responsible for the accurate provisioning of mDL to the proper mDL holder to achieve their target Identity Assurance Level as defined within their regional trust frameworks (e.g. [10]). Issuing authorities are also responsible for security controls of the mDL in order to resist cloning and tampering including those binding the mDL to the mobile device, and to provide for the synchronization of relevant data updates to the mDL.
E.2.4.3 Technology providers
A technology provider should apply Privacy By Design principles for the applicable role under which they will provide software - issuing authority, mDL verifier, or Individual/Apps.
Technology providers should work with issuing authorities to ensure that mDLs provide adequate information about consent, including purpose, and clear indication of what data is needed for how long.
Similarly, providers of mDL verifier technology should work with mDL verifiers to ensure only the data required for each use case is requested during each transaction.
E.2.4.4 mDL verifiers (also known as relying parties)
Since the interchange of data with a Mobile Driving Licence is straightforward and easy to perform, mDL verifiers should never store PII, but rather request data from the mDL holder whenever it needs to process data to perform a transaction.
mDL verifiers should request the minimum data required for their use case. With each request for data, mDL verifiers should provide adequate informed consent, including the purpose and scope of data requested, to the mDL holder and never use blanket terms and conditions in lieu of informed consent.
E.2.4.5 VICAL providers
VICALs are signed lists of certificates from actual, real-world verified Issuing Authorities. These Lists can be maintained by issuing authorities themselves, associations of issuing authorities, by vendors of mDL readers, or by others. The VICAL provider endeavors to keep the list of certificates current and extensive for their field of operation.
mDL verifiers should use mechanisms to assemble IACA certificates from known trusted Issuing Authorities. They can do it using solutions such as bilateral and/or regional agreements, in effect acting as their own VICAL provider or they may obtain VICALs of certificates from reliable VICAL providers.
E.2.4.6 mDL holders
Individuals should pay attention to each consent they may be asked to grant, and not to accept blanket terms and conditions or consent to share. Consent should not be granted by the mDL holder unless they are satisfied with the purpose for sharing specific data and know the mDL verifier with whom they are sharing.
E.3 Privacy recommendations
This annex contains guidance to assist issuing authorities and all participants in the mDL ecosystem so that they can release solutions that protect the privacy of their citizens and achieve the above privacy principles.
E.4 Transparency of data storage & use
mDL holders should have transparency into all data that is held in the mDL. The mDL holder should always be given the ability to consent to the sharing of that data and be informed of the onward storage of that data using the "intent to retain" flag. Proper informed consent as per section below can help ensure transparency over the use of personal data to the mDL holder.
E.5 Protection of keys and mDL data
Device retrieval requires that mDLs be able to dynamically authenticate (sign or MAC) the data they return to an mDL reader in possession of the mDL verifier. This mDL authentication key should be protected from unauthorized usage.
The key should be protected with industry state-of-the-art protection methods. Examples are:
?a trusted execution environment;
?a hardware secure element with appropriate certifications;
?other secure hardware solution or combination of the aforementioned;
?use of biometrics or strong on-device authentication technology.
Controls and technology for fraud detection should be implemented.
In some other cases a backend could verify additional information such as digital signature, revocation and tokenization status. Such approach overall results in protecting the mDL holder by ensuring that the right mDL holder is presenting the data while not necessarily relying on the mDL holder device and mDL App security.
Many mDL data elements are PII and need also to be stored securely. If a secure area is available and encryption of such data elements is used, the encryption keys should be stored onto the secure area, regardless of data elements storage. Alternatively, data elements may be stored onto secure area with appropriate protection according to issuing authority security policy.  
Implementations may further protect the mDL authentication key and data with a biometric or PIN.
E.6 PKI and trust framework
The integrity and authenticity of an mDL is protected through the use of cryptographic mechanisms and digital certificates managed by a Public Key Infrastructure (PKI) under control of the respective issuing authority (IA). At the core of this PKI is the issuing authority certificate authority (IACA), from which a specific set of certificates are generated and used to protect mDL data and transactions. The IACA (one per IA) is the root of trust for all mDL verifiers (or relying parties in general) to securely validate the integrity and authenticity of mDLs issued by the respective IA. It is therefore of utmost importance that IAs put strict security controls on the deployment, administration and operation of their IACA. A compromise of the IACA (e.g. disclosure of the IACA private key, fraudulent issuance of document signer certificates, etc.) can be exploited for forgery of mDLs and ultimately undermines the trust on the IA's mDLs. The issuing authority should ensure that adequate security measures are used to ensure a high level of security for the use of the document signer keys. 
Dissemination of IACA certificates is also critical to a robust and secure ecosystem. Trusting a fake IACA opens room for forgery of mDLs, leading to possible attacks of impersonation, skimming, eavesdropping, amongst others. mDL verifiers should accept and trust an IACA root certificate through their own inspection, through a trusted VICAL provider or other means.
At domestic level, dissemination of the IACA root certificate is expected to be distributed by the IA through secured and well-known channels to the mDL verifiers (e.g. downloadable from a webpage on the TLS protected website of the IA).
However, for cross border and interoperable verification of mDLs, a more scalable and dynamic mechanism is necessary. In the absence of a worldwide organization that could operate a globally trusted directory of IACA root certificates, it is envisioned that some organizations (public or private) will collect the list of IACAs and make available that compilation to mDL verifiers, under the terms and conditions at their own discretion. Such organizations are referred to in this document as VICAL providers and the list of IACAs as VICAL.
Given the criticality of the information contained in the VICAL, a set of minimum security requirements are specified under Annex C. The requirements include provisions for the initial validation and due diligence procedures of IAs. The requirements also contain provisions for VICAL Providers to secure communication with IAs for the respective IACAs, data management and security controls over the VICAL and distribution of the VICAL to mDL verifiers.
When selecting VICAL Providers, mDL verifiers should assess the trustworthiness of the VICAL Provider amongst other criteria.
E.7 Auditability
E.7.1 Holder auditability
The mDL holder should be able to view an audit trail of their interactions with mDL readers. To accomplish this, mDLs should, at the mDL holder's choice, log information about each transaction in a form that can be reviewed by the mDL holder. The mDL should not make the transaction log available to anyone other than the mDL holder, except at the mDL holder's direction. The transaction log should include:
?the identity of the mDL verifier / mDL reader;
?which data elements were requested by the mDL reader;
?which data element requests were rejected by the mDL, due to mDL holder consent or other policy controls; and
?the date, time and location of the transaction.
To ensure that the audit log is not detrimental to mDL holder privacy, the mDL holder should have the capability to disable the audit log and delete logged transactions and mDL holder Authentication should be required to view it. The transaction log should be stored in secure mobile storage. The format of the transaction log is out of scope of this document.
E.7.2 mDL verifier auditability
mDL verifiers should provide the mDL holder the ability to review data collected from their mDL transactions and to revoke consent to process or hold the mDL holder's data.
The mDL verifier should implement controls, which may include:
?register mDL readers individually and specify the names of the mDL verifier and each mDL reader operator if a common certificate is used;
?utilize Open ID Connect Client Registration in advance for connecting online mDL readers to common issuing authorities, and Dynamic registration with the same mDL reader information for less seldomly encountered IAs;
?avoid logging mDL holder PII; 
?log only the data required by law.
E.8 Anonymity and unlinkability
E.8.1 Applicability
Anonymity and Unlinkability privacy recommendations apply equally to server and device retrieval and regardless of the architecture of an mDL solution.
This annex defines anonimity according to [6] as a "characteristic of information that does not permit a personally identifiable information principal to be identified directly or indirectly". It is noted that this explicitly includes required mitigations against de-anonymization techniques, which are defined as "any process in which anonymous data is cross-referenced with other sources of data to re-identify the anonymous data source" in [5].
Transactions between mDL holders and mDL verifiers should be anonymous and unlinkable under at least the following threat models:
?Tracking of identities by (potentially colluding) mDL verifiers: While mDL verifiers may be able to identify an mDL holder based on transmitted attributes in one transaction, a different transaction with the same mDL holder with a non-overlapping set of attributes should not be linkable to the previous transaction(s). Transactions without identifying attributes should remain anonymous to any Verifier.
?Linking pseudonyms or transactions across non-connected mDL verifiers: Interactions of an mDL holder with different (domains of) mDL verifiers should not be linkable through cross-referencing the respective transaction logs.
?Tracking of identities by (global) passive adversaries: Passive observation (eavesdropping) of local or remote network communication should not lead to de-anonymization or linking of transactions between mDL holders and Verifiers or the relationship between mDL holders and issuing authorities.
De-identification alone is not sufficient for anonymization, and unlinkability requires anonymization of metadata elements. Note that revocation techniques may compromise privacy guarantees retroactively. Systems that implement explicit revocation techniques beyond limiting document lifetimes should therefore provide backward unlinkability in addition to unlinkability. When an mDL is revoked by IA, the mDL is non-ambiguously targeted by revocation techniques that are not likely to comply with privacy principles for some aspects. The mDL holder to revoke is by definition identified and a revoked mDL can no longer be accepted and its bearer is recognized as such. Therefore privacy established at transaction time after issuance should not be neglected at revocation time.   Accordingly, backward unlinkability that is an important property that prevents the loss of anonymity of past signatures when a user is revoked, should be preserved.  As example when an mDL is revoked, the signatures previously made with his device key should not become linkable if previously anonymous.
The following subsections provide an overview of technical and organizational mitigations to help provide anonymity and unlinkability.
E.8.2 Data minimization for metadata
It is important to note that anonymity or pseudonymity (e.g through de-identification) on data attributes can be ineffective if metadata items are associated with multiple transactions. Common metadata elements that could lead to privacy compromise are hardware or network addresses, long-term public key material, or session tokens. Additionally, statistical traffic analysis can lead to re-identification attacks and therefore compromise anonymity through linking of transactions (even if the content of these transactions is confidential through end-to-end encryption in upper layers).
Therefore, data minimization techniques should be applied to both data and metadata. The following subsections describe approaches to minimizing exposure of long-term key material. Minimization of address elements depends on the respective transport (both in device engagement and data transfer phases):
?NFC: Should not use static lower layer addresses.
?QR code: Does not use lower layer addresses.
?Bluetooth LE: LE Privacy should be enabled including private reconnection addresses as of Bluetooth 4.2 to randomize lower layer addresses.
?Wi-Fi Aware: Wi-Fi Aware device's NAN Management Interface Address (NMI) used for discovery and NAN Data Interface Address(es) (NDIs) should be randomly generated every time a Wi-Fi Aware interface is enabled. In addition, Wi-Fi Aware interface unique identifiers such as NMI MAC addresses, UUIDs, and TCP port numbers should be changed at regular intervals, e.g. every 15 minutes, if possible, as recommended by the Wi-Fi Alliance Neighbor Awareness Networking Specification.
?Internet: IP addresses are generally visible to passive observers and may include long-term stable lower layer identifiers (such as MAC addresses in IPv6). For data minimization reasons, clients should enable address randomization where possible (including IPv6 address privacy). Explicit anonymization techniques such as tunneling through Tor are an option, but will reduce performance and reliability.
E.8.3 Unlinkability and forward secrecy through ephemeral identifiers
Ephemeral keys from mDL and mDL reader are used to establish an authenticated, encrypted secure channel without exposing any long-lived public keys to passive observers. Active man-in-the-middle attackers could see mDL and mDL reader authentication public keys. All ephemeral keys should be destroyed by both mDL and mDL reader after use to ensure forward secrecy against an eavesdropper who records the encrypted session and later compromises one or both.
E.8.4 Rotation of public keys
The possibility of linkability through the mDL Authentication keys should be taken into consideration by IAs when deciding policy for the frequency of mDL updates. Rotation of public keys during mDL updates will implement some resistance to tracking of mDL transactions by mDL verifiers. mDL updates can happen more frequently than mDL data is updated.
The mDL Authentication keys should be changed as often as possible so they do not become a unique identifier that can be used to link mDL transactions even when the exchanged data does not uniquely identify the mDL holder. The IA should implement solutions where the mDL authentication key is changed frequently. Triggers for authentication key rotation could be changes in the mDL data, number of days the key is active, or number of times the key is used.
mDLs may store a set of mDL authentication keys (together with a set of random numbers for all data elements and an MSO for each key) and choose an unused or random key for each transaction, or rotate keys for each transaction. In the event that all available mDL authentication keys have been used, the mDL may re-use a key, but re-use should be minimized and obtaining mDL holder consent should be considered.
E.8.5 Server retrieval token time to live
When exchanging an server retrieval token from mDL to mDL reader during the device engagement or data transfer phases, the server retrieval token should be very short-lived and used only once. These two qualities will ensure against replay attacks and provide better mDL holder control over mDL verifiers asking for mDL holder consent. Server retrieval tokens can be generated on the mobile device itself, or by the issuing authority service where it may not require a secure element on mobile. This could ensure scalability by supporting all kind of mobile devices without requiring particular hardware (e.g. SE).
If server retrieval tokens contain access rights to mDL holder data, the confidentiality and integrity of the server retrieval token shall be ensured. If a server retrieval token is used in a particular implementation of "pre-consent", then that server retrieval should not be exchanged during the device engagement phase, but rather during secure data transfer phase. Server retrieval tokens should be time-limited and use-limited to prevent against replay attack.
E.8.6 MSO digests
An issuing authority should ensure that the number of digests in the MSO does not inadvertently leak any information. To prevent such a leakage an issuing authority can add digests that are not related to any data elements in the MSO and can use a fixed number of digests in all issued mDLs.
E.9 Tracking mDL usage
Issuing authorities and technology providers should not track mDL holders or the usage of any mDL. Auditability should be for each individual mDL holder and not permit issuing authorities or technology providers to track transactions, aggregate audit trails across mDL holders, manage mDL verifier to mDL holder relationships, prevent (censor) mDL holder to mDL verifier relationships, or otherwise facilitate usage of identity information in an mDL that is not strictly in the interest of the mDL holder.
For device retrieval, transaction information shall not be logged or uploaded in any form that permits issuing authorities or technology providers to track usage of the mDL or the habits of mDL holders.
For server retrieval, the online call from an mDL verifier to exchange a server retrieval token for identity information about the mDL holder should not be utilized as an entry point to track usage or mDL holder habits.
Technology providers should implement ephemeral session keys, OpenID Connect pairwise identifiers and key rotation described in the "Unlinkability" section so that mDL verifiers cannot collude to track an mDL holder's usage of their mDL across use cases.
E.10 Collection limitation
mDL verifiers should not request all data elements, but should stick to requesting solely those data elements necessary for the transaction at hand.
Neither the mDL during device retrieval nor the issuing authority during server retrieval should respond with more data than was requested by the mDL verifier in order to fulfill the transaction. This document permits field-by-field retrieval of data elements. Consent should always be granted by the mDL holder with full knowledge of the requester, the requested data and purpose of granting consent.
E.11 Data minimization
E.11.1 Issuing authority data minimization
Issuing authorities should provision age verification statements to support mDL verifiers across the largest geographical scope that their mDL holders are expected to present their mDL. By provisioning ten age verification statements of age greater than 15 through 21, and 25, the current age and one more than the current age, mDL verifiers should be able to confirm age around the globe without revealing Date of Birth.
E.11.2 mDL verifier data minimization
mDL verifiers should not request all data elements, but should stick to requesting solely those data elements necessary for the transaction at hand. A wine store, for instance, requires that the purchaser have government-issued ID that proves they are over-21 and shall compare the person to the portrait in order to verify identity. The mDL reader in this store can ask for age confirmation and portrait, and because the validation of signature on the data demonstrates a government-issued ID card, does not need to request additional data. They should not request the date of birth in order to calculate the over-21 value they require.
mDL verifiers should not retain or log information about the transaction without mDL holder consent. For instance, the wine store logs what is necessary to display compliance with regulations that require an employee to verify the purchaser is over 21 and their identity matches their photos, but should never log names, identifying numbers, and portraits of patrons.
E.12 mDL holder (user) authentication
Unlocking and use of the mDL should only be permitted with appropriate mDL holder authentication proving that the user is the intended mDL holder. This ensures that others cannot collect mDL data without the mDL holder.
User authentication may be required to unlock the device and the mDL. With this, it becomes more difficult for someone other than the mDL holder to access and unlock the mDL data or to present and use the mDL. However, many mobile device users enroll device-level authentication for shared users of the device that may not be the mDL holder (e.g. enrolling a child fingerprint to unlock a device in order to play games). mDL holder authentication should tie the present user to the mDL holder to whom the mDL was originally issued.
This document provides a method for identity verification performed by the mDL verifier by comparing the portrait received by the mDL reader to the person presenting the mDL.  If this is not sufficient to meet the risk requirements of the transaction, the mDL reader may implement biometric comparison of the person presenting the mDL to the portrait.
Access to data elements and the authentication key should be guarded by mDL holder authentication. The authentication should be implemented in secure hardware as well.
E.13 mDL holder consent
E.13.1 Informed consent
No mDL data should be shared with any other party without informed consent. Informed Consent dictates that the mDL holder be given sufficient informed just-in-time notice about the data being requested, the entity requesting the data, and the purpose for the request. Informed Consent also requires consent gathering - that the mDL holder should be able to actively confirm or deny, given the informational notice, that their data is about to be shared with the mDL verifier. Consent Gathering can happen at two distinct times in the flow of a transaction.
In no case should a blanket authorization to share data with any mDL verifier or specific mDL verifiers be obtained from the mDL holder as part of Terms & Conditions, via a well explained pre-consent mechanism, or without a transaction-time informed consent process.
E.13.2 Operating system medical IDs
On mobile operating systems, there is functionality for the user to provide a "Medical ID", including name and emergency contact. The user can opt in to provide access to the "Medical ID" by emergency responders from an unlocked phone. Issuing authorities should not provide access to mDL Data without mDL holder consent by any registered or unregistered terminal but can instead recommend users utilize the "Medical ID" feature.
E.13.3 Device engagement
The action of tapping or allowing a QR code to be scanned is proximal consent to connect the mDL to the mDL reader (device retrieval) or for the mDL reader to connect to the issuing authority (server retrieval).
E.13.4 Data transfer
The mDL reader requests data and the mDL should obtain consent from the mDL holder to release the requested data elements and to validate the issuing authority signature on those data elements. This should be performed in one of two modes - pre-consent or transaction-time.
E.13.5 Pre-consent
Pre-consent enables mDL holders to configure specific mDL verifiers with whom they have a trust relationship to share data. Those mDL verifiers may be permitted access to a repeat set of mDL data without transaction-time consent. In all cases that pre-consent is long-lived, the mDL holder should clearly select this configuration and be aware that pre-consent is in place.
E.13.6 Transaction-time consent
Transaction-time consent is just-in-time informed notice and consent gathering during the processing of the request and before the response is provided to the mDL reader.
E.14 Provisioning accuracy & reliability
E.14.1 mDL provisioning
Achieving the privacy principle of accuracy, data quality, and integrity of the mDL across the mDL Ecosystem depends on accurate provisioning and reliability of mDL use. Nobody wants their identity documents in the hands of the wrong person, or to have someone else able to use their documents. Individual privacy and the trust of the ecosystem depend on accuracy.
In order to form trust an mDL should be provisioned accurately to the proper application on the mobile device of the intended mDL holder, and it should remain under the control of that intended mDL holder. Issuing authorities should select methods of provisioning an mDL to the mDL holder's mobile devices through accurate and secure methods that resist spoofing and impersonation.
NOTE	Interfaces, protocols and services for provisioning the mDL are not within the scope of this document. 
The issuing authority should ensure that the mDL be issued:
?according to Identity Assurance requirements of their jurisdiction (e.g. according to [10] for Issuing Authorities in the United States);
?to the intended secure application that meets privacy and PII protection requirements;
?to the proper and intended holder of the mDL.
The issuing authority should ensure that the mDL:
?remains in control of that mDL holder throughout the lifetime of the credential;
?protects the credential and the mDL data;
?can only be used by the mDL holder or with the consent of the mDL holder;
?meets the mDL verifier's needs for Authentication Assurance particular to their region.
E.14.2 Provisioning to the right application
In the issuance process, there should be some means for the issuing authority to ensure the application can be identified as genuine and valid. Various proprietary techniques could apply to identify an application as a genuine. Various code obfuscation and tamper detection techniques are available off-the-shelf to facilitate hacking detection.
E.14.3 Provisioning to the right mDL holder
Many methods in use today for obtaining internet credentials - for example, possession of an email address, SMS of one-time passcode, and self-asserted enrollment - do not provide sufficient assurance on their own and will not result in trusted credentials or trust across the mDL ecosystem.
There are various techniques to facilitate issuing the mDL to the intended mDL holder:
?in-person provisioning;
?remote identity proofing;
?trusted referees or monitored remote proofing;
?user authentication from the App and mDL provisioning once authenticated;
?using multiple alternative personal channels (mail, SMS, email) to communicate a provisioning "trigger" that is combined to achieve identity assurance.
E.14.4 Continued use by the right user
The mDL should protect against unauthorized use of mDL by other than the mDL holder. This should include using authentication factors that tie the user to the mDL data and be wary of device authentication factors that support device-sharing (e.g. registering children's fingerprints for them to play games on a device). The mDL should not solely rely on device security.
The mDL should authenticate the mDL holder when launching the mDL to prevent against leaking mDL data to unauthorized users. At transaction-time, identity verification will be performed by the mDL verifier.
E.15 Data accuracy and freshness
Issuers sign the mDL data and therefore are declaring the accuracy of mDL data at the time of signing.
Issuers should establish policy for how often mDL data is to be refreshed. This policy is reflected in the mobile security object (MSO). mDL solutions should endeavor to refresh mDLs at least as often as policy states.
Verifiers should implement business decisions related to that freshness if mDL data is out of date.
E.16 Reader registration and authentication
mDL reader registration is an optional feature so that mDL solutions do not require registration of mDL readers to one central issuing authority in order to allow mDL transactions. Consolidating registrations as such would create a tracking vector as discussed above. Implementing mDL reader registration however allows various use cases when knowledge of the mDL reader is important, such as access to data elements that are restricted to authenticated mDL readers, providing informed consent to the user, and protecting against man-in-middle attacks that could compromise the confidentiality of mDL data.
It is worth noting that the standard ensures that access to mandatory mDL data elements as listed in Table 3 shall not be rejected for unregistered mDL readers.
If the terminal is registered to allow its authentication, the issuing authority should put in place policies and a registration process that guarantees the identity of the mDL reader and ensures the protection of the authentication secret and keys within the mDL reader.
When the mDL reader is authenticated, concern should be taken to make sure the element of its authentication does not become a unique identifier allowing to track the mDL reader itself. The mechanisms for rotation of public key can be applied to the mdoc reader authentication keys, as it is to the mDL keys, to achieve this.
While the mDL holder is likely to have a right to uniquely identify who initiated a data reading transaction from his mDL for later complaints, the terminal can be protected in order to avoid tracking from a third party observing the exchange, or from the mDL if it can initiate the transaction without active involvement of the mDL holder. A registry of the temporary authentication keys issued to mDL readers, managed by the issuing authority, can be the mechanism for this.
NOTE 	This document does not define a method by which access restriction to individual elements for specific mDL readers can be defined.
E.17 mDL reader connections to issuing authority base URL
E.17.1 Rogue IA and rogue verifier protection
In the server retrieval methods, the base URL of the issuing authority is provided to mDL readers during device engagement or in the mdoc response message. mDL readers are protected from connecting to rogue IA's by validating the TLS server certificates against the IACA root certificate of the IA.
Key to the protection of participants in mDL transactions are mdoc reader authentication and the selection of dependable signer certificates.
E.17.2 mDL reader protection
Verifiers should ensure they only trust signer certificates and root certificates of well-known issuing authorities. They may use for this trusted IDL VICALs provided by reputable providers that vet the content of their lists through an adequate policy, according to the requirements described in Annex C.

[A1]Discussed: updated
[A2]Todo: to be updated
[A3]Discussed
[A4]Todo: to be updated
[A5]Todo: double check whether this statement is still necessary.
[A6]Discussed, mDL reader auth certificate split in two parts
[A7]Discussed: updated
[A8]Discussed: updated
[A9]Todo: to be updated
[A10]Discussed: updated Wi-Fi Aware configuration record and therefore all examples
Discussed: updated all examples to add authority key identifier to end-entity certificates
ISO/IEC DIS 18013-5:2020(E)

ISO/IEC DIS 18013-5:2020(E)

iv
(c) ISO/IEC 2020 - All rights reserved


(c) ISO/IEC 2020 - All rights reserved
i


ISO/IEC WD 18013-5:2016(E)

iii
(c) ISO/IEC 2016 - All rights reserved


18
(c) ISO/IEC 2020 - All rights reserved


(c) ISO/IEC 2020 - All rights reserved
19


DRAFT INTERNATIONAL STANDARD
ISO/IEC DIS 18013-5:2020(E)


(c) ISO/IEC 2020 - All rights reserved
1


